/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2015 SAP SE. All rights reserved
 */
sap.ui.define(['jquery.sap.global','sap/m/Column','sap/m/Label','sap/m/MessageBox','sap/m/Table','sap/m/Text','sap/m/ToolbarSeparator','sap/m/VBox','sap/ui/comp/library','sap/ui/comp/providers/TableProvider','sap/ui/comp/smartfilterbar/FilterProvider','sap/ui/comp/smartvariants/SmartVariantManagement','sap/ui/model/FilterOperator','sap/ui/model/json/JSONModel','sap/ui/table/AnalyticalColumn','sap/ui/table/AnalyticalTable','sap/ui/table/Column','sap/ui/table/Table','sap/ui/table/TreeTable'],function(q,C,L,M,T,a,b,V,l,c,F,S,d,J,A,f,g,h,j){"use strict";var k=V.extend("sap.ui.comp.smarttable.SmartTable",{metadata:{library:"sap.ui.comp",properties:{entitySet:{type:"string",group:"Misc",defaultValue:null},smartFilterId:{type:"string",group:"Misc",defaultValue:null},ignoredFields:{type:"string",group:"Misc",defaultValue:null},tableType:{type:"sap.ui.comp.smarttable.TableType",group:"Misc",defaultValue:null},useVariantManagement:{type:"boolean",group:"Misc",defaultValue:true},useExportToExcel:{type:"boolean",group:"Misc",defaultValue:true},useTablePersonalisation:{type:"boolean",group:"Misc",defaultValue:true},showRowCount:{type:"boolean",group:"Misc",defaultValue:true},header:{type:"string",group:"Misc",defaultValue:null},toolbarStyleClass:{type:"string",group:"Misc",defaultValue:null},enableCustomFilter:{type:"boolean",group:"Misc",defaultValue:true},persistencyKey:{type:"string",group:"Misc",defaultValue:null},useOnlyOneSolidToolbar:{type:"boolean",group:"Misc",defaultValue:false},currentVariantId:{type:"string",group:"Misc",defaultValue:null},editable:{type:"boolean",group:"Misc",defaultValue:false},enableAutoBinding:{type:"boolean",group:"Misc",defaultValue:false},tableBindingPath:{type:"string",group:"Misc",defaultValue:null},editTogglable:{type:"boolean",group:"Misc",defaultValue:false}},aggregations:{customToolbar:{type:"sap.m.Toolbar",multiple:false},semanticObjectController:{type:"sap.ui.comp.navpopover.SemanticObjectController",multiple:false}},events:{initialise:{},beforeRebindTable:{},editToggled:{},dataReceived:{},afterVariantSave:{},afterVariantApply:{}}}});k.prototype.init=function(){sap.m.FlexBox.prototype.init.call(this);this.addStyleClass("sapUiCompSmartTable");this.setFitContainer(true);this._bUpdateToolbar=true;};k.prototype._createVariantManagementControl=function(){if(this._oVariantManagement||(!this.getUseVariantManagement()&&!this.getUseTablePersonalisation())||!this.getPersistencyKey()){return;}var p=new sap.ui.comp.smartvariants.PersonalizableInfo({type:"table",keyName:"persistencyKey",dataSource:"TODO"});p.setControl(this);var t=this;this._oVariantManagement=new sap.ui.comp.smartvariants.SmartVariantManagement({personalizableControls:p,initialise:function(e){t._oCurrentVariant="STANDARD";},save:function(e){t._variantSaved();},afterSave:function(){t.fireAfterVariantSave({currentVariantId:t.getCurrentVariantId()});},showShare:false});this._oVariantManagement.initialise();};k.prototype._variantSaved=function(){if(this._oPersController){this._oPersController.setPersonalizationData(this._oCurrentVariant);}};k.prototype.setUseExportToExcel=function(u){this.setProperty("useExportToExcel",u,true);this._bUpdateToolbar=true;};k.prototype.setUseTablePersonalisation=function(u){this.setProperty("useTablePersonalisation",u,true);this._bUpdateToolbar=true;};k.prototype.setUseOnlyOneSolidToolbar=function(o){this.setProperty("useOnlyOneSolidToolbar",o,true);this._bUpdateToolbar=true;};k.prototype.setUseVariantManagement=function(u){this.setProperty("useVariantManagement",u,true);if(this._oPersController){this._oPersController.setResetToInitialTableState(!u);}this._bUpdateToolbar=true;};k.prototype.setToolbarStyleClass=function(s){this.setProperty("toolbarStyleClass",s,true);this._createToolbar();this._oToolbar.addStyleClass(s);};k.prototype.setCustomToolbar=function(o){if(this._oCustomToolbar){this.removeItem(this._oCustomToolbar);}this._oCustomToolbar=o;if(this._oCustomToolbar){this._oCustomToolbar.addStyleClass("sapUiCompSmartTableCustomToolbar");this._oCustomToolbar.setLayoutData(new sap.m.FlexItemData({shrinkFactor:0}));this.insertItem(this._oCustomToolbar,1);}this._bUpdateToolbar=true;};k.prototype.getCustomToolbar=function(){return this._oCustomToolbar;};k.prototype.setHeader=function(t){this.setProperty("header",t,true);this._refreshHeaderText();};k.prototype.setShowRowCount=function(s){this.setProperty("showRowCount",s,true);this._refreshHeaderText();};k.prototype.setEditTogglable=function(t){this.setProperty("editTogglable",t,true);this._bUpdateToolbar=true;};k.prototype.setEditable=function(e){this.setProperty("editable",e,true);};k.prototype._refreshHeaderText=function(){if(!this._headerText){this._bUpdateToolbar=true;return;}var t=this.getHeader();if(this.getShowRowCount()){var r=parseInt(this._getRowCount(),10);q.sap.require("sap.ui.core.format.NumberFormat");var v=sap.ui.core.format.NumberFormat.getFloatInstance().format(r);t+=" ("+v+")";}this._headerText.setText(t);};k.prototype._createToolbar=function(){if(!this._oToolbar){this._oToolbar=new sap.m.Toolbar();this._oToolbar.addStyleClass("sapUiCompSmartTableToolbar");if(this.getUseVariantManagement()||this.getHeader()){this._oToolbar.setDesign(sap.m.ToolbarDesign.Transparent);this._oToolbar.setHeight("3rem");}else{this._oToolbar.setDesign(sap.m.ToolbarDesign.Solid);}this._oToolbar.setLayoutData(new sap.m.FlexItemData({shrinkFactor:0}));this.insertItem(this._oToolbar,0);}};k.prototype.onBeforeRendering=function(){if(this._bUpdateToolbar&&this.bIsInitialised){if(this.getUseOnlyOneSolidToolbar()&&this._oCustomToolbar){this._addVariantManagementToToolbar(true);this._addSeparatorToToolbar(true);this._addHeaderToToolbar(true);}else{this._createToolbar();this._oToolbar.removeAllContent();this._addHeaderToToolbar();this._addSeparatorToToolbar();this._addVariantManagementToToolbar();}this._addSpacerToToolbar();this._addEditTogglableToToolbar();this._addTablePersonalisationToToolbar();this._addExportToExcelToToolbar();if(this._oToolbar&&(this._oToolbar.getContent().length===0||(this._oToolbar.getContent().length===1&&this._oToolbar.getContent()[0]instanceof sap.m.ToolbarSpacer))){this.removeItem(this._oToolbar);this._oToolbar.destroy();this._oToolbar=null;}this._bUpdateToolbar=false;}};k.prototype._addEditTogglableToToolbar=function(){var t=this._oCustomToolbar||this._oToolbar;if(this.getEditTogglable()){if(!this._oEditButton){this._oEditButton=new sap.m.Button({type:sap.m.ButtonType.Default,icon:this.getEditable()?"sap-icon://display":"sap-icon://edit",press:q.proxy(function(){var e=this.getEditable();e=!e;this.setEditable(e,true);this._oEditButton.setIcon(e?"sap-icon://display":"sap-icon://edit");this.fireEditToggled({editable:e});},this)});}if(this._oEditButton){t.addContent(this._oEditButton);}}else if(this._oEditButton){t.removeContent(this._oEditButton);}};k.prototype._addHeaderToToolbar=function(i){if(this.getHeader()){if(!this._headerText){this._headerText=new a();this._headerText.addStyleClass("sapMH4Style");this._headerText.addStyleClass("sapUiCompSmartTableHeader");}this._refreshHeaderText();if(i){this._oCustomToolbar.insertContent(this._headerText,0);}else{this._oToolbar.addContent(this._headerText);}}};k.prototype._addSeparatorToToolbar=function(i){if(this.getHeader()&&this.getUseVariantManagement()){var s=new b();if(i){this._oCustomToolbar.insertContent(s,0);}else{this._oToolbar.addContent(s);}}};k.prototype.getTable=function(){return this._oTable;};k.prototype._addVariantManagementToToolbar=function(i){if(this.getUseVariantManagement()){this._createVariantManagementControl();if(i){this._oCustomToolbar.insertContent(this._oVariantManagement,0);}else{this._oToolbar.addContent(this._oVariantManagement);}}};k.prototype._addExportToExcelToToolbar=function(){if(this.getUseExportToExcel()&&this._bTableSupportsExcelExport){var t=this;if(!this._oUseExportToExcel){this._oUseExportToExcel=new sap.m.Button({type:sap.m.ButtonType.Default,icon:"sap-icon://excel-attachment",tooltip:sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp").getText("TABLE_EXPORT_TEXT"),press:function(e){var D=function(){var R=t._getRowBinding();var u=R.getDownloadUrl("xlsx");window.open(u);};var r=t._getRowCount();if(r>10000){M.confirm(sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp").getText("DOWNLOAD_CONFIRMATION_TEXT",r),{actions:[M.Action.YES,M.Action.NO],onClose:function(i){if(i===M.Action.YES){D();}}});}else{D();}}});this._setExcelExportEnableState();}var o=this._oCustomToolbar||this._oToolbar;o.addContent(this._oUseExportToExcel);}};k.prototype._getRowCount=function(){var r=this._getRowBinding();if(!r){return 0;}var R=0;if(r.getTotalSize){R=r.getTotalSize();}else{R=r.getLength();}if(R<0||R==="0"){R=0;}return R;};k.prototype._setExcelExportEnableState=function(){if(this._oUseExportToExcel){var r=this._getRowCount();if(r>0){this._oUseExportToExcel.setEnabled(true);}else{this._oUseExportToExcel.setEnabled(false);}}};k.prototype._addSpacerToToolbar=function(){var t=this._oCustomToolbar||this._oToolbar;var I=t.getContent();var e=false;if(I){var m=I.length;var i=0;for(i;i<m;i++){if(I[i]instanceof sap.m.ToolbarSpacer){e=true;break;}}}if(!e){t.addContent(new sap.m.ToolbarSpacer());}};k.prototype._addTablePersonalisationToToolbar=function(){if(this.getUseTablePersonalisation()){if(!this._oTablePersonalisationButton){this._oTablePersonalisationButton=new sap.m.Button({type:sap.m.ButtonType.Default,icon:"sap-icon://action-settings",press:q.proxy(function(e){this._oPersController.openDialog();},this)});}var t=this._oCustomToolbar||this._oToolbar;t.addContent(this._oTablePersonalisationButton);}};k.prototype._createPersonalizationController=function(){if(this._oPersController||!this.getUseTablePersonalisation()){return;}var s=this.data("p13nDialogSettings");if(typeof s==="string"){try{s=JSON.parse(s);}catch(e){s=null;}}q.sap.require("sap.ui.comp.personalization.Controller");this._oPersController=new sap.ui.comp.personalization.Controller({table:this._oTable,setting:s,resetToInitialTableState:!this.getUseVariantManagement(),beforePotentialTableChange:q.proxy(this._beforePersonalisationModelDataChange,this),afterPotentialTableChange:q.proxy(this._afterPersonalisationModelDataChange,this),afterP13nModelDataChange:q.proxy(this._personalisationModelDataChange,this)});};k.prototype._getRowBinding=function(){if(this._oTable){return this._oTable.getBinding(this._sAggregation);}};k.prototype.setEntitySet=function(e){this.setProperty("entitySet",e);this._initialiseMetadata();};k.prototype.propagateProperties=function(){V.prototype.propagateProperties.apply(this,arguments);this._initialiseMetadata();};k.prototype._initialiseMetadata=function(){if(!this.bIsInitialised){this._createTableProvider();if(this._oTableProvider){this._aTableViewMetadata=this._oTableProvider.getTableViewMetadata();if(this._aTableViewMetadata){this.bIsInitialised=true;this._bTableSupportsExcelExport=this._oTableProvider.getSupportsExcelExport();this._listenToSmartFilter();this._createContent();this._createVariantManagementControl();this._createPersonalizationController();this._oEditModel=new J({editable:this.getEditable()});this.bindProperty("editable",{path:"sm4rtM0d3l>/editable"});this.setModel(this._oEditModel,"sm4rtM0d3l");if(this._bUpdateToolbar){this.rerender();}this.fireInitialise();if(this.getEnableAutoBinding()){this._reBindTable();}}}}};k.prototype._createTableProvider=function(){var m,e,i;e=this.getEntitySet();i=this.getIgnoredFields();m=this.getModel();if(m&&!this._bTableCreated){this._aExistingColumns=[];this._oTemplate=null;this._createTable();this._bTableCreated=true;}if(m&&m.bLoadMetadataAsync&&!m.oMetadata.isLoaded()){if(!this._bMetadataLoadAttached){m.attachMetadataLoaded(q.proxy(this._initialiseMetadata,this));this._bMetadataLoadAttached=true;}return;}if(m&&e){if(this._aExistingColumns.length){if(i){i+=","+this._aExistingColumns.toString();}else{i=this._aExistingColumns.toString();}}this._oTableProvider=new sap.ui.comp.providers.TableProvider({entitySet:e,ignoredFields:i,isEditableTable:this.getEditable(),dateFormatSettings:this.data("dateFormatSettings"),currencyFormatSettings:this.data("currencyFormatSettings"),defaultDropDownDisplayBehaviour:this.data("defaultDropDownDisplayBehaviour"),useSmartField:this.data("useSmartField"),model:m});}};k.prototype._listenToSmartFilter=function(){var s=null;s=this.getSmartFilterId();this._oSmartFilter=this._findControl(s);if(this._oSmartFilter){this._oSmartFilter.attachSearch(q.proxy(this._reBindTable,this));this._oSmartFilter.attachFilterChange(q.proxy(function(){this._oTable.setShowOverlay(true);},this));if(this._oTable.setNoDataText){this._oTable.setNoDataText(sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp").getText("SMARTTABLE_NO_DATA"));}}};k.prototype._findControl=function(i){var r,v;if(i){r=sap.ui.getCore().getControl(i);if(!r){v=this._getView();if(v){r=v.byId(i);}}}return r;};k.prototype._getView=function(){if(!this._oView){var o=this.getParent();while(o){if(o instanceof sap.ui.core.mvc.View){this._oView=o;break;}o=o.getParent();}}return this._oView;};k.prototype.rebindTable=function(){this._reBindTable();};k.prototype._reBindTable=function(){var t,e,s,i,p={},B={preventTableBind:false};t=this._getTablePersonalisationData()||{};e=t.filters;i=t.sorters;if(this._oSmartFilter){var m=this._oSmartFilter.getFilters();if(e){e=m.concat(e);}else{e=m;}p=this._oSmartFilter.getParameters()||{};}s=this._getVisibleColumnPaths();if(s&&s.length){p["select"]=s.toString();}p["useBatchRequests"]=true;if(!i){i=[];}B.filters=e;B.sorter=i;B.parameters=p;this.fireBeforeRebindTable({bindingParams:B});if(!B.preventTableBind){i=B.sorter;e=B.filters;s=B.parameters["select"];if(!s||!s.length){M.show(sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp").getText("SMARTTABLE_NO_COLS"),{icon:M.Icon.ERROR,title:sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp").getText("EMPTY_MANDATORY_CHECK_TITLE"),styleClass:!!(this.$()&&this.$().closest(".sapUiSizeCompact").length)?"sapUiSizeCompact":""});return;}this._oTable.setBusy(true);if(this._oTable.setNoDataText){this._oTable.setNoDataText(" ");}if(this._oTable._setSuppressRefresh){this._oTable._setSuppressRefresh(false);}this._oTable.bindRows({path:this.getTableBindingPath()||("/"+this.getEntitySet()),filters:e,sorter:i,parameters:p,template:this._oTemplate,events:{dataReceived:q.proxy(function(){if(!this._getRowCount()){if(this._oTable.setNoDataText){this._oTable.setNoDataText(sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp").getText("SMARTTABLE_NO_RESULTS"));}}this._oTable.setBusy(false);this.updateTableHeaderState();this.fireDataReceived();this._disableSumRows();},this)}});this._oTable.setShowOverlay(false);this._bIsTableBound=true;}};k.prototype.updateTableHeaderState=function(){this._refreshHeaderText();this._setExcelExportEnableState();};k.prototype._createContent=function(){var i,e=0,o,m;e=this._aTableViewMetadata.length;for(i=0;i<e;i++){o=this._aTableViewMetadata[i];this._registerContentTemplateEvents(o.template);m=this._createColumn(o);m.data("p13nData",{columnKey:o.name,leadingProperty:o.name,additionalProperty:(o.isCurrencyField&&o.unit)?o.unit:undefined,sortProperty:o.sortable?o.name:undefined,filterProperty:o.filterable?o.name:undefined,type:o.filterType,maxLength:o.maxLength,precision:o.precision,scale:o.scale,aggregationRole:o.aggregationRole});this._oTable.addColumn(m);}};k.prototype._registerContentTemplateEvents=function(t){if(t instanceof sap.ui.comp.navpopover.SmartLink){var s=this.getSemanticObjectController();t.setSemanticObjectController(s);}};k.prototype._updateInitialColumns=function(){var i=this._oTable.getColumns(),m=i?i.length:0,o,n,s;while(m--){s=null;o=i[m];if(o){if(o.getLeadingProperty){s=o.getLeadingProperty();}n=o.data("p13nData");if(typeof n==="string"){try{n=JSON.parse(n);}catch(e){}if(n){o.data("p13nData",n);}}if(!s){if(n){s=n["leadingProperty"];}}if(s){this._aExistingColumns.push(s);}}}};k.prototype._getVisibleColumnPaths=function(){var s=[],e=this._oTable.getColumns(),i,m=e?e.length:0,o,n,p,r;for(i=0;i<m;i++){o=e[i];p=null;if(o.getVisible()){if(o.getLeadingProperty){p=o.getLeadingProperty();}n=o.data("p13nData");if(n){if(!p){p=n["leadingProperty"];}r=n["additionalProperty"];}if(p&&s.indexOf(p)<0){s.push(p);}if(r&&s.indexOf(r)<0){s.push(r);}}}return s;};k.prototype._createTable=function(){var e=this.getItems(),i=e?e.length:0,t;this._sAggregation="rows";while(i--){t=e[i];if(t instanceof h||t instanceof T){break;}t=null;}if(t){this._oTable=t;if(t instanceof f){this._isAnalyticalTable=true;}else if(t instanceof T){this._isMobileTable=true;this._oTemplate=(t.getItems()&&t.getItems().length>0)?t.getItems()[0]:new sap.m.ColumnListItem();t.removeAllItems();}else if(t instanceof j){this._isTreeTable=true;}this._updateInitialColumns();}else{if(this.getTableType()==="AnalyticalTable"){this._isAnalyticalTable=true;this._oTable=new f({enableCustomFilter:true});}else if(this.getTableType()==="ResponsiveTable"){this._isMobileTable=true;this._oTable=new T({growing:true});this._oTemplate=new sap.m.ColumnListItem();}else if(this.getTableType()==="TreeTable"){this._isTreeTable=true;this._oTable=new j();}else{this._oTable=new h();}if(this._oTable.setVisibleRowCountMode){this._oTable.setVisibleRowCountMode(sap.ui.table.VisibleRowCountMode.Auto);}this.insertItem(this._oTable,2);}this._oTable.setLayoutData(new sap.m.FlexItemData({growFactor:1}));this._oTable.addStyleClass("sapUiCompSmartTableInnerTable");this._oTable.setEnableBusyIndicator(true);this._oTable.setBusyIndicatorDelay(0);if(this._oTable.setEnableCustomFilter){this._oTable.setEnableCustomFilter(this.getEnableCustomFilter());}if(this._oTable.getEnableCustomFilter&&this._oTable.getEnableCustomFilter()){if(this._oTable.setEnableCellFilter){this._oTable.setEnableCellFilter(false);}if(this._oTable.attachCustomFilter){this._oTable.attachCustomFilter(q.proxy(this._showTableFilterDialog,this));}}if(this._isAnalyticalTable){this._createColumn=this._createAnalyticalColumn;}else if(this._isMobileTable){this._sAggregation="items";this._createColumn=this._createMobileColumn;this._oTable.bindRows=this._oTable.bindItems;}};k.prototype._showTableFilterDialog=function(e){if(this._oPersController){this._oPersController.openDialog({filter:{visible:true,payload:{column:e.getParameter("column")}}});}};k.prototype._disableSumRows=function(){if(sap.ui.Device.browser.msie&&sap.ui.Device.browser.version<11){q.sap.delayedCall(60,this,function(){if(this.getEditable()){this._oTable.$().find(".sapUiAnalyticalTableSum input").prop("disabled",true);this._oTable.$().find(".sapUiTableGroupHeader input").prop("disabled",true);}});}};k.prototype._createColumn=function(o){var e;e=new g({autoResizable:true,hAlign:o.align,width:o.width,visible:o.isInitiallyVisible,label:new L({textAlign:o.align,text:o.label}),tooltip:o.quickInfo,showSortMenuEntry:o.sortable,showFilterMenuEntry:o.filterable,name:o.fieldName,template:o.template});return e;};k.prototype._createAnalyticalColumn=function(o){var e;e=new A({autoResizable:true,hAlign:o.align,width:o.width,visible:o.isInitiallyVisible,label:new L({textAlign:o.align,text:o.label}),tooltip:o.quickInfo,showSortMenuEntry:o.sortable,showFilterMenuEntry:o.filterable,summed:o.summed,leadingProperty:o.name,template:o.template});return e;};k.prototype._createMobileColumn=function(o){var e;e=(new C({hAlign:o.align,visible:o.isInitiallyVisible,header:new a({text:o.label}),tooltip:o.quickInfo}));if(o.template&&o.template.setWrapping){o.template.setWrapping(true);}if(this._oTemplate){this._oTemplate.addCell(o.template);}return e;};k.prototype.fetchVariant=function(){if(this._oCurrentVariant==="STANDARD"||this._oCurrentVariant===null){return{};}return this._oCurrentVariant;};k.prototype.applyVariant=function(v){this._oCurrentVariant=v;if(this._oCurrentVariant==="STANDARD"){this._oCurrentVariant=null;}this._bApplyingVariant=true;if(this._oTable._setSuppressRefresh){this._oTable._setSuppressRefresh(true);}if(this._oPersController){if(this._oCurrentVariant===null){this._oPersController.resetPersonalization();}else{this._oPersController.setPersonalizationData(this._oCurrentVariant);}}if(this._bIsTableBound||!this._oSmartFilter){this._reBindTable();}else{this._oTable.setShowOverlay(true);}this._bApplyingVariant=false;this.fireAfterVariantApply({currentVariantId:this.getCurrentVariantId()});};k.prototype._beforePersonalisationModelDataChange=function(e){this._oTable.setBusy(true);if(this._oTable._setSuppressRefresh){this._oTable._setSuppressRefresh(true);}};k.prototype._afterPersonalisationModelDataChange=function(e){this._oTable.setBusy(false);};k.prototype._personalisationModelDataChange=function(e){if(this._bApplyingVariant){return;}var o=e.getParameter("changeType");var i=this._getChangeStatus(o);if(i===sap.ui.comp.personalization.Controller.ChangeType.Unchanged){return;}this._oCurrentVariant=e.getParameter("persistentData");if(!this.getUseVariantManagement()){this._persistPersonalisation();}else{this._oVariantManagement.currentVariantSetModified(true);}if(i===sap.ui.comp.personalization.Controller.ChangeType.ModelChanged){if(this._bIsTableBound||!this._oSmartFilter){this._reBindTable();}else{this._oTable.setShowOverlay(true);}}};k.prototype._getChangeStatus=function(o){if(!o){return sap.ui.comp.personalization.Controller.ChangeType.ModelChanged;}if(o.sort===sap.ui.comp.personalization.Controller.ChangeType.ModelChanged||o.filter===sap.ui.comp.personalization.Controller.ChangeType.ModelChanged||o.columns===sap.ui.comp.personalization.Controller.ChangeType.ModelChanged||o.group===sap.ui.comp.personalization.Controller.ChangeType.ModelChanged){return sap.ui.comp.personalization.Controller.ChangeType.ModelChanged;}if(o.sort===sap.ui.comp.personalization.Controller.ChangeType.TableChanged||o.filter===sap.ui.comp.personalization.Controller.ChangeType.TableChanged||o.columns===sap.ui.comp.personalization.Controller.ChangeType.TableChanged||o.group===sap.ui.comp.personalization.Controller.ChangeType.TableChanged){return sap.ui.comp.personalization.Controller.ChangeType.TableChanged;}return sap.ui.comp.personalization.Controller.ChangeType.Unchanged;};k.prototype._getTablePersonalisationData=function(){if(!this._oCurrentVariant){return null;}var s=[],e=[],E=[],G,o;if(this._isMobileTable&&this._oCurrentVariant.group&&this._oCurrentVariant.group.groupItems){G=this._oCurrentVariant.group.groupItems[0];var i,m="";i=this._getColumnByKey(G.columnKey);if(i){m=i.getHeader().getText();}var n=this._getPathFromColumnKeyAndProperty(G.columnKey,"sortProperty");o=new sap.ui.model.Sorter(n,G.operation===sap.m.P13nConditionOperation.GroupDescending,function(p){var K=p.getProperty(n);return{key:K,text:m?m+" : "+K:K};});s.push(o);}if(this._oCurrentVariant.sort){this._oCurrentVariant.sort.sortItems.forEach(function(p){var D=p.operation===sap.m.P13nConditionOperation.Descending;var P=this._getPathFromColumnKeyAndProperty(p.columnKey,"sortProperty");if(o&&o.sPath===P){o.bDescending=D;}else{s.push(new sap.ui.model.Sorter(P,D));}},this);}if(this._oCurrentVariant.filter){this._oCurrentVariant.filter.filterItems.forEach(function(p){var v=p.value1,r=p.value2;var P=this._getPathFromColumnKeyAndProperty(p.columnKey,"filterProperty");if(v instanceof Date&&this._oTableProvider&&this._oTableProvider.getIsUTCDateHandlingEnabled()){v=F.getDateInUTCOffset(v);r=r?F.getDateInUTCOffset(r):r;}if(p.exclude){E.push(new sap.ui.model.Filter(P,d.NE,v));}else{e.push(new sap.ui.model.Filter(P,p.operation,v,r));}},this);if(E.length){e.push(new sap.ui.model.Filter(E,true));}}return{filters:e,sorters:s};};k.prototype._getColumnByKey=function(s){var e,o,m,i,n;if(this._oTable){e=this._oTable.getColumns();m=e.length;for(i=0;i<m;i++){o=e[i];n=o.data("p13nData");if(n&&n.columnKey===s){return o;}}}return null;};k.prototype._getPathFromColumnKeyAndProperty=function(s,p){var P=null,o,e;o=this._getColumnByKey(s);if(o){if(p=="sortProperty"&&o.getSortProperty){P=o.getSortProperty();}else if(p=="filterProperty"&&o.getFilterProperty){P=o.getFilterProperty();}else if(p=="leadingProperty"&&o.getLeadingProperty){P=o.getLeadingProperty();}if(!P){e=o.data("p13nData");if(e){P=e[p];}}}return P;};k.prototype._persistPersonalisation=function(){var t=this;if(this._oVariantManagement){this._oVariantManagement.getVariantsInfo(function(v){var p=null;if(v&&v.length>0){p=v[0].key;}var o=p!==null;var P={name:"Personalisation",global:false,overwrite:o,key:p,def:true};t._oVariantManagement.fireSave(P);});}};k.prototype.getCurrentVariantId=function(){var K="";if(this._oVariantManagement){K=this._oVariantManagement.getCurrentVariantId();}return K;};k.prototype.setCurrentVariantId=function(v){if(this._oVariantManagement){this._oVariantManagement.setCurrentVariantId(v);}else{q.sap.log.error("sap.ui.comp.smarttable.SmartTable.prototype.setCurrentVariantId: VariantManagement does not exist");}};k.prototype.exit=function(){if(this._oTableProvider&&this._oTableProvider.destroy){this._oTableProvider.destroy();}this._oTableProvider=null;if(this._oPersController&&this._oPersController.destroy){this._oPersController.destroy();}this._oPersController=null;if(this._oVariantManagement&&this._oVariantManagement.destroy){this._oVariantManagement.destroy();}if(this._oEditModel){this._oEditModel.destroy();}this._oEditModel=null;this._oVariantManagement=null;this._oCurrentVariant=null;this._aTableViewMetadata=null;this._aExistingColumns=null;this._oSmartFilter=null;this._oCustomToolbar=null;this._oToolbar=null;this._oUseExportToExcel=null;this._oTablePersonalisationButton=null;this._oTemplate=null;this._oView=null;this._oTable=null;};return k;},true);
