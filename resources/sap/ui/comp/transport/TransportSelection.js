/*
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2015 SAP SE. All rights reserved
 */
sap.ui.define(["jquery.sap.global","sap/ui/fl/Utils","sap/ui/fl/Transports","sap/ui/comp/transport/TransportDialog","sap/ui/fl/registry/Settings"],function(q,U,T,a,F){"use strict";var b=function(){this.oTransports=new sap.ui.fl.Transports();this.oUtils=sap.ui.fl.Utils;};b.prototype.selectTransport=function(o,O,e,c,C){var t=this;if(o){var l=U.getCurrentLayer(false);var s;if(C){s=U.getComponentClassName(C);}if(s&&l&&l==='CUSTOMER'){F.getInstance(s).then(function(S){if(S.isAtoEnabled()){var d={transportId:"ATO_NOTIFICATION"};O(t._createEventObject(o,d));}else{t._selectTransport(o,O,e,c);}});}else{t._selectTransport(o,O,e,c);}}};b.prototype._selectTransport=function(o,O,e,c){var p,t=this;if(o){p=this.oTransports.getTransports(o);p.then(function(r){var d;if(t._checkDialog(r)){t._openDialog({hidePackage:!t.oUtils.doesSharedVariantRequirePackage(),pkg:o["package"],transports:r.transports,lrepObject:t._toLREPObject(o)},O,e,c);}else{d=t._getTransport(r);O(t._createEventObject(o,d));}},function(r){e(r);});}};b.prototype._createEventObject=function(o,t){return{mParameters:{selectedTransport:t.transportId,selectedPackage:o["package"],dialog:false},getParameters:function(){return this.mParameters;},getParameter:function(n){return this.mParameters[n];}};};b.prototype._toLREPObject=function(o){var O={};if(o.namespace){O.namespace=o.namespace;}if(o.name){O.name=o.name;}if(o.type){O.type=o.type;}return O;};b.prototype._openDialog=function(c,o,e,C){var d=new a(c);d.attachOk(o);d.attachCancel(e);if(C){d.addStyleClass("sapUiSizeCompact");}else{d.removeStyleClass("sapUiSizeCompact");}d.open();return d;};b.prototype._getTransport=function(t){var o;if(!t.localonly){o=this._hasLock(t.transports);}else{o={transportId:""};}return o;};b.prototype._checkDialog=function(t){if(t){if(t.localonly||this._hasLock(t.transports)){return false;}}return true;};b.prototype._hasLock=function(t){var o,l=t.length;while(l--){o=t[l];if(o.locked){return o;}}return false;};return b;},true);
