/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2015 SAP SE. All rights reserved
 */
sap.ui.define(['jquery.sap.global','sap/m/Button','sap/m/ComboBox','sap/m/Dialog','sap/m/Input','sap/m/Label','sap/m/MessageToast','sap/ui/comp/library','sap/ui/core/ListItem','sap/ui/fl/Transports','sap/ui/layout/Grid','sap/ui/layout/GridData'],function(q,B,C,D,I,L,M,l,a,T,G,b){"use strict";var c=D.extend("sap.ui.comp.transport.TransportDialog",{metadata:{library:"sap.ui.comp",properties:{pkg:{type:"string",group:"Misc",defaultValue:null},transports:{type:"any",group:"Misc",defaultValue:null},lrepObject:{type:"any",group:"Misc",defaultValue:null},hidePackage:{type:"boolean",group:"Misc",defaultValue:null}},events:{ok:{},cancel:{}}}});c.prototype.init=function(){D.prototype.init.apply(this);this._oResources=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");this.setTitle(this._oResources.getText("TRANSPORT_DIALOG_TITLE"));this.addStyleClass("sapUiCompTransportDialog");this._oPackageLabel=null;this._oPackage=this._createPackageField();this._oTransport=this._createTransportCombo();this.addContent(this._createContentGrid());this.setContentWidth("250px");this._createButtons();};c.prototype._createContentGrid=function(){var t;this._oPackageLabel=new L({text:this._oResources.getText("TRANSPORT_DIALOG_PACKAGE"),required:true,layoutData:new b({span:"L3 M3 S3"})}).addStyleClass("compFieldMargin");this._oPackageLabel.setLabelFor(this._oPackage);t=new L({text:this._oResources.getText("TRANSPORT_DIALOG_TRANSPORT"),required:true,layoutData:new b({span:"L3 M3 S3",linebreakL:true,linebreakM:true,linebreakS:true})}).addStyleClass("compFieldMargin");t.setLabelFor(this._oTransport);return new G({width:"100%",defaultSpan:"L9 M9 S9",vSpacing:0,hSpacing:0,content:[this._oPackageLabel,this._oPackage,t,this._oTransport]}).addStyleClass("compTransportPadding");};c.prototype._createButtons=function(){var t=this;this.addButton(new B({text:this._oResources.getText("TRANSPORT_DIALOG_LOCAL_OBJECT"),tooltip:this._oResources.getText("TRANSPORT_DIALOG_LOCAL_OBJECT"),press:function(){t._onLocal();}}));this.addButton(new B({text:this._oResources.getText("TRANSPORT_DIALOG_OK"),tooltip:this._oResources.getText("TRANSPORT_DIALOG_OK"),enabled:false,press:function(){t._onOkay();}}));this.addButton(new B({text:this._oResources.getText("TRANSPORT_DIALOG_CANCEL"),tooltip:this._oResources.getText("TRANSPORT_DIALOG_CANCEL"),press:function(){t.fireCancel();t.close();t.destroy();}}));};c.prototype._onLocal=function(){this.fireOk({selectedTransport:"",selectedPackage:this.getPkg()||"$TMP",dialog:true});this.close();this.destroy();};c.prototype._onOkay=function(){var t=this._oTransport.getSelectedKey();if(this._checkOkay(t)){this.fireOk({selectedTransport:t,selectedPackage:this.getPkg()||this._oPackage.getValue(),dialog:true});this.close();this.destroy();}else{this.getButtons()[1].setEnabled(false);this._oTransport.setValueState(sap.ui.core.ValueState.Error);this._oTransport.setValueStateText(this.getTitle());}};c.prototype._checkOkay=function(t){if(t){return true;}return false;};c.prototype._createTransportCombo=function(){var t=this;return new C({enabled:false,tooltip:this._oResources.getText("TRANSPORT_DIALOG_TRANSPORT_TT"),width:"100%",selectionChange:function(){if(t._oPackage.getEnabled()&&t._oPackage.getVisible()&&(!t._oPackage.getValue()||t._oPackage.getValue()==="")){return;}t.getButtons()[1].setEnabled(true);t._oTransport.setValueState(sap.ui.core.ValueState.None);},change:function(e){var f=function(i){if((i&&e.mParameters.newValue!==i.getText())||!i){return true;}return false;};if(e&&e.mParameters&&e.mParameters.newValue){if(f(t._oTransport.getSelectedItem())){t.getButtons()[1].setEnabled(false);t._oTransport.setValueState(sap.ui.core.ValueState.Error);t._oTransport.setValueStateText(t._oResources.getText("TRANSPORT_DIALOG_TRANSPORT_TT"));}}}});};c.prototype._createPackageField=function(){var t=this;return new I({tooltip:this._oResources.getText("TRANSPORT_DIALOG_PACKAGE_TT"),width:"100%",change:function(){var o,p,O;O=t._createObjectInfo();o=new sap.ui.fl.Transports();p=o.getTransports(O);p.then(function(r){t._onPackageChangeSuccess(r);},function(r){t._onPackageChangeError(r);});},liveChange:function(e){if(e.mParameters.liveValue&&e.mParameters.liveValue.length>3){t._oTransport.setEnabled(true);}}});};c.prototype._createObjectInfo=function(){var o,r={"package":this._oPackage.getValue()||""};o=this.getProperty("lrepObject");if(o){if(o.name){r.name=o.name;}if(o.type){r.type=o.type;}if(o.namespace){r.namespace=o.namespace;}}return r;};c.prototype._onPackageChangeSuccess=function(t){if(t){if(t.localonly){this._oTransport.setEnabled(false);this.getButtons()[1].setEnabled(true);}else if(t.transports&&t.transports.length>0){this._oTransport.setEnabled(true);this._setTransports(t);}else if(t.errorCode){this.getButtons()[1].setEnabled(false);this._oPackage.setValueState(sap.ui.core.ValueState.Error);this._oPackage.setValueStateText(this._oResources.getText("TRANSPORT_DIALOG_"+t.errorCode));this._setTransports(t);}else{M.show(this._oResources.getText("TRANSPORT_DIALOG_NO_TRANSPORTS"));}}};c.prototype._setTransports=function(t){var o,d;o=this._hasLock(t.transports);if(o){d=[o];}else{d=t.transports;}this.setTransports(d);if(d&&d.length===1){this._oTransport.setValue(d[0].description,true);this.getButtons()[1].setEnabled(true);}if(!d||d.length===0){this._oTransport.setSelectedKey(null);this._oTransport.setValueState(sap.ui.core.ValueState.None);this.getButtons()[1].setEnabled(false);}};c.prototype._onPackageChangeError=function(r){M.show(r);this.setTransports([]);};c.prototype._hasLock=function(t){var o,d=t.length;while(d--){o=t[d];if(o.locked){return o;}}return null;};c.prototype.setPkg=function(p){if(p&&!this.getProperty("pkg")){this.setProperty("pkg",p);this._oPackage.setValue(p);this._oPackage.setEnabled(false);this._oTransport.setEnabled(true);this.setTitle(this._oResources.getText("TRANSPORT_DIALOG_TITLE_SIMPLE"));this.getButtons()[0].setVisible(false);}};c.prototype.setTransports=function(s){var i,d=0,o;if(s){this.setProperty("transports",s);this._oTransport.removeAllItems();d=s.length;for(i=0;i<d;i++){o=s[i];this._oTransport.addItem(new a({key:o.transportId,text:o.description}));}if(d===1){this._oTransport.setSelectedKey(s[0].transportId);this.getButtons()[1].setEnabled(true);}if(d>0){this._oTransport.setEnabled(true);}}};c.prototype.setLrepObject=function(o){if(o&&!this.getProperty("lrepObject")){this.setProperty("lrepObject",o);}};c.prototype.setHidePackage=function(h){this.setProperty("hidePackage",h);this._oPackage.setVisible(!h);this._oPackageLabel.setVisible(!h);if(h){this.getButtons()[0].setEnabled(h);this.setTitle(this._oResources.getText("TRANSPORT_DIALOG_TITLE_SIMPLE"));}};return c;},true);
