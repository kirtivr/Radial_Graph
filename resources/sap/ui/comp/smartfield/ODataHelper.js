/*
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2015 SAP SE. All rights reserved
 */
sap.ui.define(["jquery.sap.global","sap/ui/comp/odata/MetadataAnalyser"],function(q,M){"use strict";var O=function(m){if(m){this._oMeta=m.getMetaModel();this.oAnalyzer=new M(m);}};O.prototype.checkNavigationProperty=function(m,o){var p,n,l,N=[];if(m){if(o&&o.sPath){n=this.getNavigationProperty(o.sPath,m.typecount);if(n){this._updateNavigationProperty(m,n);}}p=m.path.split("/");l=p.length;if(l>1){while(l--){n=this.getNavigationProperty(p[0],m.typecount);if(n){this._updateNavigationProperty(m,n);}else{this._getProperty(m,p,N);return true;}N.push(p.shift());}}}return false;};O.prototype._getProperty=function(m,p,n){m.property=this.getProperty(p.join("/"),m.namespace,m.typecount);if(n.length>0){m.navigationPath=n.join("/")+"/";}};O.prototype._updateNavigationProperty=function(m,n){var a,t,T;a=this.getAssociation(n.relationship);t=this.getAssociationTarget(a,n);m.entitySet=this.getEntitySet(t);T=this.getEntityType(m.entitySet.entityType.replace(m.namespace+".",""));m.entityType=T.type;m.typecount=T.count;};O.prototype.getNavigationProperty=function(n,t){if(n){return this._getTypeProperty(n,"/navigationProperty",t);}return null;};O.prototype.getProperty=function(p,n,t){var l,P,o;if(p&&n){P=p.split("/");l=P.length;if(l>1){o=this._getTypeProperty(P[0],"/property",t);return this._getComplex(o,n,P,l);}o=this._getTypeProperty(p,"/property",t);return{property:o,typePath:p,extensions:this._toMap(o,"extensions")};}return null;};O.prototype._toMap=function(p,a){var A,o,b={},l,P,n={"http://www.sap.com/Protocols/SAPData":"sap:"};if(p&&p[a]){A=p[a];}if(A&&A.length){l=A.length;}else{return b;}while(l--){o=A[l];P=n[o.namespace];if(P){b[P+o.name]=o.value;}else{b[o.name]=o.value;}}return b;};O.prototype._getComplex=function(p,n,P,l){var o=p,t;while(l--){if(o){if(l===0){o=this._getNamedProperty(P[0],"property",o);return{typePath:t+"/"+P[0],property:o,complex:true,extensions:this._toMap(o,"extensions")};}o=this.getComplexType(o.type.replace(n+".",""));t=this._getComplexPath(t,o);}P.shift();}};O.prototype._getComplexPath=function(t,o){if(t){return t+"/"+o.name;}return o.name;};O.prototype._getNamedProperty=function(n,a,p){var r;q.each(p[a],function(i,e){if(e.name===n){r=e;return false;}});return r;};O.prototype._getTypeProperty=function(n,c,t){var p,o;o=this._oMeta.getObject("/dataServices/schema/0/entityType/"+t+c);if(o){q.each(o,function(i,e){if(e.name===n){p=e;return false;}});}return p;};O.prototype.getEntityType=function(n){var c,o,t=null;if(n){o=this._oMeta.getObject("/dataServices/schema/0/entityType");if(o){q.each(o,function(i,e){if(e.name===n){t=e;c=i;return false;}});}}return{count:c,type:t};};O.prototype.getComplexType=function(n){var t;if(n){q.each(this._oMeta.getObject("/dataServices/schema/0/complexType"),function(i,e){if(e.name===n){t=e;return false;}});}return t;};O.prototype.getEntitySet=function(n){var s=null;if(n){q.each(this._oMeta.getObject("/dataServices/schema/0/entityContainer/0/entitySet"),function(i,e){if(e.name===n){s=e;return false;}});}return s;};O.prototype.getAssociation=function(n){var a=null;if(n){q.each(this._oMeta.getObject("/dataServices/schema/0/entityContainer/0/associationSet"),function(i,e){if(e.association===n){a=e;return false;}});}return a;};O.prototype.getAssociationTarget=function(a,n){var l,e;if(a&&n){l=a.end.length;while(l--){e=a.end[l];if(e.role===n.toRole){return e.entitySet;}}}return null;};O.prototype.getNameSpace=function(){return this._oMeta.getObject("/dataServices/schema/0/namespace");};O.prototype.getUnitOfMeasure=function(p,P,n,t){var u,c,s;if(p&&P&&n){u=p.extensions["sap:unit"];if(u){c=this.getProperty(P.replace(p.property.name,u),n,t);s=c.extensions["sap:semantics"];if(s==="currency-code"||s==="unit-of-measure"){return{unit:u,text:c.extensions["currency-text"]?c.extensions["currency-text"]:null,semantics:s,property:c};}}}return null;};O.prototype.getTextProperty=function(p,P,n,t){var T;if(p&&P&&n){T=p.extensions["sap:text"];if(T){return this.getProperty(P.replace(p.property.name,T),n,t);}}return null;};O.prototype.getValueListAnnotation=function(n,e,p,P){var s;if(p.complex){s=n+"."+p.typePath;}else{s=n+"."+e.name+"/"+P;}if(this.oAnalyzer){return this.oAnalyzer.getValueListAnnotation(s);}return null;};O.prototype.getUOMValueListAnnotation=function(m){var p;if(m.annotations.uom){if(m.property.complex){p=m.namespace+"."+m.property.typePath;p=p.replace(m.property.property.name,m.annotations.uom.property.property.name);}else{p=m.namespace+"."+m.entityType.name+"/"+m.annotations.uom.property.property.name;}}if(this.oAnalyzer&&p){m.annotations.valuelistuom=this.oAnalyzer.getValueListAnnotation(p);}};O.prototype.getAttributes=function(o,a,p){var r={},n,c=0,l,A,P;if(o&&a&&p){l=o[a].length;for(n in p){if(p[n]){c++;}}while(l--){if(c===0){return r;}A=o[a][l];P=p[A.name];if(A&&P&&A.namespace===P){r[A.name]=A.value;c--;}}}return r;};O.prototype.geValueListEntitySet=function(m){if(m&&m.annotations&&m.annotations.valuelist){if(m.annotations.valuelist.primaryValueListAnnotation&&m.annotations.valuelist.primaryValueListAnnotation.valueListEntitySetName){m.annotations.valuelistentityset=this.getEntitySet(m.annotations.valuelist.primaryValueListAnnotation.valueListEntitySetName);}}};O.prototype.destroy=function(){if(this.oAnalyzer){this.oAnalyzer.destroy();}this._oMeta=null;this._oAnalyzer=null;};return O;},true);
