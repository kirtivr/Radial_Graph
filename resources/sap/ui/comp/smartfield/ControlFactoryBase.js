/*
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2015 SAP SE. All rights reserved
 */
sap.ui.define(["jquery.sap.global","sap/ui/base/Object","sap/ui/comp/providers/ValueHelpProvider","sap/ui/comp/providers/ValueListProvider","sap/ui/comp/smartfield/BindingUtil"],function(q,B,V,a,b){"use strict";var C=B.extend("sap.ui.comp.smartfield.ControlFactoryBase",{constructor:function(m,p){B.apply(this,arguments);this.sName="ControlFactoryBase";this._oModel=m;this._oParent=p;this._oBinding=new b();this._aProviders=[];}});C.prototype.createControl=function(c){var o=this[this._getCreator(c)]();if(o.onCreate){this[o.onCreate](o.control,o.params);}return o;};C.prototype.addValidations=function(c,m){var s,e,t=this;s=function(S,E){var o,d=E.getSource();if(d){if(d.setValueState){d.setValueState(S);}o=E.getParameter("exception");if(o){if(d.setValueStateText){d.setValueStateText(o.message);}t._oParent.setValueStateText(o.message);}}t._oParent.setValueState(S);if(m){t._oParent[m](S===sap.ui.core.ValueState.Error);}};e=function(E){s(sap.ui.core.ValueState.Error,E);};c.attachFormatError(e);c.attachParseError(e);c.attachValidationError(e);c.attachValidationSuccess(function(E){s(sap.ui.core.ValueState.None,E);});};C.prototype.addValueHelp=function(c,p,v,m){var o,d,e,D;if(v.annotation&&v.annotation.primaryValueListAnnotation){e=this._oParent.getConfiguration();if(e){D=e.getDisplayBehaviour();}if(!D){D=this._oParent.data("defaultDropDownDisplayBehaviour");}if(!v.noDialog){if(c.setFilterSuggests){c.setFilterSuggests(false);}o=new V({annotation:v.annotation.primaryValueListAnnotation,additionalAnnotations:v.annotation.additionalAnnotations,control:c,model:m,preventInitialDataFetchInValueHelpDialog:true,takeOverInputValue:false,supportMultiSelect:false,supportRanges:false,fieldName:p.name,title:v.dialogtitle,displayBehaviour:D});this._aProviders.push(o);}if(c.setShowValueHelp){c.setShowValueHelp(true);}d=new a({control:c,typeAheadEnabled:!v.noTypeAhead,aggregation:v.aggregation,annotation:v.annotation.primaryValueListAnnotation,model:m,displayBehaviour:D});if(c.setShowSuggestion){c.setShowSuggestion(true);}this._aProviders.push(d);}};C.prototype.getAttribute=function(n){var i=this._oParent.getBindingInfo(n);if(i){return this._oBinding.toBindingPath(i);}return this._oParent["get"+n.substring(0,1).toUpperCase()+n.substring(1)]();};C.prototype.createAttributes=function(A,t,N,e){var c=this,n,i,m={};for(n in N){i=this._oParent.getBindingInfo(n);if(i){m[n]=this._oBinding.toBinding(i);}else{m[n]=this._oParent["get"+n.substring(0,1).toUpperCase()+n.substring(1)]();}}if(A){m[A]={model:this._oMetaData.model,path:this._oMetaData.path,type:t?this._oTypes.getType(t):null};}if(e){m[e.event]=function(p){try{c._oParent.fireChange({value:p.mParameters[e.parameter],newValue:p.mParameters[e.parameter]});}catch(d){q.sap.log.warning(d);}};}this.addObjectBinding(m);return m;};C.prototype.addObjectBinding=function(A,o){if(!o){o=this._oParent.getObjectBinding(this._oMetaData.model);}if(A&&o){A.objectBindings={};A.objectBindings[this._oMetaData.model]=o.sPath;}};C.prototype.getFormatSettings=function(f){var F,c,o,l;if(f){F=this._oParent.data(f);if(!F){c=this._oParent.getCustomData();if(c){l=c.length;while(l--){o=c[l];if(o.getKey()===f){F=o.getValue();break;}}}}if(F&&typeof(F)==="string"){try{F=JSON.parse(F);}catch(e){return null;}}}return F;};C.prototype.destroy=function(){var l=this._aProviders.length;while(l--){this._aProviders[l].destroy();}this._oBinding.destroy();this._oBinding=null;this._oParent=null;this._oModel=null;this._aProviders=[];};return C;},true);
