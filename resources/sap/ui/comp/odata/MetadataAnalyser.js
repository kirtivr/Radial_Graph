/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2015 SAP SE. All rights reserved
 */
sap.ui.define(['jquery.sap.global','sap/ui/model/odata/ODataModel'],function(q,O){"use strict";var M=function(r){if(typeof r==="object"){this.oModel=r;}else{this._sResourceRootUri=r;}this._oMetadata=null;if(!this.oModel&&this._sResourceRootUri){this.oModel=new O(this._sResourceRootUri);}if(this.oModel){this._oMetadata=this.oModel.getServiceMetadata();}if(this._oMetadata&&this._oMetadata.dataServices){this._oSchemaDefinition=this._oMetadata.dataServices.schema[0];}this.util={searchForKeyValue:M.searchForKeyValue,searchForAndGetAllKeyValue:M.searchForAndGetAllKeyValue,extractMatchingValue:M.extractMatchingValue};};M.prototype.getNamespace=function(){if(this._oSchemaDefinition){return this._oSchemaDefinition.namespace;}};M.prototype.getEntityContainerAttribute=function(a){var A=null,r;if(this._oSchemaDefinition&&this._oSchemaDefinition.entityContainer[0]&&this._oSchemaDefinition.entityContainer[0].extensions){r=this.util.searchForKeyValue(this._oSchemaDefinition.entityContainer[0].extensions,"name",a);if(r){A=r.value;}}return A;};M.prototype.getEntityLabelByEntityTypeName=function(e){var E=this._getEntityDefinition(e);if(E){var r=this.util.searchForKeyValue(E.extensions,"name","label");if(r){return r.value;}}return"";};M.prototype._getEntityDefinition=function(e){var E=null;if(e){e=this.removeNamespace(e);E=this.util.searchForKeyValue(this._oSchemaDefinition.entityType,"name",e);}return E;};M.prototype.removeNamespace=function(s){var n,r;n=this.getNamespace();if(s&&(s.indexOf(n+".")===0)){r=s.substring(n.length+1);}else{r=s;}return r;};M.prototype.getEntityTypeNameFromEntitySetName=function(e){var E=null,s=null;if(this._oSchemaDefinition&&this._oSchemaDefinition.entityContainer&&this._oSchemaDefinition.entityContainer[0]&&this._oSchemaDefinition.entityContainer[0].entitySet){E=this.util.searchForKeyValue(this._oSchemaDefinition.entityContainer[0].entitySet,"name",e);if(E){s=E.entityType;}}return s;};M.prototype.getEntitySetNameFromEntityTypeName=function(e){var E,o;if(this._oSchemaDefinition&&this._oSchemaDefinition.entityType){E=this.util.searchForKeyValue(this._oSchemaDefinition.entityType,"name",e);if(E){o=this.util.searchForKeyValue(this._oSchemaDefinition.entityContainer[0].entitySet,"entityType",E.entityType);if(o){return o.name;}}}return null;};M.prototype._getEntitySetSemantics=function(e){var E=null,r,s=null;if(this._oSchemaDefinition&&this._oSchemaDefinition.entityContainer&&this._oSchemaDefinition.entityContainer[0]&&this._oSchemaDefinition.entityContainer[0].entitySet){E=this.util.searchForKeyValue(this._oSchemaDefinition.entityContainer[0].entitySet,"name",e);if(E){r=this.util.searchForKeyValue(E.extensions,"name","semantics");if(r){s=r.value;}}}return s;};M.prototype.getKeysByEntitySetName=function(e){var k=null,E=null;if(!this._oMetadata){return undefined;}E=this.getEntityTypeNameFromEntitySetName(e);if(E){k=this.getKeysByEntityTypeName(E);}return k;};M.prototype.getKeysByEntityTypeName=function(e){var k=null,p=null,l=0,E=null;if(!this._oMetadata){return undefined;}E=this._getEntityDefinition(e);if(E){if(E.key){p=E.key.propertyRef;if(p){l=p.length;k=[];while(l--){k.push(p[l].name);}k=k.reverse();}}}return k;};M.prototype.getFieldsByEntitySetName=function(e){var f=null,E=null;if(!this._oMetadata){return undefined;}E=this.getEntityTypeNameFromEntitySetName(e);if(E){f=this.getFieldsByEntityTypeName(E);}return f;};M.prototype.getFieldsByEntityTypeName=function(e){var E;if(!this._oMetadata){return undefined;}E=this._getEntityDefinition(e);return this._getFieldsByEntityDefinition(E);};M.prototype.getFieldSemanticObjectMap=function(e){var m={};var o=this.getFieldsByEntitySetName(e);var i,l=o.length;for(i=0;i<l;i++){var f=o[i];var a=this.getSemanticObjectAnnotation(f.fullName);if(a&&a.semanticObject){m[f.name]=a.semanticObject;}}return m;};M.prototype._getFieldsByEntityDefinition=function(e){var f=null,l=0,p,r,R;if(e){f=e.property;}if(f){l=f.length;while(l--){p=f[l];r=this.util.extractMatchingValue(p.extensions,"name",["label","quickinfo","display-format","aggregation-role","unit","semantics","sortable","filterable","required-in-filter","filter-restriction","visible"]);if(r){R=r["label"];if(R){p.fieldLabel=R.value;}R=r["quickinfo"];if(R){p.quickInfo=R.value;}R=r["display-format"];if(R){p.displayFormat=R.value;}R=r["aggregation-role"];if(R){p.aggregationRole=R.value;}R=r["unit"];if(R){p.unit=R.value;}R=r["semantics"];if(R){p.semantics=R.value;}R=r["filter-restriction"];if(R){p.filterRestriction=R.value;}R=r["sortable"];p.sortable=R?R.value!=="false":true;R=r["filterable"];p.filterable=R?R.value!=="false":true;R=r["required-in-filter"];p.requiredField=R?R.value==="true":false;R=r["visible"];p.visible=R?R.value!=="false":true;p.entityName=e.name;p.fullName=this._getFullyQualifiedNameForField(p.name,e.name);}}}return f;};M.prototype.getAllFilterableFieldsByEntitySetName=function(e){var f=[],E=null;if(!this._oMetadata){return undefined;}E=this.getEntityTypeNameFromEntitySetName(e);if(E){f=this.getAllFilterableFieldsByEntityTypeName(E);}return f;};M.prototype.getAllFilterableFieldNamesByEntityTypeName=function(e){var g,i,a,j,f,r,G;r=[];g=this.getAllFilterableFieldsByEntityTypeName(e);if(g&&g.length){a=g.length;for(i=0;i<a;i++){G=g[i];if(G.fields&&G.fields.length){f=G.fields.length;for(j=0;j<f;j++){r.push(G.fields[j].name);}}}}return r;};M.prototype.getAllFilterableFieldsByEntityTypeName=function(e){var f=[],E=null,a=null,l=0,s=null;if(!this._oMetadata){return undefined;}E=this._getEntityDefinition(e);if(E){f.push(this._getFilterableFieldsFromEntityDefinition(E));a=this._getFilterableAssociations(E);l=a.length;while(l--){s=a[l];E=this._getEntityDefinition(s);f.push(this._getFilterableFieldsFromEntityDefinition(E));}}return f;};M.prototype._getFilterableFieldsFromEntityDefinition=function(e){var f={},F=[],p=null,P=null,i,l,o;if(!this._oMetadata||!e){return undefined;}o=this.util.searchForKeyValue(e.extensions,"name","label");if(o){f.groupLabel=o.value;}f.groupName=e.name;p=this._getFieldsByEntityDefinition(e);l=p.length;for(i=0;i<l;i++){P=p[i];if(P.filterable){F.push(P);}}f.fields=F;return f;};M.prototype._getFullyQualifiedNameForField=function(f,e){var n,r;n=this.getNamespace();if(n){r=n+"."+e+"/"+f;}else{r=e+"/"+f;}return r;};M.prototype.getFieldNameByFullyQualifiedFieldName=function(f){var r,n;r=this.removeNamespace(f);n=r.indexOf("/");r=r.substring(n+1);return r;};M.prototype._getFilterableAssociations=function(e){var n,f=[],r=null,N=null,o=null;var l=0,a=null,t=null;if(!this._oMetadata||!e){return undefined;}n=this.getNamespace();N=e.navigationProperty;if(N&&N.length){l=N.length;while(l--){o=N[l];r=o.relationship;if(r.indexOf(n+".")===0){r=r.substring(n.length+1);}a=this.util.searchForKeyValue(this._oSchemaDefinition.association,"name",r);if(!a){continue;}t=this.util.searchForKeyValue(a.end,"role",o.toRole);if(!t){continue;}if(t.multiplicity==="1"||t.multiplicity==="0..1"){f.push(t.type);}}}return f;};M.prototype.getValueListAnnotation=function(p){var a={additionalAnnotations:[]},A,o,r,l=0,i=0,P=null;if(this._oSchemaDefinition&&this._oSchemaDefinition.annotations){A=this.util.searchForAndGetAllKeyValue(this._oSchemaDefinition.annotations,"target",p);P=this.getFieldNameByFullyQualifiedFieldName(p);if(A){l=A.length;for(i=0;i<l;i++){o=A[i];if(o&&o.annotation){r=this.util.searchForKeyValue(o.annotation,"term","com.sap.vocabularies.Common.v1.ValueList");if(r){this._enrichValueHelpAnnotation(r,P);if(!o.qualifier&&!a.primaryValueListAnnotation){a.primaryValueListAnnotation=r;}else{r.qualifier=o.qualifier;a.additionalAnnotations.push(r);}}}}}}return a;};M.prototype.getSemanticObjectAnnotation=function(p){var a,A,r,l=0,i=0,R;if(this._oSchemaDefinition&&this._oSchemaDefinition.annotations){a=this.util.searchForAndGetAllKeyValue(this._oSchemaDefinition.annotations,"target",p);if(a){l=a.length;for(i=0;i<l;i++){A=a[i];if(A&&A.annotation){r=this.util.searchForKeyValue(A.annotation,"term","com.sap.vocabularies.Common.v1.SemanticObject");if(r){R=this.util.searchForKeyValue(r.extensions,"name","String");if(R){r.semanticObject=R.value;break;}}}}}}return r;};M.prototype._enrichValueHelpAnnotation=function(a,p){var r,R,k=[],K,I={},o={},b,c,f=[],v=[],d,P,V,l,e,L=0,i=0,F=0;if(a&&a.record){r=this.util.extractMatchingValue(a.record.propertyValue,"property",["CollectionPath","Label","SearchSupported","Parameters"]);if(r){R=r["SearchSupported"];a.isSearchSupported=R?R.bool==="true":false;R=r["CollectionPath"];if(R){a.valueListEntitySetName=R.string;a.valueListEntityName=this.removeNamespace(this.getEntityTypeNameFromEntitySetName(a.valueListEntitySetName));a.semantics=this._getEntitySetSemantics(a.valueListEntitySetName);k=this.getKeysByEntityTypeName(a.valueListEntityName);f=this.getFieldsByEntityTypeName(a.valueListEntityName);}R=r["Label"];if(R){a.valueListTitle=R.string;}R=r["Parameters"];if(f&&R&&R.collection){d=R.collection.record;L=d.length;}for(i=0;i<L;i++){e=d[i];V=undefined;l=undefined;r=this.util.extractMatchingValue(e.propertyValue,"property",["ValueListProperty","LocalDataProperty"]);P=r["ValueListProperty"];if(P){V=P.string;}P=r["LocalDataProperty"];if(P){l=P.propertyPath;}b=false;if(e.type==="com.sap.vocabularies.Common.v1.ValueListParameterInOut"||e.type==="com.sap.vocabularies.Common.v1.ValueListParameterIn"){b=true;}c=false;if(e.type==="com.sap.vocabularies.Common.v1.ValueListParameterInOut"||e.type==="com.sap.vocabularies.Common.v1.ValueListParameterOut"){c=true;}if(b){I[l]=V;}if(c){o[l]=V;}if(c||e.type==="com.sap.vocabularies.Common.v1.ValueListParameterDisplayOnly"){F=f.length;while(F--){if(f[F].name===V){v.push(f[F]);break;}}}if(!K&&c&&l===p){K=V;}}}a.inParams=I;a.outParams=o;a.fields=f;a.valueListFields=v;a.keys=k;a.keyField=K;a.descriptionField=this.getDescriptionFieldName(a.keyField,a.valueListEntitySetName);}};M.prototype.getDescriptionFieldName=function(k,e){var f,i=0,l,F,r,d;if(typeof k==="object"){F=k;}else{f=this.getFieldsByEntitySetName(e);if(f){l=f.length;for(i=0;i<l;i++){F=f[i];if(F.name===k){break;}}}}if(F){r=this.util.searchForKeyValue(F.extensions,"name","text");if(r){d=r.value;}}return d;};M.prototype.getIsSearchSupported=function(a){var i,p;i=false;if(a&&a.record&&a.record.propertyValue){p=this.util.searchForKeyValue(a.record.propertyValue,"property","SearchSupported");if(p&&p.bool==="true"){i=true;}}return i;};M.prototype.getLineItemAnnotation=function(p){var a,A,r,l=0,i=0;if(this._oSchemaDefinition&&this._oSchemaDefinition.annotations){p=this._getFullyQualifiedNameForEntity(p);a=this.util.searchForAndGetAllKeyValue(this._oSchemaDefinition.annotations,"target",p);if(a){l=a.length;for(i=0;i<l;i++){A=a[i];if(A&&A.annotation){r=this.util.searchForKeyValue(A.annotation,"term","com.sap.vocabularies.UI.v1.LineItem");if(r){break;}}}}if(r&&r.collection){this._enrichAnnotationWithUIDataField(r,r.collection.record);}}return r;};M.prototype.getFieldGroupAnnotation=function(p){var a,A,o,r,R,b,l=0,i=0;if(this._oSchemaDefinition&&this._oSchemaDefinition.annotations){p=this._getFullyQualifiedNameForEntity(p);a=this.util.searchForAndGetAllKeyValue(this._oSchemaDefinition.annotations,"target",p);if(a){l=a.length;for(i=0;i<l;i++){A=a[i];if(A&&A.annotation){b=this.util.searchForAndGetAllKeyValue(A.annotation,"term","com.sap.vocabularies.UI.v1.FieldGroup");if(b){break;}}}}if(b){l=b.length;for(i=0;i<l;i++){o=b[i];R=this.util.searchForKeyValue(o.extensions,"name","Qualifier");if(R){o.groupName=R.value;}if(o&&o.record&&o.record.propertyValue){r=this.util.extractMatchingValue(o.record.propertyValue,"property",["Label","Data"]);R=r["Label"];if(R){o.groupLabel=R.string;}R=r["Data"];if(R&&R.collection){this._enrichAnnotationWithUIDataField(o,R.collection.record);}}}}}return b;};M.prototype._enrichAnnotationWithUIDataField=function(a,r){var f=[],l={},R,p,F,P,L=0,i=0;if(r){L=r.length;f=[];l={};for(i=0;i<L;i++){P=r[i];if(P&&(P.type==="UI.DataField"||P.type==="com.sap.vocabularies.UI.v1.DataField")){F=null;R=this.util.extractMatchingValue(P.propertyValue,"property",["Value","Label"]);p=R["Value"];if(p){F=p.path;f.push(F);}if(F){p=R["Label"];if(p&&p.string){l[F]=p.string;}}}}a.fields=f;a.labels=l;}};M.prototype._getFullyQualifiedNameForEntity=function(e){var n,r;if(!e){return undefined;}n=this.getNamespace();if(n&&!(e.indexOf(n)>-1)){r=n+"."+e;}else{r=e;}return r;};M.extractMatchingValue=function(o,k,s){var r=null,a,i,l,S;if(o&&s){l=o.length;S=s.length;r={};for(i=0;i<l;i++){a=o[i];if(s.indexOf(a[k])>-1){if(!r[a[k]]){r[a[k]]=a;S--;}}if(S===0){break;}}}return r;};M.searchForKeyValue=function(o,k,v){var r=null,R=null;r=M.searchForAndGetAllKeyValue(o,k,v);if(r&&r.length){R=r[0];}return R;};M.searchForAndGetAllKeyValue=function(o,k,v){var r=null;if(o){r=q.grep(o,function(a){return a[k]===v;});}return r;};M.prototype.destroy=function(){this.oModel=null;this._oMetadata=null;this._oSchemaDefinition=null;this._sResourceRootUri=null;this.util=null;this.bIsDestroyed=true;};return M;},true);
