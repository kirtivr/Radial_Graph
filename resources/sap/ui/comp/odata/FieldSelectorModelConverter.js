/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2015 SAP SE. All rights reserved
 */
sap.ui.define(['jquery.sap.global','./MetadataAnalyser'],function(q,M){"use strict";var F=function(d){this._oMetadataAnalyzer=new M(d);this._aEntityTypes=[];};F.prototype.getMetaDataAnalyzer=function(){return this._oMetadataAnalyzer;};F.prototype.getConvertedModel=function(E,i){var c={};this._aEntityTypes=this._getEntityTypes(E);for(var e=0;e<this._aEntityTypes.length;e++){var f=this._oMetadataAnalyzer.getFieldsByEntityTypeName(this._aEntityTypes[e].key);if(f){c[this._aEntityTypes[e].key]=this._updateAndFilterFields(f,i);}}return c;};F.prototype.getEntityTypes=function(){return this._aEntityTypes;};F.prototype._updateAndFilterFields=function(a,i){var v=[];for(var f=0;f<a.length;f++){var c=a[f];if(c.visible===false){continue;}var I=this._isFieldOnIgnoreList(c,i);var b=this._isFieldBlacklisted(c);if(!I&&!b){v.push(c);}}return v;};F.prototype._isFieldOnIgnoreList=function(c,i){if(i){var n=this._aEntityTypes.length;var Q=c.entityName+"."+c.name;if(n===1){if(i.indexOf(c.name)!==-1||i.indexOf(Q)!==-1){return true;}}else if(i.indexOf(Q)!==-1){return true;}}return false;};F.prototype._isFieldBlacklisted=function(c){if(c){if(c.name.toLowerCase().indexOf("uxfc")===0){return true;}else if(c.type.toLowerCase()==="edm.time"){return true;}}return false;};F.prototype._getEntityTypes=function(E,a){var b=[];var l;var c;if(!this._oMetadataAnalyzer||!this._oMetadataAnalyzer._oSchemaDefinition){return[];}var A=this._oMetadataAnalyzer._oSchemaDefinition.entityType;if(!E){c=[];for(var t=0;t<A.length;t++){c.push(A[t].name);}}if(!c){c=this._convertEntityTypesToArray(E);}for(var e=0;e<c.length;e++){l=this._oMetadataAnalyzer.getEntityLabelByEntityTypeName(c[e]);b.push({key:c[e],label:l||c[e]});}return b;};F.prototype._convertEntityTypesToArray=function(e){if(typeof(e)==="string"){var r=e.replace(/ /g,'');return r.split(',');}if(q.isArray(e)){return e;}return undefined;};F.prototype.destroy=function(){if(this._oMetadataAnalyzer&&this._oMetadataAnalyzer.destroy){this._oMetadataAnalyzer.destroy();}this._oMetadataAnalyzer=null;this._aEntityTypes=null;};return F;},true);
