/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2015 SAP SE. All rights reserved
 */
sap.ui.define(['jquery.sap.global','sap/m/ActionSheet','sap/m/Bar','sap/m/Button','sap/m/ButtonType','sap/m/CheckBox','sap/m/CustomListItem','sap/m/Dialog','sap/m/Label','sap/m/LabelDesign','sap/m/Link','sap/m/List','sap/m/ListSeparators','sap/m/ListType','sap/m/Panel','sap/m/PlacementType','sap/m/SearchField','sap/m/Text','sap/m/Toolbar','sap/m/ToolbarSpacer','sap/ui/Device','./VariantConverterFrom','./VariantConverterTo','sap/ui/comp/library','sap/ui/comp/smartvariants/PersonalizableInfo','sap/ui/comp/smartvariants/SmartVariantManagement','sap/ui/comp/smartvariants/SmartVariantManagementUi2','sap/ui/comp/variants/VariantManagement','sap/ui/core/Icon','sap/ui/core/TextAlign','sap/ui/core/Title','sap/ui/core/ValueState','sap/ui/layout/Grid','sap/ui/layout/GridData','sap/ui/layout/HorizontalLayout','sap/ui/layout/ResponsiveFlowLayout','sap/ui/layout/ResponsiveFlowLayoutData','sap/ui/layout/VerticalLayout','sap/ui/layout/form/Form','sap/ui/layout/form/FormContainer','sap/ui/layout/form/FormElement','sap/ui/layout/form/ResponsiveGridLayout'],function(q,A,B,a,b,C,c,D,L,d,e,f,g,h,P,k,S,T,l,m,o,V,p,r,s,t,u,v,I,w,x,y,G,z,H,R,E,F,J,K,M,N){"use strict";var O=G.extend("sap.ui.comp.filterbar.FilterBar",{metadata:{library:"sap.ui.comp",properties:{persistencyKey:{type:"string",group:"Misc",defaultValue:null},advancedMode:{type:"boolean",group:"Misc",defaultValue:false},expandAdvancedArea:{type:"boolean",group:"Misc",defaultValue:false},searchEnabled:{type:"boolean",group:"Misc",defaultValue:true},filterBarExpanded:{type:"boolean",group:"Misc",defaultValue:true},considerGroupTitle:{type:"boolean",group:"Misc",defaultValue:false},showClearButton:{type:"boolean",group:"Misc",defaultValue:false},showRestoreButton:{type:"boolean",group:"Misc",defaultValue:true},showGoOnFB:{type:"boolean",group:"Misc",defaultValue:true},showRestoreOnFB:{type:"boolean",group:"Misc",defaultValue:false},showClearOnFB:{type:"boolean",group:"Misc",defaultValue:false},showGoButton:{type:"boolean",group:"Misc",defaultValue:null,deprecated:true}},aggregations:{filterItems:{type:"sap.ui.comp.filterbar.FilterItem",multiple:true,singularName:"filterItem"},filterGroupItems:{type:"sap.ui.comp.filterbar.FilterGroupItem",multiple:true,singularName:"filterGroupItem"}},events:{reset:{},search:{},beforeVariantSave:{},afterVariantLoad:{},filterChange:{},clear:{},initialise:{},afterVariantSave:{}}}});O.INTERNAL_GROUP="__$INTERNAL$";O.prototype.init=function(){this._oBasicAreaLayout=null;this._oAdvancedAreaForm=null;this._oAdvancedPanel=null;this._oVariantManagement=null;this._aBasicAreaSelection=null;this._mAdvancedAreaFilter=null;this._fRegisteredFetchData=null;this._fRegisteredApplyData=null;this._fRegisterGetFiltersWithValues=null;this._oHideShowButton=null;this._oSearchButton=null;this._oFiltersButton=null;this._oSearchButtonAdvanced=null;this._oClearButtonOnFB=null;this._oRestoreButtonOnFB=null;this._oDialog=null;this._oFilterDialog=null;this._oActionSheet=null;this._bInitialized=false;this._oVariant={};this._nFirstElementWidth=0;this._mChangedFilterItems=null;this._filterChangeSemaphore=true;this._fRegisteredFilterChangeHandlers=null;this._fInitialiseVariants=null;this._oRb=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");this.addStyleClass("sapUiCompFilterBar");if(this._isPhone()){this.addStyleClass("sapUiCompFilterBarPhone");}else{this.addStyleClass("sapUiCompFilterBarNonPhone");}this.addStyleClass("sapUiCompFilterBarMarginBottom");this.addStyleClass("sapUiCompFilterBarPaddingPanel");this._oToolbar=this._createToolbar();this._oToolbar.setLayoutData(new z({span:"L12 M12 S12"}));this.addContent(this._oToolbar);this._oBasicAreaLayout=this._createBasicAreaLayout();this._oBasicAreaLayout.setLayoutData(new z({span:"L12 M12 S12"}));this.addContent(this._oBasicAreaLayout);this._oAdvancedPanel=new P();this._oAdvancedPanel.setLayoutData(new z({span:"L12 M12 S12"}));this._oAdvancedPanel.setExpandable(false);this._oAdvancedPanel.setVisible(false);this._oAdvancedAreaForm=this._createAdvancedAreaForm();this._oAdvancedPanel.addContent(this._oAdvancedAreaForm);this.oAdvancedSearchArea=this._createBasicAreaLayout();this._oAdvancedPanel.addContent(this.oAdvancedSearchArea);this.addContent(this._oAdvancedPanel);q(window).on("resize.basicsearch",q.proxy(this._fHandleResize,this));this.oModel=new sap.ui.model.json.JSONModel({});this.setModel(this.oModel,"FilterBar");this.setFilterBarExpanded(this._isTablet()?false:this.getFilterBarExpanded());};O.prototype.setShowClearOnFB=function(i){if(!this._isPhone()){this.setProperty("showClearOnFB",i);this._oClearButtonOnFB.setVisible(i);}};O.prototype.setShowRestoreOnFB=function(i){if(!this._isPhone()){this.setProperty("showRestoreOnFB",i);this._oRestoreButtonOnFB.setVisible(i);}};O.prototype.setShowGoOnFB=function(i){this.setProperty("showGoOnFB",i);this._oSearchButton.setVisible(i);};O.prototype.setShowGoButton=function(i){this.setShowGoOnFB(i);};O.prototype.getShowGoButton=function(){return this.getShowGoOnFB();};O.prototype.setCurrentVariantId=function(i,j){if(this._oVariantManagement){this._oVariantManagement.setCurrentVariantId(i,j);}};O.prototype.getCurrentVariantId=function(){var i="";if(this._oVariantManagement){i=this._oVariantManagement.getCurrentVariantId();}return i;};O.prototype.getDataSuiteFormat=function(i){var j=null;var n,Q,U;if(this._oVariantManagement){n=this.getCurrentVariantId();if(this.getFilterDataAsString){U=this._determineVariantFiltersInfo(i);Q=this.getFilterDataAsString(i);if(Q){var W=new p();j=W.convert(n,U,Q,this);}}}return j;};O.prototype.getCurrentVariant=function(i){return this.getDataSuiteFormat(i);};O.prototype.setDataSuiteFormat=function(i,j){var n;if(i){var Q=new V();n=Q.convert(i,this);if(n&&this.setFilterDataAsString){this._setConsiderFilterChanges(false);this.setFilterDataAsString(n,j);this._setConsiderFilterChanges(true);}}};O.prototype.setCurrentVariant=function(i,j){this.setDataSuiteFormat(i,j);};O.prototype.setPersistencyKey=function(i){this.setProperty("persistencyKey",i);this._oVariantManagement.setVisible(!this.getAdvancedMode());};O.prototype.clearVariantSelection=function(){if(this._oVariantManagement){this._oVariantManagement.clearVariantSelection();}};O.prototype.setSearchButtonEmphType=function(i){};O.prototype.setSearchEnabled=function(i){this.setProperty("searchEnabled",i);if(this._oSearchButton){this._oSearchButton.setEnabled(i);}};O.prototype.setSimplifiedMode=function(i){};O.prototype.getSimplifiedMode=function(i){if(this.getAdvancedMode()){return false;}return true;};O.prototype.setExpandAdvancedArea=function(i){this.setProperty("expandAdvancedArea",i);if(this._oAdvancedPanel.getVisible()){this._oAdvancedPanel.setExpanded(i);}};O.prototype.getExpandAdvancedArea=function(){if(this._oAdvancedPanel.getVisible()){return this._oAdvancedPanel.getExpanded();}return false;};O.prototype._switchButtons=function(i){if(i){if(!this._oSearchButtonAdvanced){this._oSearchButtonAdvanced=this._oSearchButton.clone();this._oSearchButtonAdvanced.setText(this._oRb.getText("FILTER_BAR_SEARCH"));this._oSearchButtonAdvanced.setVisible(true);}this._initializeSearchButtonsLocation();}else{this._oBasicAreaLayout.removeContent(this._oSearchButtonAdvanced);this.oAdvancedSearchArea.removeContent(this._oSearchButtonAdvanced);}this._oToolbar.setVisible(!i);};O.prototype._initializeSearchButtonsLocation=function(){var i,j=0;if(this._oSearchButtonAdvanced){this._oSearchButtonAdvanced.setVisible(true);if(this._mAdvancedAreaFilter&&this._mAdvancedAreaFilter[O.INTERNAL_GROUP]&&this._mAdvancedAreaFilter[O.INTERNAL_GROUP].items&&this._mAdvancedAreaFilter[O.INTERNAL_GROUP].items.length>0){i=this._oBasicAreaLayout.getContent();if(i.length>0){j=i.length-1;}this._oBasicAreaLayout.insertContent(this._oSearchButtonAdvanced,j);}else{this._oSearchButtonAdvanced.addStyleClass("sapUiCompFilterBarFloatRight");this.oAdvancedSearchArea.addContent(this._oSearchButtonAdvanced);this.oAdvancedSearchArea.setVisible(true);}}};O.prototype.setAdvancedMode=function(j){this.setProperty("advancedMode",j);this.setFilterBarExpanded(j);this._oFiltersButton.setVisible(!j);this._switchButtons(j);if(!j){if(this.getPersistencyKey()){this._oVariantManagement.setVisible(true);}return;}var i,n=null;var Q;this._oVariantManagement.setVisible(false);for(n in this._mAdvancedAreaFilter){if(n){Q=this._mAdvancedAreaFilter[n];if(Q&&Q.items){for(i=0;i<Q.items.length;i++){Q.items[i].filterItem.setVisibleInFilterBar(true);}}}}};O.prototype.addFilterItem=function(i){var n;var j;if(!i){throw new Error("sap.ui.comp.filterbar.FilterBar.prototype.addFilterItem()"+" Expected argument 'oFilterItem' may not be null nor empty");}n=i.getName();if(!n){throw new Error("sap.ui.comp.filterbar.FilterBar.prototype.addFilterItem()"+" Expected argument 'oFilterItem.name' may not be null nor empty");}j=i.getControl();if(!j){throw new Error("sap.ui.comp.filterbar.FilterBar.prototype.addFilterItem()"+" Expected argument 'oFilterItem.control' may not be null nor empty");}this.addAggregation("filterItems",i,true);if(!this._aBasicAreaSelection){this._aBasicAreaSelection=[];}var Q={control:i.getControl(),filterItem:i};this._aBasicAreaSelection.push(Q);if(this.getAdvancedMode()){var U=this._addControlToBasicAreaFormContainer(i);if(U){U.setVisible(i.getVisible());i.attachChange(this._filterItemChange.bind(this,U));Q.container=U;}}else{var W=new sap.ui.comp.filterbar.FilterGroupItem({label:i.getLabel(),labelTooltip:i.getLabelTooltip(),name:i.getName(),mandatory:i.getMandatory(),visible:i.getVisible(),visibleInFilterBar:i.getVisibleInFilterBar(),partOfCurrentVariant:true,control:i.getControl(),groupName:O.INTERNAL_GROUP,groupTitle:""});if(i.data('isCustomField')){W.data('isCustomField',true);}i.attachChange(this._filterItemChange.bind(this,null));this.addFilterGroupItem(W);}};O.prototype.addFilterGroupItem=function(i){if(!i){throw new Error("sap.ui.comp.filterbar.FilterBar.prototype.addFilterGroupItem()"+" Expected argument 'oFilterGroupItem' may not be null nor empty");}this.addAggregation("filterGroupItems",i,true);var j=i.getGroupName();if(!j){throw new Error("sap.ui.comp.filterbar.FilterBar.prototype.addFilterGroupItems()"+" GroupName may not be null nor empty");}var n=i.getName();if(!n){throw new Error("sap.ui.comp.filterbar.FilterBar.prototype.addFilterGroupItems()"+" Name may not be null nor empty");}if(!this._mAdvancedAreaFilter){this._mAdvancedAreaFilter={};}if(!this._mAdvancedAreaFilter[j]){this._mAdvancedAreaFilter[j]={};this._mAdvancedAreaFilter[j].filterItem=i;this._mAdvancedAreaFilter[j].items=[];}var Q={control:i.getControl(),filterItem:i};if(this.getAdvancedMode()||i.getVisibleInFilterBar()){i.setVisibleInFilterBar(true);}else{i.setVisibleInFilterBar(false);}this._mAdvancedAreaFilter[j].items.push(Q);if(this.getAdvancedMode()){this._rerenderAA();i.attachChange(this._filterGroupItemChange.bind(this));}else{var U=this._addControlToBasicAreaFormContainer(i);if(U){Q.container=U;U.setVisible(i.getVisible()&&i.getVisibleInFilterBar());if(i.getVisibleInFilterBar()){i.setPartOfCurrentVariant(i.getVisibleInFilterBar());}i.attachChange(this._filterGroupItemChange.bind(this));}}};O.prototype._filterItemChange=function(i,j){var n;var Q;if(j&&j.oSource&&(j.oSource instanceof sap.ui.comp.filterbar.FilterItem)){var U=j.getParameter("propertyName");if(this.getAdvancedMode()&&(U==="visible")){i.setVisible(Q);return;}if(U==="visibleInFilterBar"||U==="visible"||U==="label"||U==="mandatory"){n=this._determineItemByName(j.oSource.getName(),O.INTERNAL_GROUP);if(n&&n.filterItem){if((U==="visible")){Q=j.oSource.getVisible();n.filterItem.setVisible(Q);}else if(U==="visibleInFilterBar"){Q=j.oSource.getVisibleInFilterBar();var W=this._checkChangePossibleVisibleInFilterBar(n.filterItem,Q);if(W){n.filterItem.setVisibleInFilterBar(Q);}else{j.oSource.setVisibleInFilterBar(true);}}else if(U==="label"){n.filterItem.setLabel(j.oSource.getLabel());}else if(U==="mandatory"){Q=j.oSource.getMandatory();n.filterItem.setMandatory(Q);}}}}};O.prototype._filterGroupItemChange=function(i){var j;var n;if(this.getAdvancedMode()){this._rerenderAA();return;}if(i&&i.oSource){n=i.getParameter("propertyName");if(n==="visibleInFilterBar"||n==="visible"){j=this._determineItemByName(i.oSource.getName(),i.oSource.getGroupName());if(j){if(n==="visibleInFilterBar"){var Q=i.oSource.getVisibleInFilterBar();var U=this._checkChangePossibleVisibleInFilterBar(i.oSource,Q);if(!U){i.oSource.setVisibleInFilterBar(true);Q=true;}if(Q){i.oSource.setPartOfCurrentVariant(true);}this._rerenderItem(j);this._adaptLinkText(i.oSource.getGroupName());}else if(n==="visible"){this._updateToolbarText();this._rerenderGroup(j,i.oSource.getGroupName());}}}else if(n==="groupTitle"){if(this._mAdvancedAreaFilter&&this._mAdvancedAreaFilter[i.oSource.getGroupName()]){if(this._mAdvancedAreaFilter[i.oSource.getGroupName()].formcontainer){this._mAdvancedAreaFilter[i.oSource.getGroupName()].formcontainer.setTitle(i.oSource.getGroupTitle());}else{this._adaptGroupTitle(i.oSource.getGroupName());}}}else if(n==="label"){if(!this._mAdvancedAreaFilter[i.oSource.getGroupName()].formcontainer){this._adaptGroupTitleForFilter(i.oSource);}}else if(n==="mandatory"){if(this._oFilterDialog){this._adaptMandatoryForFilter(i.oSource);}}}};O.prototype._checkChangePossibleVisibleInFilterBar=function(i,j){if(i&&i.getMandatory()&&!j){var n=this._hasFilterValue(i);if(!n){i.setVisibleInFilterBar(true);return false;}}return true;};O.prototype._adaptLinkText=function(i){if(this._mAdvancedAreaFilter&&this._mAdvancedAreaFilter[i]&&this._mAdvancedAreaFilter[i].link){this._setLinkText(i,this._mAdvancedAreaFilter[i].link);}};O.prototype._hasFilterValue=function(i){var j=this._getFiltersWithValues();return this._checkFilterForValue(j,i);};O.prototype._adaptMandatoryForFilter=function(i){var j;var n=i.getGroupName();if(i){j=this._determineItemByName(i.getName(),n);if(j&&j.checkbox&&j.checkbox.getVisible()){var Q=true;if(i.getMandatory()){var U=this._hasFilterValue(i);if(!U){Q=false;i.setVisibleInFilterBar(true);}}j.checkbox.setEnabled(Q);}}};O.prototype._adaptGroupTitleForFilter=function(i){var j;var n;if(i){j=i.getLabel();n=i.getLabelControl();if(this.getConsiderGroupTitle()){if(n&&i.getGroupTitle()){n.setText(j+" ("+i.getGroupTitle()+')');}}else{n.setText(j);}}};O.prototype._adaptGroupTitle=function(j){var i;var n;if(this._mAdvancedAreaFilter&&this._mAdvancedAreaFilter[j]&&this._mAdvancedAreaFilter[j].items){for(i=0;i<this._mAdvancedAreaFilter[j].items.length;i++){n=this._mAdvancedAreaFilter[j].items[i];if(n&&n){this._adaptGroupTitleForFilter(n.filterItem);}}}};O.prototype._adaptGroupsTitle=function(){var n=null;if(this._mAdvancedAreaFilter){for(n in this._mAdvancedAreaFilter){if(n&&n!==O.INTERNAL_GROUP){this._adaptGroupTitle(n);}}}};O.prototype.registerGetFiltersWithValues=function(i){this._fRegisterGetFiltersWithValues=i;};O.prototype.registerFetchData=function(i){this._fRegisteredFetchData=i;};O.prototype.registerApplyData=function(i){this._fRegisteredApplyData=i;};O.prototype._isTINAFScenario=function(){if(this._oVariantManagement&&(this._oVariantManagement instanceof t)){return true;}return false;};O.prototype.fireInitialise=function(){if(this._isTINAFScenario()){this._fireInitialiseEvent();}else{this._initializeVariantManagement();}};O.prototype._initializeVariantManagement=function(){if(this._oVariantManagement&&this.getPersistencyKey()){this._fInitialiseVariants=q.proxy(this._initialiseVariants,this);this._oVariantManagement.attachInitialise(this._fInitialiseVariants);this._oVariantManagement.initialise();}else{this._fireInitialiseEvent();}};O.prototype._fireInitialiseEvent=function(){this.fireEvent("initialise");this._bInitialized=true;};O.prototype._initialiseVariants=function(){this._fireInitialiseEvent();if(this._oVariantManagement){this._oVariantManagement.currentVariantSetModified(false);}};O.prototype.fireAfterVariantLoad=function(){this._rerenderFilters();this._mChangedFilterItems=null;this.fireEvent("afterVariantLoad");};O.prototype.removeAllFilterItems=function(){var i;var j;this._aBasicAreaSelection=null;var n=this._oBasicAreaLayout.getContent();if(n){for(i=0;i<n.length;i++){this._oBasicAreaLayout.removeContent(n[i]);}}j=this.getFilterItems();if(this._mAdvancedAreaFilter){if((this._mAdvancedAreaFilter[O.INTERNAL_GROUP])&&(this._mAdvancedAreaFilter[O.INTERNAL_GROUP].items)){for(i=0;i<this._mAdvancedAreaFilter[O.INTERNAL_GROUP].items.length;i++){if(this._mAdvancedAreaFilter[O.INTERNAL_GROUP].items[i].filterItem){j.push(this._mAdvancedAreaFilter[O.INTERNAL_GROUP].items[i].filterItem);}}delete this._mAdvancedAreaFilter[O.INTERNAL_GROUP];}if(Object.keys(this._mAdvancedAreaFilter).length===0){this._mAdvancedAreaFilter=null;}}this._destroyItems(j);};O.prototype.removeAllFilterGroupItems=function(){var n=null,i;var j=[];this._oAdvancedPanel.setVisible(false);this._oAdvancedAreaForm.removeAllFormContainers();for(n in this._mAdvancedAreaFilter){if(n){if(this._mAdvancedAreaFilter[n]&&this._mAdvancedAreaFilter[n].items){for(i=0;i<this._mAdvancedAreaFilter[n].items.length;i++){if(this._mAdvancedAreaFilter[n].items[i].filterItem){j.push(this._mAdvancedAreaFilter[n].items[i].filterItem);}}delete this._mAdvancedAreaFilter[n];}}if(Object.keys(this._mAdvancedAreaFilter).length===0){this._mAdvancedAreaFilter=null;}}this._destroyItems(j);};O.prototype.getAllFilterItems=function(j){var i,n=null;var Q=[];var U,W;if(this.getAdvancedMode()){if(this._aBasicAreaSelection){for(i=0;i<this._aBasicAreaSelection.length;i++){W=this._aBasicAreaSelection[i];if(W&&W.filterItem&&W.filterItem.getVisible()){Q.push(W.filterItem);}}}}if(this._mAdvancedAreaFilter){for(n in this._mAdvancedAreaFilter){if(n){U=this._mAdvancedAreaFilter[n];if(U.items){for(i=0;i<U.items.length;i++){W=U.items[i];if(W&&W.filterItem&&W.filterItem.getVisible()){if(j){if(W.filterItem.getVisibleInFilterBar()||W.filterItem.getPartOfCurrentVariant()){Q.push(W.filterItem);}}else{Q.push(W.filterItem);}}}}}}}return Q;};O.prototype._clearErrorState=function(){var i;var j;var n=this.determineMandatoryFilterItems();if(n){for(i=0;i<n.length;i++){j=this.determineControlByFilterItem(n[i]);if(j&&j.setValueState){j.setValueState(y.None);}}}};O.prototype._destroyItems=function(j){if(j&&j.length){for(var i=0;i<j.length;i++){j[i].destroy();}}};O.prototype._reapplyVisibility=function(j){var i,n=null;var Q;if(this._mAdvancedAreaFilter){for(n in this._mAdvancedAreaFilter){if(n){var U=this._mAdvancedAreaFilter[n];if(U&&U.items){for(i=0;i<U.items.length;i++){Q=U.items[i];if(Q&&Q.filterItem){this._setPersVisibility(j,Q.filterItem);}}if(n!==O.INTERNAL_GROUP){this._adaptLinkText(n);}}}}}};O.prototype._setPersVisibility=function(i,j){var n,Q;var U;if(j){Q=j.getName();n=j.getGroupName();U=this._checkForFilterInfo(i,Q);if(this._isTINAFScenario()){if(U){j.setVisibleInFilterBar((U.visibleInFilterBar));j.setPartOfCurrentVariant((U.partOfCurrentVariant));}}else{if(U&&(U.visibleInFilterBar!==undefined)){j.setVisibleInFilterBar((U.visibleInFilterBar));j.setPartOfCurrentVariant((U.partOfCurrentVariant));}else{if((n!==O.INTERNAL_GROUP)&&U&&(U.group===n)){j.setVisibleInFilterBar((U!==null));}}}}};O.prototype._checkForFilterInfo=function(j,n){var i;var Q=null;if(j&&j.length){for(i=0;i<j.length;i++){if(j[i].name===n){Q=j[i];break;}}}return Q;};O.prototype._createVariantManagement=function(){var i=new u({});var j=new s({type:"filterBar",keyName:"persistencyKey"});j.setControl(this);i.addPersonalizableControl(j);i.addStyleClass("sapUiCompFilterBarMarginLeft");return i;};O.prototype._getFiltersWithValues=function(){if(this._fRegisterGetFiltersWithValues){try{return this._fRegisterGetFiltersWithValues();}catch(i){q.sap.log.error("callback for obtaining the filter count throws an exception");}}return null;};O.prototype._getFiltersWithValuesCount=function(){var i,n=0;var j=this._getFiltersWithValues();if(j){for(i=0;i<j.length;i++){if(j[i].getVisible()&&(j[i].getVisibleInFilterBar()||j[i].getPartOfCurrentVariant())){n++;}}}return n;};O.prototype._checkFilterForValue=function(j,n){var i;if(j){for(i=0;i<j.length;i++){if(j[i]===n){return true;}}}return false;};O.prototype._toggleHideShow=function(){this.setFilterBarExpanded(!this.getFilterBarExpanded());};O.prototype._updateToolbarText=function(){var n=this._getFiltersWithValuesCount();var i=n?(this._oRb.getText("FILTER_BAR_ACTIVE_FILTERS",[n])):(this._oRb.getText("FILTER_BAR_ACTIVE_FILTERS_ZERO"));this._oFiltersButton.setText(i);};O.prototype.setFilterBarExpanded=function(i){var j=this._isPhone()?false:i;this.setProperty("filterBarExpanded",j);if(this._isPhone()){this._oHideShowButton.setVisible(false);this._oSearchButton.setVisible(this.getShowGoOnFB());if(this.getAdvancedMode()){this._oBasicAreaLayout.setVisible(true);}else{this._oBasicAreaLayout.setVisible(false);}}else{if(j){this._oHideShowButton.setText(this._oRb.getText("FILTER_BAR_HIDE"));}else{this._oHideShowButton.setText(this._oRb.getText("FILTER_BAR_SHOW"));}this._oHideShowButton.setVisible(true);this._oSearchButton.setVisible(this.getShowGoOnFB());this._oBasicAreaLayout.setVisible(j);}this._updateToolbarText();};O.prototype._selectionChangedInFilterDialog=function(i,j){j.setVisibleInFilterBar(i.getSelected());if(this._getConsiderFilterChanges()&&this._oVariantManagement&&this._oVariantManagement.getEnabled()){this._oVariantManagement.currentVariantSetModified(true);}};O.prototype._mandatoryFilterChange=function(i){if(!i){return;}var j=i.getParameters();if(!j||!j.oSource){return;}var n=this._determineByControl(j.oSource);if(n&&n.checkbox){var Q=n.filterItem;if(!Q.getMandatory()){return;}var U=this._hasFilterValue(Q);if(Q.getVisibleInFilterBar()){if(U){n.checkbox.setEnabled(true);}else{n.checkbox.setEnabled(false);}}else{if(!U){Q.setVisibleInFilterBar(true);n.checkbox.setSelected(true);n.checkbox.setEnabled(false);}}}};O.prototype._createFiltersAndAdaptBasicArea=function(){var i;this._setConsiderFilterChanges(false);this._recreateBasicAreaContainer(true);i=this._createFilters();this._setConsiderFilterChanges(true);return i;};O.prototype._determineNotAssignedFiltersCount=function(j){var n=0,i;var Q;if(this._mAdvancedAreaFilter[j]&&this._mAdvancedAreaFilter[j].items){for(i=0;i<this._mAdvancedAreaFilter[j].items.length;i++){Q=this._mAdvancedAreaFilter[j].items[i].filterItem;if(!Q.getVisible()){continue;}if(!Q.getPartOfCurrentVariant()&&!Q.getVisibleInFilterBar()){n++;}}}return n;};O.prototype._rerenderGroup=function(j,n){var i;var Q;this._rerenderItem(j);this._adaptLinkText(n);if(j.formelement){if(this._mAdvancedAreaFilter[n]&&this._mAdvancedAreaFilter[n].items&&this._mAdvancedAreaFilter[n].formcontainer){for(i=0;i<this._mAdvancedAreaFilter[n].items.length;i++){Q=this._mAdvancedAreaFilter[n].items[i].filterItem;if(Q&&Q.getVisible()){this._mAdvancedAreaFilter[n].formcontainer.setVisible(true);return;}}this._mAdvancedAreaFilter[n].formcontainer.setVisible(false);}}};O.prototype._setLinkTextAndCount=function(i,j,n){var Q;if(n){Q=this._oRb.getText("FILTER_BAR_SHOW_MORE_FILTERS",[n]);}else{Q=this._oRb.getText("FILTER_BAR_SHOW_CHANGE_FILTERS");}j.setText(Q);};O.prototype._setLinkText=function(i,j){var n=this._determineNotAssignedFiltersCount(i);this._setLinkTextAndCount(i,j,n);};O.prototype._createLink=function(i){var j=this;var n=new e();this._setLinkText(i,n);n.attachPress(function(){j._createAddRemoveFiltersDialog(i,n);});return n;};O.prototype._isPhone=function(){return(o.system.phone)?true:false;};O.prototype._isTablet=function(){return(o.system.tablet)?true:false;};O.prototype._createFilters=function(){var j=this;var n=null,i;var Q;var U,W,X,Y;var Z,$,_;var a1=null;var b1;var c1=null;var d1=true;var e1;var f1=new N();f1.setColumnsL(1);f1.setColumnsM(1);var g1=new J({editable:true,layout:f1});g1.addStyleClass("sapUiCompFilterBarDialogForm");if(this._oVariantManagement){var h1=this._oToolbar.indexOfContent(this._oVariantManagement);if(h1>=0){var i1=this._oVariantManagement.clone();i1._setSelectionByKey(this._oVariantManagement.getSelectionKey());this._oToolbar.removeContent(this._oVariantManagement);this._oToolbar.insertContent(i1,h1);this._oVariant.key=this._oVariantManagement.getSelectionKey();this._oVariant.modified=this._oVariantManagement.currentVariantGetModified();U=new K();this._oVariantManagement.setLayoutData(new z({span:"L10 M10 S12"}));W=new M({fields:this._oVariantManagement});U.addFormElement(W);if(!this._isPhone()){c1=new L({});c1.setLayoutData(new z({span:"L2 M2 S2"}));c1.addStyleClass("sapUiCompFilterBarAddFilterLabel");this._oAddToFilterBarLabel=c1;W=new M({label:c1});U.addFormElement(W);}g1.addFormContainer(U);}g1.addStyleClass("sapUiCompFilterBarGroupTitle");}var j1=this._getFiltersWithValues();this._fRegisteredFilterChangeHandlers=function(k1){j._mandatoryFilterChange(k1);};this.attachFilterChange(this._fRegisteredFilterChangeHandlers);this._oVariant.content=this.fetchVariant();for(n in this._mAdvancedAreaFilter){if(n&&this._mAdvancedAreaFilter[n].items){Z=new x();if(n===O.INTERNAL_GROUP){this._oTitle=Z;Q=this._oRb.getText("FILTER_BAR_BASIC_GROUP");}else{Q=this._mAdvancedAreaFilter[n].filterItem.getGroupTitle();}Z.setText(Q);U=new K({title:Z});if(d1&&Q===""&&c1){c1.removeStyleClass("sapUiCompFilterBarAddFilterLabel");c1.addStyleClass("sapUiCompFilterBarAddFilterLabelNoGroup");}d1=false;e1=0;this._mAdvancedAreaFilter[n].formcontainer=U;for(i=0;i<this._mAdvancedAreaFilter[n].items.length;i++){Y=this._mAdvancedAreaFilter[n].items[i];if(Y.control.getWidth){Y.width=Y.control.getWidth();if(Y.control.setWidth){Y.control.setWidth("100%");}}_=Y.filterItem.getLabelControl();if(this.getConsiderGroupTitle()){_.setText(Y.filterItem.getLabel());}a1=new C({tooltip:this._oRb.getText("FILTER_BAR_SHOW_IN_FILTERBAR")});a1.setSelected(Y.filterItem.getVisibleInFilterBar());if(Y.filterItem.getMandatory()){b1=this._checkFilterForValue(j1,Y.filterItem);if(!b1&&Y.filterItem.getVisibleInFilterBar()){a1.setEnabled(false);}}a1.attachSelect(q.proxy(this._selectionChangedInFilterDialog,this,a1,Y.filterItem));if(this._isPhone()){_.setLayoutData(new z({span:"L3 M3 S12"}));Y.control.setLayoutData(new z({span:"L8 M8 S12"}));a1.setVisible(false);}else{_.setLayoutData(new z({span:"L3 M3 S12"}));Y.control.setLayoutData(new z({span:"L8 M8 S11"}));a1.setLayoutData(new z({span:"L1 M1 S1"}));}W=new M({label:_,fields:[Y.control,a1]});W.setVisible(Y.filterItem.getVisible()&&(Y.filterItem.getVisibleInFilterBar()||Y.filterItem.getPartOfCurrentVariant()));if(!Y.filterItem.getVisible()){e1++;}Y.formelement=W;Y.checkbox=a1;U.addFormElement(W);}X=U.getFormElements();if(X&&X.length>0){if(n!==O.INTERNAL_GROUP){$=this._createLink(n);if($){if(this._isPhone()){$.setLayoutData(new z({span:"L8 M8 S12"}));}else{$.setLayoutData(new z({span:"L8 M8 S12",indent:"L3 M3 S0"}));}W=new M({fields:[$]});this._mAdvancedAreaFilter[n].link=$;U.addFormElement(W);}if(e1===X.length){U.setVisible(false);}}g1.addFormContainer(U);}}}return g1;};O.prototype._recreateBasicAreaContainer=function(U){var n=null,i;var j,Q;var W,X;if(this._oVariantManagement){var Y=this._oToolbar.getContent();this._oToolbar.removeContent(Y[0]);this._oToolbar.insertContent(this._oVariantManagement,0);}this._oBasicAreaLayout.removeAllContent();for(n in this._mAdvancedAreaFilter){if(n&&this._mAdvancedAreaFilter[n].items){for(i=0;i<this._mAdvancedAreaFilter[n].items.length;i++){W=this._mAdvancedAreaFilter[n].items[i].filterItem;if(U){if(!W.getVisible()||!W.getVisibleInFilterBar()){continue;}j=this._mAdvancedAreaFilter[n].items[i].control.clone();Q=W.getLabelControl().clone();if(this.getConsiderGroupTitle()){W.getLabelControl().setText(W.getLabel());}}else{j=this._mAdvancedAreaFilter[n].items[i].control;Q=W.getLabelControl();if(this._mAdvancedAreaFilter[n].items[i].width){j.setWidth(this._mAdvancedAreaFilter[n].items[i].width);}}X=this._addControlToBasicAreaContainer(W,j,Q);if(X){X.setVisible(W.getVisible()&&W.getVisibleInFilterBar());this._mAdvancedAreaFilter[n].items[i].container=X;}}}}};O.prototype._searchRequested=function(i){if(this.search()){this._oFilterDialog.close();}};O.prototype._closeDialogAndRestoreFilterBar=function(i){this._sSearchCriteriaInFiltersDialog=null;this._oVariant={};i.removeAllFormContainers();if(this._oActionSheet){this._oActionSheet.destroy();this._oActionSheet=null;}this._recreateBasicAreaContainer();this._deleteProperties();this._adaptGroupsTitle();if(this._fRegisteredFilterChangeHandlers){this.detachFilterChange(this._fRegisteredFilterChangeHandlers);this._fRegisteredFilterChangeHandlers=null;}this._updateToolbarText();};O.prototype._variantSave=function(i){var j;this._oVariant={};this.fireBeforeVariantSave();if(this._oVariantManagement&&this._oFilterDialog){j=this._oVariantManagement.getSelectionKey();this._oVariant.key=j;this._oVariant.modified=false;this._oVariant.content=this._oVariantManagement.getVariantContent(this,j);}};O.prototype._afterVariantSave=function(i){this.fireAfterVariantSave();};O.prototype._variantSavePressed=function(i){if(this._oVariantManagement){var j=this._oVariantManagement.getSelectionKey();var n=this._oVariantManagement.getItemByKey(this._oVariantManagement.getSelectionKey());if((j===this._oVariantManagement.STANDARDVARIANTKEY)||(n&&n.getReadOnly&&n.getReadOnly())){this._oVariantManagement._openSaveAsDialog();}else{this._oVariantManagement._variantSavePressed();}}};O.prototype._dialogOpened=function(){if(this._oTitle&&this._oAddToFilterBarLabel){var i=this._getDOMElement(this._oTitle.getId());if(i){var j=i.offset();var n=this._getDOMElement(this._oAddToFilterBarLabel.getId());if(n){var Q=n.offset();if(Q&&j){Q.top=j.top+8;n.offset(Q);}}}}if(this._oAddToFilterBarLabel){this._oAddToFilterBarLabel.setText(this._oRb.getText("FILTER_BAR_SHOW_IN_FILTERBAR"));}};O.prototype._cancelFilterDialog=function(){if(this._oVariant&&this._oVariant.key&&this._oVariant.content){this.applyVariant(this._oVariant.content);if(this._oVariantManagement){this._oVariantManagement._setSelectionByKey(this._oVariant.key);this._oVariantManagement.currentVariantSetModified(this._oVariant.modified);}}};O.prototype._showFilterDialog=function(){var i=this;this._oFilterDialog=new D({stretch:o.system.phone});this._oFilterDialog.setParent(this);this._oFilterDialog.addStyleClass("sapUiPopupWithPadding");if(this.$().closest(".sapUiSizeCompact").length>0){this._oFilterDialog.addStyleClass("sapUiSizeCompact");}this._oFilterDialog.addStyleClass("sapUiCompFilterBarDialog");if(!this._isPhone()){this._oFilterDialog.addStyleClass("sapUiCompFilterBarDialogNonPhone");}this._oFilterDialog.setTitle(this._oRb.getText("FILTER_BAR_ADV_FILTERS_DIALOG"));this._oFilterDialog.addStyleClass("sapMH4FontSize");this._oFilterDialog.addStyleClass("sapMH4Style");this._oFilterDialog.setVerticalScrolling(true);var j=new B();var n=new S();n.attachSearch(function(W){if(i._oFilterDialog){i._triggerSearchInFilterDialog(W);}});j.addContentRight(n);this._oFilterDialog.setSubHeader(j);var Q=this._createFiltersAndAdaptBasicArea();if(!Q){q.sap.log.error("Content for Advanced Filters Dialog could not be created");return;}this._oFilterDialog.addContent(Q);this._oFilterDialog.attachAfterOpen(function(){i._dialogOpened();});this._oFilterDialog.attachBeforeClose(function(){i._closeDialogAndRestoreFilterBar(Q);});this._oFilterDialog.attachAfterClose(function(){i._oFilterDialog.destroy();i._oFilterDialog=null;});this._oFilterDialog.setInitialFocus(n);this._addFilterDialogButtons(Q);if(!this._isPhone()){this._oFilterDialog.setContentWidth("42rem");}var U=q(document).height()/16;this._oFilterDialog.setContentHeight((U-17)+"rem");this._oFilterDialog.open();};O.prototype._addFilterDialogButtons=function(i){var j=this;var n,Q=[];var U,W,X,Y,Z;var $;Y=new a({id:this.getId()+"-btnSearchOnFiltersDialog",text:this._oRb.getText("FILTER_BAR_GO"),press:function(){j._searchRequested(i);},type:b.Emphasized});this._oFilterDialog.addButton(Y);if(this._oVariantManagement&&this._oVariantManagement.getVisible()&&this._oVariantManagement.oVariantSave){U=new a({id:this.getId()+"-btnVariantSaveOnFiltersDialog",text:this._oRb.getText("VARIANT_MANAGEMENT_SAVE"),enabled:this._oVariantManagement.oVariantSave.getEnabled(),press:function(){j._variantSavePressed();}});n=this._oVariantManagement.getModel("save_enablement");U.setModel(n);U.bindProperty("enabled","/enabled");Q.push(U.clone());U.addStyleClass("sapUiHideOnPhone");this._oFilterDialog.addButton(U);}W=new a({id:this.getId()+"-btnClearOnFiltersDialog",text:this._oRb.getText("FILTER_BAR_CLEAR"),visible:this.getShowClearButton(),press:function(){j.clear();}});if(W.getVisible()){Q.push(W.clone());}W.addStyleClass("sapUiHideOnPhone");this._oFilterDialog.addButton(W);if(n){X=new a({id:this.getId()+"-btnRestoreOnFiltersDialog",text:this._oRb.getText("FILTER_BAR_RESTORE"),visible:this.getShowRestoreButton(),enabled:this._oVariantManagement.oVariantSave.getEnabled(),press:function(){j.reset();j._oVariantManagement.currentVariantSetModified(false);}});X.setModel(n);X.bindProperty("enabled","/enabled");if(X.getVisible()){Q.push(X.clone());}X.addStyleClass("sapUiHideOnPhone");this._oFilterDialog.addButton(X);}Z=new a({id:this.getId()+"-btnCancelOnFiltersDialog",text:this._oRb.getText("FILTER_BAR_CANCEL"),press:function(){j._cancelFilterDialog();j._oFilterDialog.close();}});this._oFilterDialog.addButton(Z);if(Q.length>0){this._oActionSheet=new A({showCancelButton:true,buttons:Q,placement:k.Top});$=new a({id:this.getId()+"-btnActionsOnFiltersDialog",icon:"sap-icon://overflow",press:function(){j._oActionSheet.openBy(this);},tooltip:this._oRb.getText("FILTER_BAR_ACTIONS")});$.addStyleClass("sapUiVisibleOnlyOnPhone");this._oFilterDialog.addButton($);}};O.prototype._createButtons=function(){var i=this;var j=new H();this._oHideShowButton=new a({id:this.getId()+"-btnHideShowFilterBar",text:this._oRb.getText("FILTER_BAR_HIDE"),type:b.Transparent});this._oHideShowButton.addStyleClass("sapUiCompFilterBarPaddingRightBtn");this._oHideShowButton.attachPress(function(){i._toggleHideShow();});j.addContent(this._oHideShowButton);this._oClearButtonOnFB=new a({id:this.getId()+"-btnClearOnFilterBar",visible:this.getShowClearOnFB(),text:this._oRb.getText("FILTER_BAR_CLEAR"),type:b.Transparent});this._oClearButtonOnFB.attachPress(function(){i.clear();});j.addContent(this._oClearButtonOnFB);if(this._oVariantManagement){this._oRestoreButtonOnFB=new a({id:this.getId()+"-btnRestoreOnFilterBar",visible:this.getShowRestoreOnFB(),text:this._oRb.getText("FILTER_BAR_RESTORE"),type:b.Transparent});this._oRestoreButtonOnFB.attachPress(function(){i.reset();});j.addContent(this._oRestoreButtonOnFB);}this._oFiltersButton=new a({id:this.getId()+"-btnFiltersOnFilterBar",text:this._oRb.getText("FILTER_BAR_ACTIVE_FILTERS_ZERO"),type:b.Transparent});this._oFiltersButton.addStyleClass("sapUiCompFilterBarPaddingRightBtn");this._oFiltersButton.attachPress(function(){i._showFilterDialog();});j.addContent(this._oFiltersButton);this._oSearchButton=new a({id:this.getId()+"-btnSearchOnFilterBar",visible:this.getShowGoOnFB(),text:this._oRb.getText("FILTER_BAR_GO"),type:b.Emphasized});this._oSearchButton.attachPress(function(){i.search();});this._oSearchButton.addStyleClass("sapUiCompFilterBarMargingRight");j.addContent(this._oSearchButton);this._oButtonsLayout=j;return j;};O.prototype._createButtonsLayout=function(){var i=new H();var j=this._createButtons();i.addContent(j);i.addStyleClass("sapUiCompFilterBarButtonGroup");return i;};O.prototype._createVariantLayout=function(){this._oVariantManagement=this._createVariantManagement();this._oVariantManagement.setVisible(false);this._fSaveVariant=q.proxy(this._variantSave,this);this._oVariantManagement.attachSave(this._fSaveVariant);this._fAfterSaveVariant=q.proxy(this._afterVariantSave,this);this._oVariantManagement.attachAfterSave(this._fAfterSaveVariant);return this._oVariantManagement;};O.prototype._createToolbar=function(){var i=new l();var j=this._createVariantLayout();i.addContent(j);i.addContent(this._oText);i.addContent(new m());this._oButtonLayout=this._createButtonsLayout();i.addContent(this._oButtonLayout);i.addStyleClass("sapUiCompFilterBarToolbar");i.addStyleClass("sapUiCompFilterBarToolbarMarker");return i;};O.prototype._createBasicAreaLayout=function(){var i=new H();i.setAllowWrapping(true);i.addStyleClass("sapUiCompFilterBarWidth100");i.addStyleClass("sapUiCompFilterBarBasicArea");return i;};O.prototype._createAdvancedAreaForm=function(){var i=new N();i.addStyleClass("sapUiCompFilterBarPaddingForm");i.setColumnsL(3);i.setColumnsM(2);var j=new J({editable:true});j.setLayout(i);return j;};O.prototype._addControlToBasicAreaFormContainer=function(i){var j=i.getControl();if(!j){q.sap.log.error("no Control obtained");return null;}var n=i.getLabelControl();if(!n){q.sap.log.error("no Label obtained");return null;}if(!this.getAdvancedMode()){this._adaptGroupTitleForFilter(i);}else{this._oAdvancedPanel.setExpandable(true);var Q=this._oRb.getText("ADVANCED_SEARCH_TEXT");this._oAdvancedPanel.setHeaderText(Q);this.oAdvancedSearchArea.setVisible(false);if(this._oSearchButtonAdvanced){this._oSearchButtonAdvanced.removeStyleClass("sapUiCompFilterBarFloatRight");this._oBasicAreaLayout.insertContent(this._oSearchButtonAdvanced,0);this._oSearchButtonAdvanced.setVisible(true);}}return this._addControlToBasicAreaContainer(i,j,n);};O.prototype._addControlToBasicAreaContainer=function(i,j,n){var Q=new F();Q.setLayoutData(new E({margin:true}));if(j.getWidth){Q.setWidth("12rem");}if(!this.getAdvancedMode()){if(n){Q.addContent(n);n.setLabelFor(j);}}Q.addContent(j);Q.addStyleClass("sapUiCompFilterBarPaddingRight");if(this.getAdvancedMode()){var U=this._oBasicAreaLayout.getContent();if(U.length>0){this._oBasicAreaLayout.insertContent(Q,U.length-1);}else{this._oBasicAreaLayout.addContent(Q);}}else{Q.addStyleClass("sapUiCompFilterBarPaddingTop");this._oBasicAreaLayout.addContent(Q);}return Q;};O.prototype._flattenMap=function(){var n=null,i;var j=[];var Q;if(this._mAdvancedAreaFilter){for(n in this._mAdvancedAreaFilter){if(n&&this._mAdvancedAreaFilter[n].items){Q=false;for(i=0;i<this._mAdvancedAreaFilter[n].items.length;i++){var U=this._mAdvancedAreaFilter[n].items[i];if(U.filterItem&&U.filterItem.getVisibleInFilterBar()&&U.filterItem.getVisible()){if(!Q){Q=true;j.push({control:null,filterItem:this._mAdvancedAreaFilter[n].filterItem});}j.push({control:U.control,filterItem:U.filterItem});}}}}}return j;};O.prototype._rerenderAA=function(){this._oAdvancedAreaForm.removeAllFormContainers();var i=this._flattenMap();if(i.length>0){this._oAdvancedPanel.setVisible(true);}else{this._oAdvancedPanel.setVisible(false);}this._layOutAA(i);};O.prototype._triggerSearchByValue=function(j){var i,n,Q;var U;var W;j=j.replace(/^\s+|\s+$/g,"").toLowerCase();if(this._aListItems){var X=0;for(i=this._aListItems.length-1;i>=0;i--){U=this._aListItems[i].getContent();if(U.length===2){n=U[1].getText();Q=this._aListItems[i].data("quickinfo");if((n.toLowerCase().indexOf(j)>=0||(Q&&Q.toLowerCase().indexOf(j)>=0))||(this._aListItems[i].hasStyleClass("sapUiCompFilterBarGroupListItem")&&X>0)){W=true;if(this._aListItems[i].hasStyleClass("sapUiCompFilterBarGroupListItem")){if(!X){W=false;}}else{X++;}this._aListItems[i].setVisible(W);}else{this._aListItems[i].setVisible(false);}}}}};O.prototype._triggerSearch=function(i){if(!i){return;}var j=i.getParameters();if(!j){return;}var n=j.query?j.query:"";this._triggerSearchByValue(n);};O.prototype._triggerSearchByValueInFilterDialog=function(j){var n=null,i;var Q,U;var W,X;var Y;var Z;j=j.replace(/^\s+|\s+$/g,"").toLowerCase();if(this._mAdvancedAreaFilter){for(n in this._mAdvancedAreaFilter){if(n){W=this._mAdvancedAreaFilter[n];if(W&&W.items){Y=0;Z=0;for(i=0;i<W.items.length;i++){if(W.items[i]&&W.items[i].filterItem&&W.items[i].formelement){X=W.items[i].filterItem;if(X.getVisible()){if(j){Q=X.getLabel();U=X.getLabelTooltip();if((Q.toLowerCase().indexOf(j)>=0||(U&&U.toLowerCase().indexOf(j)>=0))){if(X.getPartOfCurrentVariant()){W.items[i].formelement.setVisible(true);}else{++Z;}}else{++Y;W.items[i].formelement.setVisible(false);}}else{W.items[i].formelement.setVisible(X.getVisibleInFilterBar()||X.getPartOfCurrentVariant());if(W.link&&!W.link.getVisible()){W.link.setVisible(true);}}}else{++Y;}}}if(W&&W.formcontainer){if(Y===W.items.length){W.formcontainer.setVisible(false);}else{W.formcontainer.setVisible(true);if(W.link){W.link.setVisible((j&&(Z===0))?false:true);if(j&&(Z>0)){this._setLinkTextAndCount(n,W.link,Z);}else{this._setLinkText(n,W.link);}}}}}}}}};O.prototype._triggerSearchInFilterDialog=function(i){if(!i){return;}var j=i.getParameters();if(!j){return;}var n=j.query?j.query:"";this._sSearchCriteriaInFiltersDialog=n;this._triggerSearchByValueInFilterDialog(n);};O.prototype._generateListItems=function(j){var i;var n;var Q,U;var W=[];var X,Y;var Z=false;if(this.$().closest(".sapUiSizeCompact").length>0){Z=true;}if(j&&this._mAdvancedAreaFilter){U=this._mAdvancedAreaFilter[j];if(U&&U.items){n=new c();n.addStyleClass("sapUiCompFilterBarGroupListItem");X=new L({text:U.filterItem.getGroupTitle()});n.addContent(X);for(i=0;i<U.items.length;i++){var $=U.items[i];if($&&$.filterItem){if(!$.filterItem.getVisible()){continue;}if(n){W.push(n);n=null;}Q=new c();Q.setVisible(true);if(!Z){Q.addStyleClass("sapUiCompFilterBarListItem");}else{Q.addStyleClass("sapUiCompFilterBarListItemCompact");}Q.data("quickinfo",$.filterItem.getLabelTooltip());Y=new C();Y.setSelected($.filterItem.getPartOfCurrentVariant());if((($.filterItem.getMandatory()&&$.checkbox&&!$.checkbox.getEnabled())||$.filterItem.getVisibleInFilterBar())){Y.setEnabled(false);}$.initialPartOfCurrentVariant=$.filterItem.getPartOfCurrentVariant();Y.attachSelect(q.proxy(this._selectionChangedInAddFiltersDialog,this,Y,$));Q.addContent(Y);X=new L({text:$.filterItem.getLabel(),tooltip:$.filterItem.getLabelTooltip()});Q.addContent(X);W.push(Q);}}}}return W;};O.prototype._rerenderItem=function(i){if(i){if(i.container){i.container.setVisible(i.filterItem.getVisible()&&i.filterItem.getVisibleInFilterBar());}if(i.formelement){i.formelement.setVisible(i.filterItem.getVisible()&&(i.filterItem.getVisibleInFilterBar()||i.filterItem.getPartOfCurrentVariant()));if(i.checkbox){i.checkbox.setSelected(i.filterItem.getVisibleInFilterBar());}}}};O.prototype._rerenderFilters=function(){var i;var n=null;var j=null;if(this._mAdvancedAreaFilter){for(n in this._mAdvancedAreaFilter){if(n&&this._mAdvancedAreaFilter[n]&&this._mAdvancedAreaFilter[n].items){for(i=0;i<this._mAdvancedAreaFilter[n].items.length;i++){j=this._mAdvancedAreaFilter[n].items[i];this._rerenderItem(j);}}}}this._updateToolbarText();};O.prototype.rerenderFilters=function(){this._rerenderFilters();};O.prototype._closeAddRemoveFiltersDialog=function(i,j){if(i&&j){if(this._sSearchCriteriaInFiltersDialog&&this._oFilterDialog){this._triggerSearchByValueInFilterDialog(this._sSearchCriteriaInFiltersDialog);}else{this._setLinkText(i,j);}}this._oDialog.close();this._oDialog.destroy();this._oDialog=null;};O.prototype._cancelAddRemoveFiltersDialog=function(j){var i;var n;if(j&&this._mAdvancedAreaFilter&&this._mAdvancedAreaFilter[j]&&this._mAdvancedAreaFilter[j].items){for(i=0;i<this._mAdvancedAreaFilter[j].items.length;i++){n=this._mAdvancedAreaFilter[j].items[i];if(n.initialPartOfCurrentVariant!==undefined&&n.filterItem){if(n.filterItem.getPartOfCurrentVariant()!==n.initialPartOfCurrentVariant){n.filterItem.setPartOfCurrentVariant(n.initialPartOfCurrentVariant);this._rerenderItem(n);this._notifyAboutChangedFilters(n.initialPartOfCurrentVariant,n.control);}}}}if(this._oVariantManagement&&(this._oVariant.modified2!==undefined)){this._oVariantManagement.currentVariantSetModified(this._oVariant.modified2);}};O.prototype._createAddRemoveFiltersDialog=function(j,n){var i;var Q=this;if(!j){return;}this._oDialog=new D({stretch:o.system.phone});this._oDialog.addStyleClass("sapUiPopupWithPadding");this._oDialog.addStyleClass("sapUiCompAddRemoveFilterDialog");if(this.$().closest(".sapUiSizeCompact").length>0){this._oDialog.addStyleClass("sapUiSizeCompact");}this._oDialog.setTitle(this._oRb.getText("SELECT_FILTER_FIELDS"));this._oDialog.addStyleClass("sapMH4FontSize");this._oDialog.addStyleClass("sapMH4Style");this._oDialog.setVerticalScrolling(true);var U=new B();var W=new S();this._oSearchField=W;W.attachSearch(function($){Q._triggerSearch($);});U.addContentRight(W);this._oDialog.setSubHeader(U);var X=new f();X.setShowSeparators(g.None);this._oDialog.addContent(X);this._aListItems=this._generateListItems(j);for(i=0;i<this._aListItems.length;i++){X.addItem(this._aListItems[i]);}if(this._oVariant&&this._oVariantManagement){this._oVariant.modified2=this._oVariantManagement.currentVariantGetModified();}var Y=new a({id:this.getId()+"-btnCloseAddRemoveFiltersDialog",text:this._oRb.getText("FILTER_BAR_OK")});Y.attachPress(function(){Q._closeAddRemoveFiltersDialog(j,n);});this._oDialog.addAggregation("buttons",Y);this._oDialog.setInitialFocus(this._oSearchField);this._oDialog.setContentHeight("23.25rem");if(this._sSearchCriteriaInFiltersDialog){this._triggerSearchByValue(this._sSearchCriteriaInFiltersDialog);}var Z=new a({id:this.getId()+"-btnCancelAddRemoveFiltersDialog",text:this._oRb.getText("FILTER_BAR_CANCEL"),press:function(){Q._cancelAddRemoveFiltersDialog(j);Q._closeAddRemoveFiltersDialog(j,n);}});this._oDialog.addAggregation("buttons",Z);this._oDialog.open();};O.prototype._selectionChangedInAddFiltersDialog=function(i,j){var n=i.getSelected();if(!n&&((j.filterItem.getMandatory()&&!j.checkbox.getEnabled())||j.filterItem.getVisibleInFilterBar())){i.setSelected(true);return;}j.filterItem.setPartOfCurrentVariant(n);this._rerenderItem(j);this._notifyAboutChangedFilters(n,j.control);};O.prototype._setConsiderFilterChanges=function(i){this._filterChangeSemaphore=i;};O.prototype._getConsiderFilterChanges=function(){return this._filterChangeSemaphore;};O.prototype.fireFilterChange=function(i){this._updateToolbarText();if(this._getConsiderFilterChanges()&&this._oVariantManagement&&this._oVariantManagement.getEnabled()){this._oVariantManagement.currentVariantSetModified(true);}if(this._oFilterDialog&&!(this._oFilterDialog.isOpen())){return;}this.fireEvent("filterChange",i);};O.prototype._notifyAboutChangedFilters=function(i,j){var n;if(i){n={"added":j};}else{n={"deleted":j};}this.fireFilterChange(n);};O.prototype.getAllAddedRemovedFilterItems=function(){return this._mChangedFilterItems;};O.prototype._layOutAA=function(i){if(this._mAdvancedAreaFilter&&Object.keys(this._mAdvancedAreaFilter).length>1){this._layOutAAMultipleGroup(i);}else{this._layOutAASingleGroup(i);}};O.prototype._layOutAAMultipleGroup=function(n){var i,j,Q=0;var U=null;for(i=0;i<n.length;i++){if(n[i].control===null){Q++;}}var W=this._oAdvancedAreaForm.getLayout();if(W){if(Q>=3){W.setLabelSpanL(5);W.setLabelSpanM(5);W.setColumnsL(3);W.setColumnsM(2);}else if(Q===2){W.setLabelSpanL(4);W.setLabelSpanM(5);W.setColumnsL(2);W.setColumnsM(2);}else if(Q===1){W.setLabelSpanL(4);W.setLabelSpanM(5);W.setColumnsL(2);W.setColumnsM(2);}}for(i=0;i<n.length;i++){if(n[i].control===null){U=new K();if(Object.keys(this._mAdvancedAreaFilter).length>1){U.setTitle(n[i].filterItem.getGroupTitle());}this._oAdvancedAreaForm.addFormContainer(U);j=i+1;while(j<n.length&&(n[j].control)){this._addControlToAdvancedArea(n[j].filterItem,n[j].control,U);j++;}i=j-1;}}if(Q===1){this._oAdvancedAreaForm.addFormContainer(new K());}};O.prototype._layOutAASingleGroup=function(j){var i,n,Q,U;var W=j.length-1;var X=W>2?2:1;if(X>1){Q=Math.floor(W/X);U=((Q*X)<W);for(i=1;i<X;i++){n=i*Q;if(U){++n;}if((n+i)<j.length){j.splice(n+i,0,j[0]);}}}this._layOutAAMultipleGroup(j);};O.prototype._determineVariantFiltersInfo=function(j){var i;var n=null,Q;var U=null;if(this._mAdvancedAreaFilter){for(n in this._mAdvancedAreaFilter){if(n){if(this._mAdvancedAreaFilter[n].items){for(i=0;i<this._mAdvancedAreaFilter[n].items.length;i++){Q=this._mAdvancedAreaFilter[n].items[i];if(j||Q.filterItem.getVisible()){if(!U){U=[];}U.push({group:Q.filterItem.getGroupName(),name:Q.filterItem.getName(),partOfCurrentVariant:Q.filterItem.getPartOfCurrentVariant(),visibleInFilterBar:Q.filterItem.getVisibleInFilterBar()});}}}}}}return U;};O.prototype._addControlToAdvancedArea=function(i,j,n){var Q=new M({label:i.getLabelControl(),fields:[(j!==null)?j:new T()]});n.addFormElement(Q);};O.prototype._determineVisibility=function(i){var j=false;if(i){j=i.getVisible()&&(i.getVisibleInFilterBar()||i.getPartOfCurrentVariant());}return j;};O.prototype._retrieveVisibleBasicItems=function(){var i,j=[];if(this.getAdvancedMode()){if(this._aBasicAreaSelection){for(i=0;i<this._aBasicAreaSelection.length;i++){if(this._aBasicAreaSelection[i].filterItem){if(this._determineVisibility(this._aBasicAreaSelection[i].filterItem)){j.push(this._aBasicAreaSelection[i]);}}}}}return j;};O.prototype._retrieveVisibleAdvancedItems=function(){var i,n=null,j;var Q=[];if(this._mAdvancedAreaFilter){for(n in this._mAdvancedAreaFilter){if(n){if(n===O.INTERNAL_GROUP){if(this.getAdvancedMode()){continue;}}if(this._mAdvancedAreaFilter[n]&&this._mAdvancedAreaFilter[n].items){for(i=0;i<this._mAdvancedAreaFilter[n].items.length;i++){j=this._mAdvancedAreaFilter[n].items[i];if(j){if(this._determineVisibility(j.filterItem)){Q.push(j);}}}}}}}return Q;};O.prototype._retrieveCurrentSelectionSet=function(){var i;var j=[];var n=this._retrieveVisibleBasicItems();var Q=this._retrieveVisibleAdvancedItems();var U=n.concat(Q);for(i=0;i<U.length;i++){if(U[i].control){j.push(U[i].control);}}return j;};O.prototype.search=function(){var i={};i.selectionSet=this._retrieveCurrentSelectionSet();this.fireSearch(i);return true;};O.prototype.clear=function(){var i={};i.selectionSet=this._retrieveCurrentSelectionSet();this._clearErrorState();this.fireClear(i);};O.prototype._setSelectedVariant=function(){var i=null;if(this._oVariantManagement){var j=this._oVariantManagement.getSelectionKey();if(j){i=this._oVariantManagement.getVariantContent(this,j);if(i){this._applyVariant(i);}}}};O.prototype.reset=function(){var i={};i.selectionSet=this._retrieveCurrentSelectionSet();this.fireReset(i);this._setSelectedVariant();};O.prototype._applyVariant=function(i){var j=null;var n;var Q=false;if(i){this._setConsiderFilterChanges(false);n=i.filterBarVariant;j=i.filterbar;this._applyVariantFields(n);this._reapplyVisibility(j);this._setConsiderFilterChanges(true);this._updateToolbarText();this.fireAfterVariantLoad();if(i.executeOnSelection){Q=i.executeOnSelection;}if(Q){this.search();}else{this._clearErrorState();}}};O.prototype._fetchVariantFiltersData=function(){if(this._fRegisteredFetchData){try{return this._fRegisteredFetchData();}catch(i){q.sap.log.error("callback for fetching data throws an exception");}}else{q.sap.log.warning("no callback for fetch data supplied");}return null;};O.prototype._applyVariantFields=function(j){if(this._fRegisteredApplyData){try{return this._fRegisteredApplyData(j);}catch(i){q.sap.log.error("callback for applying data throws an exception");}}else{q.sap.log.warning("no callback for appy data supplied");}};O.prototype.fetchVariant=function(i){var j;var n={};j=this._determineVariantFiltersInfo(i);n.filterbar=(!j)?[]:j;n.filterBarVariant=this._fetchVariantFiltersData();return n;};O.prototype.applyVariant=function(i){this._applyVariant(i);};O.prototype.determineMandatoryFilterItems=function(){var i;var j=[];var n=this._retrieveVisibleBasicItems();var Q=this._retrieveVisibleAdvancedItems();var U=n.concat(Q);for(i=0;i<U.length;i++){if(U[i].filterItem.getMandatory()===true){if(U[i].control){j.push(U[i].filterItem);}}}return j;};O.prototype.determineControlByFilterItem=function(j){var i,n=null;var Q,U;if(this._aBasicAreaSelection){for(i=0;i<this._aBasicAreaSelection.length;i++){Q=this._aBasicAreaSelection[i];if(j===Q.filterItem){return Q.control;}}}if(this._mAdvancedAreaFilter){for(n in this._mAdvancedAreaFilter){if(n){U=this._mAdvancedAreaFilter[n];if(U&&U.items){for(i=0;i<U.items.length;i++){Q=U.items[i];if(j===Q.filterItem){return Q.control;}}}}}}return null;};O.prototype.determineControlByName=function(n,i){var j=this._determineItemByName(n,i);if(j){return j.control;}return null;};O.prototype._determineItemByName=function(n,j){var i;var Q,U;var W=j;if(!n){return null;}if(!W){W=O.INTERNAL_GROUP;}if(this._mAdvancedAreaFilter){U=this._mAdvancedAreaFilter[W];if(U&&U.items){for(i=0;i<U.items.length;i++){Q=U.items[i];if(Q&&Q.filterItem&&(Q.filterItem.getName()===n)){return Q;}}}}return null;};O.prototype.determineFilterItemByName=function(i){var n,j;if(this._mAdvancedAreaFilter){for(n in this._mAdvancedAreaFilter){j=this._determineItemByName(i,n);if(j){return j.filterItem;}}}return null;};O.prototype._determineByFilterGroupItem=function(j){var n=null,i;if(this._mAdvancedAreaFilter){for(n in this._mAdvancedAreaFilter){if(n){var Q=this._mAdvancedAreaFilter[n];if(Q&&Q.items){for(i=0;i<Q.items.length;i++){if(Q.items[i]&&Q.items[i].filterItem===j){return Q.items[i];}}}}}}return null;};O.prototype._determineByControl=function(j){var n=null,i;if(this._mAdvancedAreaFilter){for(n in this._mAdvancedAreaFilter){if(n){var Q=this._mAdvancedAreaFilter[n];if(Q&&Q.items){for(i=0;i<Q.items.length;i++){if(Q.items[i]&&Q.items[i].control===j){return Q.items[i];}}}}}}return null;};O.prototype._deleteProperties=function(){var n=null,i;if(this._mAdvancedAreaFilter){for(n in this._mAdvancedAreaFilter){if(n){var j=this._mAdvancedAreaFilter[n];if(j&&j.items){if(j.formcontainer){delete j.formcontainer;}if(j.link){delete j.link;}for(i=0;i<j.items.length;i++){if(j.items[i]&&j.items[i].checkbox){delete j.items[i].checkbox;}if(j.items[i]&&j.items[i].formelement){delete j.items[i].formelement;}}}}}}};O.prototype._getDOMElement=function(i){return q('#'+i);};O.prototype._fHandleResize=function(){var n,i,j,Q;var U=16,W,X;var Y,Z;if(this.getAdvancedMode()){if(this._aBasicAreaSelection&&this._aBasicAreaSelection.length===1){if(this._aBasicAreaSelection[0]&&this._aBasicAreaSelection[0].control){W=U*2;if(this._nFirstElementWidth){X=this._nFirstElementWidth;}else{X=U*28;}Z=this._aBasicAreaSelection[0].control;Y=this._getDOMElement(Z.getId());n=Y.width();j=this._getDOMElement(this._oSearchButtonAdvanced.getId()).width();i=this._getDOMElement(this._oBasicAreaLayout.getId()).width();Q=i-j-3/2*U;if((n+j+3/2*U)>i){if(Q<W){Q=W;}}else{if(Q>X){Q=X;}}Y.width(Q);}}}};O.prototype.onAfterRendering=function(){if(this.getAdvancedMode()){if(!this._nFirstElementWidth){if(this._aBasicAreaSelection&&this._aBasicAreaSelection.length===1){if(this._aBasicAreaSelection[0]&&this._aBasicAreaSelection[0].control){this._nFirstElementWidth=this._getDOMElement(this._aBasicAreaSelection[0].control.getId()).width();this._fHandleResize();}}}}else{if(this._oFilterDialog&&this._mAdvancedAreaFilter){this._dialogOpened();}}};O.prototype.destroy=function(){q(window).off("resize.basicsearch");if(this._oVariantManagement){if(this._fInitialiseVariants){this._oVariantManagement.detachInitialise(this._fInitialiseVariants);this._fInitialiseVariants=null;}if(this._fSaveVariant){this._oVariantManagement.detachSave(this._fSaveVariant);this._fSaveVariant=null;}if(this._fAfterSaveVariant){this._oVariantManagement.detachSave(this._fAfterSaveVariant);this._fAfterSaveVariant=null;}}G.prototype.destroy.apply(this,arguments);if(this._oDialog){this._oDialog.destroy();this._oDialog=null;}if(this._oActionSheet){this._oActionSheet.destroy();this._oActionSheet=null;}if(this._oFilterDialog){this._oFilterDialog.destroy();this._oFilterDialog=null;}this._aBasicAreaSelection=null;this._mAdvancedAreaFilter=null;this._oBasicAreaLayout=null;this._oAdvancedAreaForm=null;this._oAdvancedPanel=null;this._oVariantManagement=null;this._oVariant=null;this._fRegisteredFetchData=null;this._fRegisteredApplyData=null;this._fRegisterGetFiltersWithValues=null;this._fRegisteredFilterChangeHandlers=null;this._oSearchButton=null;this._oSearchButtonAdvanced=null;this._oFiltersButton=null;this._oHideShowButton=null;this._oClearButtonOnFB=null;this._oRestoreButtonOnFB=null;this._mChangedFilterItems=null;this._oAddToFilterBarLabel=null;this._oTitle=null;};return O;},true);
