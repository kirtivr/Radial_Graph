/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2015 SAP SE. All rights reserved
 */
sap.ui.define(['jquery.sap.global','sap/ui/comp/smartfilterbar/ControlConfiguration','sap/ui/comp/valuehelpdialog/ValueHelpDialog','sap/m/MultiComboBox','sap/m/DatePicker','sap/m/DateRangeSelection'],function(q,C,V,M,D,a){"use strict";var b=function(){};b.prototype.convert=function(s,f){var c=null;var S;if(s){S=JSON.parse(s);if(f&&f.getFilterBarViewMetadata&&S&&(S.Parameters||S.SelectOptions)){c={};if(S.Parameters){this._addParameters(S.Parameters,f,c);}if(S.SelectOptions){this._addSelectOptions(S.SelectOptions,f,c);}c=JSON.stringify(c);}}return c;};b.prototype._getParameterMetaData=function(n,f){var i,j;var g;var F=f.getFilterBarViewMetadata();if(F){for(i=0;i<F.length;i++){g=F[i];for(j=0;j<g.fields.length;j++){if(n===g.fields[j].fieldName){return g.fields[j];}}}}return null;};b.prototype._addParameters=function(s,f,c){var i;var n,v;var F;for(i=0;i<s.length;i++){v=s[i].PropertyValue;n=s[i].PropertyName;var o=f.determineFilterItemByName(n);if(o){F=this._getParameterMetaData(n,f);if(F){this._addAccordingMetaData(c,F,v);}else{q.sap.log.error("neither metadata nor custom information for filter '"+n+"'");}}else{q.sap.log.warning("unknown filter '"+n+"'");}}};b.prototype._addSelectOptions=function(s,f,c){var i;var n,r;var F,o;for(i=0;i<s.length;i++){n=s[i].PropertyName;r=s[i].Ranges;var d=f.determineFilterItemByName(n);if(d){F=this._getParameterMetaData(n,f);if(F){o=f.determineControlByFilterItem(d);this._addRangesAccordingMetaData(c,F,r,o);}else{q.sap.log.error("neither metadata nor custom information for filter '"+name+"'");}}else{q.sap.log.warning("unknown filter '"+name+"'");}}};b.prototype._addRangesAccordingMetaData=function(c,f,r,o,n){var i,I,O;var d=function(s,v){var e=s;if(s==="CP"){e=sap.ui.comp.valuehelpdialog.ValueHelpRangeOperation.Contains;if(v){var g=v.indexOf('*');var h=v.lastIndexOf('*');if((g===0)&&(h!==(v.length-1))){e=sap.ui.comp.valuehelpdialog.ValueHelpRangeOperation.EndsWith;v=v.substring(1,v.length);}else if((g!==0)&&(h===(v.length-1))){e=sap.ui.comp.valuehelpdialog.ValueHelpRangeOperation.StartsWith;v=v.substring(0,v.length-1);}else{v=v.substring(1,v.length-1);}}}return{op:e,v:v};};if(r&&r.length>0){if(f.isCustomFilterField){if(!c._CUSTOM){c._CUSTOM={};}c._CUSTOM[f.fieldName]=r[0].Low;return;}if(f.filterRestriction===C.FILTERTYPE.single){if(!r[0].Low&&o&&(o instanceof D)){c[f.fieldName]=null;}else{c[f.fieldName]=r[0].Low;}}else if(f.filterRestriction===C.FILTERTYPE.interval){if(r[0].Low&&r[0].High){c[f.fieldName]={low:r[0].Low,high:r[0].High};}else if(r[0].Low&&!r[0].High){c[f.fieldName]={low:r[0].Low,high:r[0].Low};}else if(!r[0].Low&&r[0].High){c[f.fieldName]={low:r[0].High,high:r[0].High};}else{if(o&&(o instanceof a)){c[f.fieldName]={low:null,high:null};}else{c[f.fieldName]={low:r[0].Low,high:r[0].High};}}}else if(f.filterRestriction===C.FILTERTYPE.multiple){c[f.fieldName]={ranges:[],items:[],value:null};if(o&&(o instanceof M)){for(i=0;i<r.length;i++){O=d(r[i].Option,r[i].Low);if(O.op===sap.ui.comp.valuehelpdialog.ValueHelpRangeOperation.EQ){c[f.fieldName].items.push({key:O.v});}}}else{for(i=0;i<r.length;i++){O=d(r[i].Option,r[i].Low);I={"exclude":(r[i].Sign==="E"),"operation":O.op,"keyField":f.fieldName,"value1":O.v,"value2":r[i].High};c[f.fieldName].ranges.push(I);}}}else{c[f.fieldName]={ranges:[],items:[],value:null};for(i=0;i<r.length;i++){O=d(r[i].Option,r[i].Low);I={"exclude":(r[i].Sign==="E"),"operation":O.op,"keyField":f.fieldName,"value1":O.v,"value2":r[i].High};c[f.fieldName].ranges.push(I);}}q.sap.log.warning("potential reduced information for filter '"+f.fieldName+"'");}else{q.sap.log.warning("no Ranges-section found for filter '"+f.fieldName+"'");}};b.prototype._addAccordingMetaData=function(c,f,v){var r=[{Sign:"I",Low:v,High:v,Option:"EQ"}];this._addRangesAccordingMetaData(c,f,r);};return b;},true);
