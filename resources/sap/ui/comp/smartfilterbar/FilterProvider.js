/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2015 SAP SE. All rights reserved
 */
sap.ui.define(['jquery.sap.global','sap/m/ComboBox','sap/m/DatePicker','sap/m/DateRangeSelection','sap/m/Input','sap/m/MultiComboBox','sap/m/MultiInput','sap/m/SearchField','sap/m/Token','sap/ui/comp/odata/MetadataAnalyser','sap/ui/comp/providers/ValueHelpProvider','sap/ui/comp/providers/ValueListProvider','sap/ui/model/Filter','sap/ui/model/json/JSONModel','sap/ui/model/type/Float'],function(q,C,D,a,I,M,b,S,T,c,V,d,F,J,e){"use strict";var f=function(p){if(p){this._oParentODataModel=p.model;this._sServiceURL=p.serviceUrl;this._sBasicSearchFieldName=p.basicSearchFieldName;this.sEntityType=p.entityType;this._isRunningInValueHelpDialog=p.isRunningInValueHelpDialog;this._oAdditionalConfiguration=p.additionalConfiguration;this.sDefaultDropDownDisplayBehaviour=p.defaultDropDownDisplayBehaviour;if(!this.sDefaultDropDownDisplayBehaviour||this.sDefaultDropDownDisplayBehaviour===sap.ui.comp.smartfilterbar.ControlConfiguration.DISPLAYBEHAVIOUR.auto){this.sDefaultDropDownDisplayBehaviour=sap.ui.comp.smartfilterbar.ControlConfiguration.DISPLAYBEHAVIOUR.descriptionOnly;}this.sDefaultTokenDisplayBehaviour=p.defaultTokenDisplayBehaviour;if(!this.sDefaultTokenDisplayBehaviour||this.sDefaultTokenDisplayBehaviour===sap.ui.comp.smartfilterbar.ControlConfiguration.DISPLAYBEHAVIOUR.auto){this.sDefaultTokenDisplayBehaviour=sap.ui.comp.smartfilterbar.ControlConfiguration.DISPLAYBEHAVIOUR.descriptionAndId;}if(typeof p.dateFormatSettings==="string"){try{this._oDateFormatSettings=p.dateFormatSettings?JSON.parse(p.dateFormatSettings):undefined;}catch(g){}}else{this._oDateFormatSettings=p.dateFormatSettings;}this._oSmartFilter=p.smartFilter;}this.sFilterModelName=f.FILTER_MODEL_NAME;this._sBasicFilterAreaID=f.BASIC_FILTER_AREA_ID;this._aFilterBarViewMetadata=[];this._aFilterBarMultiValueFieldMetadata=[];this._aFilterBarDateFieldNames=[];this._aFieldGroupAnnotation=[];this._oMetadataAnalyser=new c(this._oParentODataModel||this._sServiceURL);this.oModel=new J();this._aValueListProvider=[];this._aValueHelpDialogProvider=[];this._intialiseMetadata();};f.FILTER_MODEL_NAME="fi1t3rM0d31";f.BASIC_FILTER_AREA_ID="_BASIC";f.BASIC_SEARCH_FIELD_ID="_BASIC_SEARCH_FIELD";f.CUSTOM_FIELDS_MODEL_PROPERTY="_CUSTOM";f.prototype._intialiseMetadata=function(){var g,h,o,O,i,j,k,G,l,m;this._aFilterBarViewMetadata.push({groupName:this._sBasicFilterAreaID,index:0,fields:[]});this.sEntityTypeName=this._oMetadataAnalyser.removeNamespace(this.sEntityType);O=this._oMetadataAnalyser.getAllFilterableFieldsByEntityTypeName(this.sEntityType);if(O){this._aFieldGroupAnnotation=this._oMetadataAnalyser.getFieldGroupAnnotation(this.sEntityType);if(this._aFieldGroupAnnotation){g=this._aFieldGroupAnnotation.length;for(i=0;i<g;i++){o=this._aFieldGroupAnnotation[i];G=this._createGroupMetadata(o);G.index=this._aFilterBarViewMetadata.length;this._aFilterBarViewMetadata.push(G);}}g=O.length;for(i=0;i<g;i++){o=O[i];h=o.fields.length;G=this._createGroupMetadata(o);this._aFilterBarViewMetadata.push(G);for(j=0;j<h;j++){k=this._createFieldMetadata(o.fields[j]);G.fields.push(k);}}}m=this._getAdditionalConfigurationForCustomGroups(O);g=m.length;for(j=0;j<g;j++){G=this._createGroupMetadataForCustomGroup(m[j]);if(G){this._aFilterBarViewMetadata.push(G);}}l=this._getAdditionalConfigurationForCustomFilterFields();h=l.length;for(j=0;j<h;j++){k=this._createFieldMetadataForCustomFilterFields(l[j]);if(k){this._aFilterBarViewMetadata[0].fields.push(k);}}if(this._hasBasicSearch()){k=this._createBasicSearchFieldMetadata();this._aFilterBarViewMetadata[0].fields.push(k);}this._applyGroupId();this._applyIndexes();this._createInitialModel(true);};f.prototype._hasBasicSearch=function(){return!!this._sBasicSearchFieldName;};f.prototype._getAdditionalConfigurationForCustomFilterFields=function(){var g,l,n,i,r,j,h,o;if(!this._oAdditionalConfiguration){return[];}g=this._oAdditionalConfiguration.getControlConfiguration();o=this._oMetadataAnalyser.getAllFilterableFieldNamesByEntityTypeName(this.sEntityType);if(!o||!o.length){return g;}r=[];n=o.length;l=g.length;for(i=0;i<l;i++){h=false;for(j=0;j<n;j++){if(o[j]===g[i].key){h=true;break;}}if(!h){r.push(g[i]);}}return r;};f.prototype._getAdditionalConfigurationForCustomGroups=function(o){var g,l,n,i,r,j,h;if(!this._oAdditionalConfiguration){return[];}g=this._oAdditionalConfiguration.getGroupConfiguration();if(!o||!o.length){return g;}r=[];n=o.length;l=g.length;for(i=0;i<l;i++){h=false;for(j=0;j<n;j++){if(o[j].groupName===g[i].key){h=true;break;}}if(!h){r.push(g[i]);}}return r;};f.prototype._createInitialModelForField=function(j,o,u){var g,h,H=false,i=false,l=null,s=null,L,k=null,m=[],r=[];if(!o||o.isCustomFilterField){return;}if(o.filterRestriction!==sap.ui.comp.smartfilterbar.ControlConfiguration.FILTERTYPE.multiple){i=true;}if(u){g=o.defaultFilterValues;H=g&&g.length;}if(o.filterRestriction===sap.ui.comp.smartfilterbar.ControlConfiguration.FILTERTYPE.single){if(H){h=g[0];l=h.low;}j[o.fieldName]=l;}else if(o.filterRestriction===sap.ui.comp.smartfilterbar.ControlConfiguration.FILTERTYPE.interval){if(H){h=g[0];l=h.low;s=h.high;}j[o.fieldName]={low:l,high:s};}else{if(H){L=g.length;while(L--){h=g[L];if(i){k={"exclude":h.sign==="E","operation":h.operator,"keyField":o.fieldName,"value1":h.low,"value2":h.high};}else{k={key:h.low,text:h.low};}m.push(k);}}this._aFilterBarMultiValueFieldMetadata.push(o);j[o.fieldName]={value:null};if(i){r=m.slice(0);m=[];j[o.fieldName].ranges=r;}j[o.fieldName].items=m;this._updateMultiValueControl(o.control,m,r);}};f.prototype._createInitialModel=function(u){var o,g,h,G,j,i;o={};this._aFilterBarMultiValueFieldMetadata=[];if(this._aFilterBarViewMetadata){g=this._aFilterBarViewMetadata.length;for(i=0;i<g;i++){G=this._aFilterBarViewMetadata[i];h=G.fields.length;for(j=0;j<h;j++){this._createInitialModelForField(o,G.fields[j],u);}}}this.oModel.setData(o);};f.prototype._updateMultiValueControl=function(o,g,r){var i=0,t=null,h=null,R=null,s=null,k=null;if(o&&g){i=g.length;if(o instanceof b){t=[];while(i--){s=g[i].text||g[i].key;t.push(new T({key:g[i].key,text:s,tooltip:s}));}if(r){i=r.length;while(i--){R=r[i];s=f.getFormattedRangeText(R.operation,R.value1,R.value2,R.exclude);h=new T({key:s,text:s,tooltip:s});h.data("range",R);t.push(h);}}o.setTokens(t);}if(o instanceof M){k=[];while(i--){k.push(g[i].key);}o.setSelectedKeys(k);}}};f.prototype._applyIndexes=function(){var g,i;if(!this._aFilterBarViewMetadata){return;}this._aFilterBarViewMetadata=this._sortByIndex(this._aFilterBarViewMetadata);g=this._aFilterBarViewMetadata.length;for(i=0;i<g;i++){if(this._aFilterBarViewMetadata[i].fields){this._aFilterBarViewMetadata[i].fields=this._sortByIndex(this._aFilterBarViewMetadata[i].fields);}}};f.prototype._sortByIndex=function(A){var g,i,l,j,h,r;if(!A||!A.length){return A;}r=[];g=[];l=A.length;for(i=0;i<l;i++){if(parseInt(A[i].index,10)||A[i].index===0){if(g.length===0){g.push(A[i]);}else{h=g.length;for(j=0;j<h;j++){if(g[j].index>A[i].index){g.splice(j,0,A[i]);break;}else if(j+1===g.length){g.push(A[i]);break;}}}}else{r.push(A[i]);}}l=g.length;for(i=0;i<l;i++){if(g[i].index>r.length){r.push(g[i]);}else{r.splice(g[i].index,0,g[i]);}}return r;};f.prototype._applyGroupId=function(){var g,i,h,j,o,n,k;g=this._aFilterBarViewMetadata.length;for(i=0;i<g;i++){if(!this._aFilterBarViewMetadata[i].fields){continue;}h=this._aFilterBarViewMetadata[i].fields.length;for(j=0;j<h;j++){o=this._aFilterBarViewMetadata[i].fields[j];if(o&&o.groupId&&o.groupId!==this._aFilterBarViewMetadata[i].groupName){n=undefined;for(k=0;k<g;k++){if(this._aFilterBarViewMetadata[k].groupName===o.groupId){n=this._aFilterBarViewMetadata[k];break;}}if(n){this._aFilterBarViewMetadata[i].fields.splice(j,1);j--;h--;n.fields=n.fields||[];n.fields.push(o);}}}}};f.prototype._createGroupMetadata=function(o){var g,G;G=this._oAdditionalConfiguration.getGroupConfigurationByKey(o.groupName);g={};g.groupName=o.groupName;g.groupLabel=this._getGroupLabel(o,G);g.fields=[];g.index=this._getGroupIndex(G);return g;};f.prototype._createGroupMetadataForCustomGroup=function(g){var G;G={};G.groupName=g.key;G.groupLabel=g.label;G.fields=[];G.index=this._getGroupIndex(g);return G;};f.prototype._createControl=function(o){var g,t,i=false,h,j;if(o.customControl){return o.customControl;}if(o.type==="Edm.Decimal"){if(o.precision||o.scale){h={};if(o.precision){h["maxIntegerDigits"]=parseInt(o.precision,10);}if(o.scale){h["maxFractionDigits"]=parseInt(o.scale,10);}}t=new e(h);}g=new o.fControlConstructor();if(o.fControlConstructor===a){g.bindProperty('dateValue',this.sFilterModelName+">/"+o.fieldName+"/low");g.bindProperty('secondDateValue',this.sFilterModelName+">/"+o.fieldName+"/high");}else if(o.fControlConstructor===C){if(g.setForceSelection){g.setForceSelection(true);}this._associateValueList(g,"items",o);g.bindProperty('selectedKey',this.sFilterModelName+">/"+o.fieldName);}else if(o.fControlConstructor===M){this._associateValueList(g,"items",o);g.attachSelectionChange(q.proxy(function(E){var k=E.getSource(),s=null,K=[],l;s=k.getSelectedItems();if(s){l=s.length;while(l--){K.push({key:s[l].getKey(),text:s[l].getText()});}}if(this.oModel){this.oModel.setProperty("/"+o.fieldName+"/items",K);}k.fireChange({value:""});},this));g.bindProperty('value',this.sFilterModelName+">/"+o.fieldName+"/value");}else if(o.fControlConstructor===b){if(o.hasValueHelpDialog){this._associateValueHelpDialog(g,o,o.filterRestriction!==sap.ui.comp.smartfilterbar.ControlConfiguration.FILTERTYPE.multiple,true);}else{g.setShowValueHelp(false);}g.bindProperty('value',{path:this.sFilterModelName+">/"+o.fieldName+"/value",type:t});}else if(o.fControlConstructor===I){if(o.filterRestriction===sap.ui.comp.smartfilterbar.ControlConfiguration.FILTERTYPE.interval){i=true;g.bindProperty('value',this.sFilterModelName+">/"+o.fieldName+"/low");if(!this.oResourceBundle){this.oResourceBundle=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");}if(!this.sIntervalPlaceholder){this.sIntervalPlaceholder=this.oResourceBundle.getText("INTERVAL_PLACEHOLDER_TEXT");}g.setPlaceholder(this.sIntervalPlaceholder);}else{g.bindProperty('value',{path:this.sFilterModelName+">/"+o.fieldName,type:t});}if(o.hasValueHelpDialog){g.setShowValueHelp(true);this._associateValueHelpDialog(g,o,false,false);}}else if(o.fControlConstructor===D){g.bindProperty('dateValue',this.sFilterModelName+">/"+o.fieldName);}if(this._oDateFormatSettings&&this._oDateFormatSettings.style&&g instanceof D){g.setDisplayFormat(this._oDateFormatSettings.style);}if(o.hasTypeAhead){g.setShowSuggestion(true);g.setFilterSuggests(false);this._associateValueList(g,"suggestionRows",o,true);}if(o.displayFormat==="UpperCase"&&g.attachChange&&g.setValue){g.attachChange(function(){var v=g.getValue();if(v){g.setValue(v.toUpperCase());}});}if(g instanceof I){if(!o.oValueListAnnotation&&!i&&o.maxLength){g.setMaxLength(parseInt(o.maxLength,10));}if(t){j=q.proxy(function(E){var B,k,s;if(E.getParameter("newValue")===""){s=sap.ui.core.ValueState.None;if(E.getParameter("property")==="value"){B=g.getBindingInfo("value");if(B&&B.binding){this.oModel.setProperty(B.binding.getPath(),null);}}}else{s=sap.ui.core.ValueState.Error;k=E.getParameter("exception");if(k){if(g.setValueStateText){g.setValueStateText(k.message);}}}if(g&&g.setValueState){g.setValueState(s);}},this);g.attachParseError(j);g.attachFormatError(j);g.attachValidationError(j);g.attachValidationSuccess(function(E){if(g&&g.setValueState){g.setValueState(sap.ui.core.ValueState.None);}});}}return g;};f.prototype._getControlConstructor=function(o){var g=I,h,i;if(o.isCustomFilterField){return;}h=(o.filterRestriction===sap.ui.comp.smartfilterbar.ControlConfiguration.FILTERTYPE.single);i=(o.filterRestriction===sap.ui.comp.smartfilterbar.ControlConfiguration.FILTERTYPE.interval);if(o.controlType===sap.ui.comp.smartfilterbar.ControlConfiguration.CONTROLTYPE.date){g=(i)?a:D;if(!i){o.filterRestriction=sap.ui.comp.smartfilterbar.ControlConfiguration.FILTERTYPE.single;}this._aFilterBarDateFieldNames.push(o.fieldName);}else if(o.controlType===sap.ui.comp.smartfilterbar.ControlConfiguration.CONTROLTYPE.dropDownList){g=(h)?C:M;if(!h){o.filterRestriction=sap.ui.comp.smartfilterbar.ControlConfiguration.FILTERTYPE.multiple;}}else if(!h&&!i){g=b;}return g;};f.prototype._associateValueHelpDialog=function(o,g,s,h){var v;v=new V({annotation:g.oValueListAnnotation,additionalAnnotations:g.additionalAnnotations,control:o,filterModel:this.oModel,filterProvider:this,model:this._oParentODataModel,preventInitialDataFetchInValueHelpDialog:g.preventInitialDataFetchInValueHelpDialog,supportMultiSelect:h,supportRanges:s,isSingleIntervalRange:g.filterRestriction===sap.ui.comp.smartfilterbar.ControlConfiguration.FILTERTYPE.interval,fieldName:g.fieldName,type:g.type,maxLength:g.maxLength,displayFormat:g.displayFormat,displayBehaviour:g.displayBehaviour,title:g.label});this._aValueHelpDialogProvider.push(v);if(h){o.attachTokenChange(q.proxy(function(E){var t=E.getSource().getTokens(),i=[],l,j=null,r=null,R=[];if(t){l=t.length;while(l--){j=t[l];r=j.data("range");if(r){R.push(r);}else{i.push({key:j.getKey(),text:j.getText()});}}}if(this.oModel){this.oModel.setProperty("/"+g.fieldName+"/items",i);this.oModel.setProperty("/"+g.fieldName+"/ranges",R);}o.fireChange({value:""});},this));}};f.prototype._associateValueList=function(o,A,g,h){if(g.oValueListAnnotation){this._aValueListProvider.push(new d({control:o,typeAheadEnabled:h,aggregation:A,displayFormat:g.displayFormat,displayBehaviour:g.displayBehaviour,annotation:g.oValueListAnnotation,filterModel:this.oModel,filterProvider:this,model:this._oParentODataModel}));}};f.prototype._createFieldMetadata=function(o){var g,h;o.fieldName=this._getFieldName(o);h=this._oAdditionalConfiguration.getControlConfigurationByKey(o.fieldName);g={};g.fullName=o.fullName;g.fieldName=o.fieldName;g.type=o.type;g.name=o.name;g.displayFormat=o.displayFormat;g.maxLength=o.maxLength;g.precision=o.precision;g.scale=o.scale;g.filterRestriction=this._getFilterRestriction(o,h);this._setAnnotationMetadata(g);g.hasValueHelpDialog=this._hasValueHelpDialog(g,h);g.preventInitialDataFetchInValueHelpDialog=h?h.preventInitialDataFetchInValueHelpDialog:true;g.controlType=this._getControlType(g,h);g.displayBehaviour=h?h.displayBehaviour:undefined;g.isCustomFilterField=!!(h&&h.customControl);g.visibleInAdvancedArea=!!(h&&h.visibleInAdvancedArea);g.label=this._getLabel(o,h);g.quickInfo=o.quickInfo;g.isMandatory=this._isMandatory(o,h);g.width=this._getWidth(h);g.isVisible=this._isVisible(h);g.groupId=this._getGroupID(o,h);g.index=this._getIndex(o,h);g.fControlConstructor=this._getControlConstructor(g);g.hasTypeAhead=this._hasTypeAhead(g,o,h);g.customControl=h?h.customControl:undefined;g.control=this._createControl(g);this._applyWidth(g);g.defaultFilterValues=h?h.defaultFilterValues:undefined;return g;};f.prototype._createBasicSearchFieldMetadata=function(){var o;o={};o.filterRestriction=sap.ui.comp.smartfilterbar.ControlConfiguration.FILTERTYPE.single;o.name=f.BASIC_SEARCH_FIELD_ID;o.fieldName=f.BASIC_SEARCH_FIELD_ID;o.label=undefined;o.isMandatory=false;o.isVisible=true;o.groupId=f.BASIC_FILTER_AREA_ID;o.index=0;o.control=new S({width:"28rem",showSearchButton:false});o.control.bindProperty('value',this.sFilterModelName+">/"+o.fieldName);return o;};f.prototype._applyWidth=function(o){if(o&&o.width&&o.control&&o.control.setWidth&&(typeof o.control.setWidth==='function')){o.control.setWidth(o.width);}};f.prototype._setAnnotationMetadata=function(o){var A=null;if(o){A=this._oMetadataAnalyser.getValueListAnnotation(o.fullName);o.oValueListAnnotation=A.primaryValueListAnnotation;o.additionalAnnotations=A.additionalAnnotations;}};f.prototype._createFieldMetadataForCustomFilterFields=function(o){var g;if(!o||!o.customControl){return undefined;}g={};g.name=o.key;g.fieldName=o.key;g.label=o.label;g.visibleInAdvancedArea=!!(o&&o.visibleInAdvancedArea);g.isVisible=this._isVisible(o);g.groupId=o.groupId;g.isMandatory=this._isMandatory(undefined,o);g.index=o.index;g.width=this._getWidth(o);g.control=o.customControl;g.isCustomFilterField=true;this._applyWidth(g);return g;};f.prototype._getFieldName=function(o){if(o.entityName===this.sEntityTypeName){return o.name;}else{return o.entityName+"."+o.name;}};f.prototype._hasValueHelpDialog=function(o,g){var v=true;if(g){if(g.controlType===sap.ui.comp.smartfilterbar.ControlConfiguration.CONTROLTYPE.dropDownList){v=false;}else if(g.hasValueHelpDialog!==true){v=false;}}if(o&&!o.oValueListAnnotation){if(o.filterRestriction===sap.ui.comp.smartfilterbar.ControlConfiguration.FILTERTYPE.single||o.filterRestriction===sap.ui.comp.smartfilterbar.ControlConfiguration.FILTERTYPE.multiple){v=false;}}return v;};f.prototype._isVisible=function(o){if(o&&o.isVisible===false){return false;}return true;};f.prototype._getWidth=function(o){if(o&&o.width){return o.width;}return undefined;};f.prototype._isMandatory=function(o,g){if(g&&g.mandatory!==sap.ui.comp.smartfilterbar.ControlConfiguration.MANDATORY.auto){return g.mandatory===sap.ui.comp.smartfilterbar.ControlConfiguration.MANDATORY.mandatory;}if(o){return o.requiredField;}return false;};f.prototype._getFilterRestriction=function(o,g){var s;if(g&&g.filterType&&g.filterType!==sap.ui.comp.smartfilterbar.ControlConfiguration.FILTERTYPE.auto){s=g.filterType;}else if(o.filterRestriction==="single-value"){s=sap.ui.comp.smartfilterbar.ControlConfiguration.FILTERTYPE.single;}else if(o.filterRestriction==="multi-value"){s=sap.ui.comp.smartfilterbar.ControlConfiguration.FILTERTYPE.multiple;}else if(o.filterRestriction==="interval"){s=sap.ui.comp.smartfilterbar.ControlConfiguration.FILTERTYPE.interval;}else{s=sap.ui.comp.smartfilterbar.ControlConfiguration.FILTERTYPE.auto;}return s;};f.prototype._getControlType=function(o,g){var s;if(g&&g.controlType&&g.controlType!==sap.ui.comp.smartfilterbar.ControlConfiguration.CONTROLTYPE.auto){s=g.controlType;}else if(o.type==="Edm.DateTime"&&o.displayFormat==="Date"){s=sap.ui.comp.smartfilterbar.ControlConfiguration.CONTROLTYPE.date;}else if(o.oValueListAnnotation&&o.oValueListAnnotation.semantics==="fixed-values"){s=sap.ui.comp.smartfilterbar.ControlConfiguration.CONTROLTYPE.dropDownList;}else{s=sap.ui.comp.smartfilterbar.ControlConfiguration.CONTROLTYPE.input;}return s;};f.prototype._getGroupID=function(o,g){if(g&&g.groupId){return g.groupId;}else if(o&&o.requiredField){return this._sBasicFilterAreaID;}return this._getGroupIDFromFieldGroup(o);};f.prototype._getGroupIDFromFieldGroup=function(o){var l=0,g=null,G;if(o&&this._aFieldGroupAnnotation&&this._aFieldGroupAnnotation.length){l=this._aFieldGroupAnnotation.length;while(l--){g=this._aFieldGroupAnnotation[l];if(g&&g.fields&&g.fields.indexOf(o.name)>-1){G=g.groupName;break;}}}return G;};f.prototype._getLabel=function(o,g){if(g&&g.label){return g.label;}return this._getLabelFromFieldGroup(o)||o.fieldLabel||o.fieldName;};f.prototype._getLabelFromFieldGroup=function(o){var l=0,g=null,L;if(o&&this._aFieldGroupAnnotation&&this._aFieldGroupAnnotation.length){l=this._aFieldGroupAnnotation.length;while(l--){g=this._aFieldGroupAnnotation[l];if(g&&g.fields&&g.fields.indexOf(o.name)>-1){L=g.labels[o.name];break;}}}return L;};f.prototype._getIndex=function(o,g){if(g&&(g.index||g.index===0)){return g.index;}return this._getIndexFromFieldGroup(o);};f.prototype._getIndexFromFieldGroup=function(o){var l=0,g=null,i;if(o&&this._aFieldGroupAnnotation&&this._aFieldGroupAnnotation.length){l=this._aFieldGroupAnnotation.length;while(l--){g=this._aFieldGroupAnnotation[l];if(g&&g.fields){i=g.fields.indexOf(o.name);if(i>-1){break;}i=undefined;}}}return i;};f.prototype._getGroupIndex=function(g){if(g&&(g.index||g.index===0)){return g.index;}};f.prototype._getGroupLabel=function(o,g){if(g&&g.label){return g.label;}return o.groupLabel||o.groupName;};f.prototype._hasTypeAhead=function(o,g,h){var H;H=true;if(h){H=h.hasTypeAhead;}else if(g.type!=="Edm.String"){return false;}if(!(o.fControlConstructor===I||o.fControlConstructor===b)){return false;}return H;};f.prototype.getModel=function(){return this.oModel;};f.prototype.getFilterBarViewMetadata=function(){return this._aFilterBarViewMetadata;};f.prototype.getParameters=function(){var p,B=null;if(this.oModel){B=this.oModel.getProperty("/"+f.BASIC_SEARCH_FIELD_ID);}if(this._sBasicSearchFieldName||B){p={custom:{"search-focus":this._sBasicSearchFieldName,"search":B||""}};}return p;};f.prototype.getFilters=function(g){var o=null;if(this.oModel){o=this.oModel.getData();}return f.generateFilters(g,o,this._oDateFormatSettings);};f.prototype.getFilterData=function(){return this.oModel?this.oModel.getData():null;};f.prototype.getFilterDataAsString=function(){return this.oModel?this.oModel.getJSON():null;};f.prototype.getFilledFilterData=function(g){var o,h={},i,s,v;o=this.oModel?this.oModel.getData():null;if(o&&g){i=g.length;while(i--){s=g[i];if(s&&s!==f.BASIC_SEARCH_FIELD_ID){v=o[s];if(v&&v.hasOwnProperty("low")){if(v.low){h[s]=v;}}else if(v&&v.hasOwnProperty("items")){if(v.value&&typeof v.value==="string"){v.value=v.value.trim();}if(v.items.length||(v.ranges&&v.ranges.length)||v.value){h[s]=v;}}else if(v){if(typeof v==="string"){v=v.trim();}if(v){h[s]=v;}}}if(i===0){s=f.CUSTOM_FIELDS_MODEL_PROPERTY;v=o[s];if(v){h[s]=v;}}}}return q.extend(true,{},h);};f.prototype.getFilledFilterDataAsString=function(g){return JSON.stringify(this.getFilledFilterData(g));};f.prototype.setFilterData=function(j,r){var o=null,g=null,k=null;if(this.oModel&&j){if(r){this._createInitialModel(false);}o=this._parseFilterData(j,r);if(o){this.oModel.setData(o,true);g=[];for(k in o){g.push(k);}this._handleFilterDataUpdate(g);}}};f.prototype.setFilterDataAsString=function(j,r){if(j){this.setFilterData(JSON.parse(j),r);}};f.prototype._parseFilterData=function(j,r){return f.parseFilterData(this.oModel.getData(),j,this._aFilterBarDateFieldNames,r);};f.prototype._handleFilterDataUpdate=function(g){var i=0,o,h,j;if(this._aFilterBarMultiValueFieldMetadata){i=this._aFilterBarMultiValueFieldMetadata.length;while(i--){if(!h){h=this.oModel.getData();}if(h){o=this._aFilterBarMultiValueFieldMetadata[i];if(g.indexOf(o.fieldName)>-1){j=h[o.fieldName];if(j){this._updateMultiValueControl(o.control,j.items,j.ranges);}}}}}};f.prototype.clear=function(){this._createInitialModel(false);};f.prototype.reset=function(){this._createInitialModel(true);};f.generateFilters=function(g,o,h){var i=[],A=null,E=null,j=null,s=null,v=null,k,l,m=null,L=0,n=0;if(g&&o){n=g.length;while(n--){s=g[n];if(s&&s!==f.BASIC_SEARCH_FIELD_ID){v=o[s];if(v&&v.hasOwnProperty("low")){if(v.low&&v.high){k=v.low;l=v.high;if(h&&h.UTC&&k instanceof Date&&l instanceof Date){k=f.getDateInUTCOffset(k);l=f.getDateInUTCOffset(l);}i.push(new F(s.replace(".","/"),sap.ui.model.FilterOperator.BT,k,l));}else if(v.low){m=v.low.split("-");if(m&&m.length===2){i.push(new F(s.replace(".","/"),sap.ui.model.FilterOperator.BT,m[0],m[1]));}else{i.push(new F(s.replace(".","/"),sap.ui.model.FilterOperator.EQ,v.low));}}}else if(v&&v.hasOwnProperty("items")){A=[];j=[];E=null;if(v&&v.hasOwnProperty("ranges")){m=v.ranges;L=m.length;while(L--){if(m[L].exclude){if(m[L].operation===sap.ui.model.FilterOperator.EQ){j.push(new F(s.replace(".","/"),sap.ui.model.FilterOperator.NE,m[L].value1));}}else{A.push(new F(s.replace(".","/"),m[L].operation,m[L].value1,m[L].value2));}}if(j.length){E=new F(j,true);}}m=v.items;L=m.length;while(L--){A.push(new F(s.replace(".","/"),sap.ui.model.FilterOperator.EQ,m[L].key));}if(v.value||v.value===0){if(typeof v.value==="string"){v.value=v.value.trim();}if(v.value||v.value===0){A.push(new F(s.replace(".","/"),sap.ui.model.FilterOperator.EQ,v.value));}}if(A.length){if(E){i.push(new F([new F(A,false),E],true));}else{i.push(new F(A,false));}}else if(E){i.push(E);}}else if(v||v===0){if(typeof v==="string"){v=v.trim();}if(h&&h.UTC&&v instanceof Date){v=f.getDateInUTCOffset(v);}if(v||v===0){i.push(new F(s.replace(".","/"),sap.ui.model.FilterOperator.EQ,v));}}}}}return(i.length>1)?[new F(i,true)]:i;};f.parseFilterData=function(o,i,g,r){var R={},s=null,v=null,n,j;if(!g){g=[];}if(o&&i){j=q.extend({},i,true);for(s in j){if(o.hasOwnProperty(s)&&s!==f.CUSTOM_FIELDS_MODEL_PROPERTY){v=o[s];n=j[s];if(v&&v.hasOwnProperty("low")){if(n.low&&n.high){R[s]=n;if(!(n.low instanceof Date)){R[s].low=new Date(n.low);}if(!(n.high instanceof Date)){R[s].high=new Date(n.high);}}else if(n.low&&!n.high){R[s]={low:n.low,high:null};}}else if(v&&v.hasOwnProperty("items")){if(n.items||n.ranges){R[s]=n;}else if(typeof n==="string"||typeof n==="number"){R[s]={value:n,items:[]};}}else{R[s]=null;if(typeof n==="string"||n instanceof Date){if(typeof n==="string"&&g.indexOf(s)>-1){R[s]=new Date(n);}else{R[s]=n;}}else if(n&&(n.value||n.value===0)){R[s]=n.value;}else if(n&&n.items&&n.items.length){R[s]=n.items[0].key;}}}else if(r||s===f.CUSTOM_FIELDS_MODEL_PROPERTY){R[s]=j[s];}}}return R;};f.getDateInUTCOffset=function(o){return new Date(o.valueOf()-o.getTimezoneOffset()*60*1000);};f.getFormattedExpressionFromDisplayBehaviour=function(s,i,g){var t=null;switch(s){case sap.ui.comp.smartfilterbar.ControlConfiguration.DISPLAYBEHAVIOUR.descriptionAndId:t=g+" ("+i+")";break;case sap.ui.comp.smartfilterbar.ControlConfiguration.DISPLAYBEHAVIOUR.idAndDescription:t=i+" ("+g+")";break;case sap.ui.comp.smartfilterbar.ControlConfiguration.DISPLAYBEHAVIOUR.descriptionOnly:t=g;break;default:t=i;break;}return t;};f.getFormattedRangeText=function(o,v,s,E){var t="";if(v){switch(o){case sap.ui.model.FilterOperator.EQ:t="="+v;break;case sap.ui.model.FilterOperator.GT:t=">"+v;break;case sap.ui.model.FilterOperator.GE:t=">="+v;break;case sap.ui.model.FilterOperator.LT:t="<"+v;break;case sap.ui.model.FilterOperator.LE:t="<="+v;break;case sap.ui.model.FilterOperator.Contains:t="*"+v+"*";break;case sap.ui.model.FilterOperator.StartsWith:t=v+"*";break;case sap.ui.model.FilterOperator.EndsWith:t="*"+v;break;case sap.ui.model.FilterOperator.BT:if(s){t=v+"..."+s;}break;}}if(E&&t){t="!("+t+")";}return t;};f.prototype.destroy=function(){var i=0;this._aFilterBarViewMetadata=null;this._aFilterBarDateFieldNames=null;this._aFilterBarMultiValueFieldMetadata=null;this._aFieldGroupAnnotation=null;if(this._oMetadataAnalyser&&this._oMetadataAnalyser.destroy){this._oMetadataAnalyser.destroy();}this._oMetadataAnalyser=null;if(this._aValueHelpDialogProvider){i=this._aValueHelpDialogProvider.length;while(i--){this._aValueHelpDialogProvider[i].destroy();}}this._aValueHelpDialogProvider=null;if(this._aValueListProvider){i=this._aValueListProvider.length;while(i--){this._aValueListProvider[i].destroy();}}this._aValueListProvider=null;this.oResourceBundle=null;this.sIntervalPlaceholder=null;this.sDefaultDropDownDisplayBehaviour=null;this.sDefaultTokenDisplayBehaviour=null;this._oSmartFilter=null;this.bIsDestroyed=true;};return f;},true);
