/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2015 SAP SE. All rights reserved
 */
sap.ui.define(['jquery.sap.global','sap/m/Dialog','sap/m/MessageBox','sap/m/MultiInput','sap/m/Token','sap/ui/comp/library','./ItemsCollection','sap/ui/core/Control','sap/ui/core/format/DateFormat','sap/ui/core/format/NumberFormat','sap/ui/table/Table'],function(q,D,M,a,T,l,I,C,b,N,c){"use strict";var V=D.extend("sap.ui.comp.valuehelpdialog.ValueHelpDialog",{metadata:{library:"sap.ui.comp",properties:{basicSearchText:{type:"string",group:"Misc",defaultValue:null},supportMultiselect:{type:"boolean",group:"Misc",defaultValue:true},supportRanges:{type:"boolean",group:"Misc",defaultValue:false},descriptionKey:{type:"string",group:"Misc",defaultValue:null},key:{type:"string",group:"Misc",defaultValue:null},supportRangesOnly:{type:"boolean",group:"Misc",defaultValue:false},maxIncludeRanges:{type:"string",group:"Misc",defaultValue:'-1'},maxExcludeRanges:{type:"string",group:"Misc",defaultValue:'-1'},displayFormat:{type:"string",group:"Misc",defaultValue:null},tokenDisplayBehaviour:{type:"string",group:"Misc",defaultValue:null},filterMode:{type:"boolean",group:"Misc",defaultValue:false}},aggregations:{filterBar:{type:"sap.ui.core.Control",multiple:false}},events:{ok:{},cancel:{}}}});V.prototype.setSupportMultiselect=function(e){this.setProperty("supportMultiselect",e);this.theTable.setSelectionMode(e?sap.ui.table.SelectionMode.MultiToggle:sap.ui.table.SelectionMode.Single);if(!e){this._oTokenizerGrid.addStyleClass("displayNone");}else{this._oTokenizerGrid.removeStyleClass("displayNone");}this.getBeginButton().setVisible(this.getSupportMultiselect());return this;};V.prototype.setSupportRanges=function(e){this.setProperty("supportRanges",e);if(e&&!this.getSupportRangesOnly()){if(!this._oRangeButton){this._oRangeButton=new sap.m.Button({type:sap.m.ButtonType.Transparent,text:this._oRb.getText("VALUEHELPDLG_RANGES"),press:this._onRangesPressed()}).addStyleClass("compVHRangesLink");this._oHeaderBar.addContentRight(this._oRangeButton);}else{this._oRangeButton.setVisible(true);}}if(!e&&!this.getSupportRangesOnly()&&this._oRangeButton){this._oRangeButton.setVisible(false);}return this;};V.prototype._onRangesPressed=function(){var t=this;return function(){if(t.getSupportRanges()){t.bCollectiveSearchActive=t.oSelectionButton.getVisible();t._fillRanges(true);}};};V.prototype._fillRanges=function(i){this._showRanges();if(this._oRangeButton){this._oRangeButton.setVisible(false);}if(this.oSelectionTitle){this.oSelectionTitle.setVisible(false);}if(this.oSelectionButton){this.oSelectionButton.setVisible(false);}this._oBackButton.setVisible(i);this.getBeginButton().setVisible(this.getSupportRangesOnly()||this.getSupportMultiselect());this._oTitle.setText(this.getFilterMode()?this.getTitle():this._oRb.getText("VALUEHELPDLG_RANGESTITLE",this.getTitle()));};V.prototype._onBackPressed=function(){var t=this;return function(){var f=function(){t._showNormalTable();if(t._oRangeButton){t._oRangeButton.setVisible(true);}if(t.oSelectionTitle){t.oSelectionTitle.setVisible(t.bCollectiveSearchActive);}if(t.oSelectionButton){t.oSelectionButton.setVisible(t.bCollectiveSearchActive);}t._oBackButton.setVisible(false);t._oTitle.setText(t._oRb.getText("VALUEHELPDLG_TITLE",t.getTitle()));};t._validateRanges(f);};};V.prototype._onSelectedItemsPressed=function(){var t=this;return function(){var f=function(){t.bCollectiveSearchActive=t.oSelectionButton.getVisible();t._showSelectedItems();if(t._oRangeButton){t._oRangeButton.setVisible(false);}if(t.oSelectionTitle){t.oSelectionTitle.setVisible(false);}if(t.oSelectionButton){t.oSelectionButton.setVisible(false);}t._oBackButton.setVisible(true);t._oTitle.setText(t._oRb.getText("VALUEHELPDLG_SELECTEDITEMSTITLE",t.getTitle()));};t._validateRanges(f);};};V.prototype.setTitle=function(t){this.setProperty("title",t);if(this._oTitle){this._oTitle.setText(this._oRb.getText("VALUEHELPDLG_TITLE",t));}};V.prototype.setFilterBar=function(o){this.setAggregation("filterBar",o);if(this._oMainGrid&&o){if(this._oFilterBar){this._oMainGrid.removeContent(this._oFilterBar);}this._oFilterBar=o;this._oMainGrid.insertContent(o,0);if(this._oFilterBar.getBasicSearchControl&&this._oFilterBar.getBasicSearchControl()){var B=this._oFilterBar.getBasicSearchControl();B.setValue(this.getBasicSearchText());this.setInitialFocus(B);}}};V.prototype.getFilterBar=function(){return this._oFilterBar;};V.prototype.setBasicSearchText=function(t){this.setProperty("basicSearchText",t);if(this._oFilterBar&&this._oFilterBar.getBasicSearchControl&&this._oFilterBar.getBasicSearchControl()){this._oFilterBar.getBasicSearchControl().setValue(t);}};V.prototype.setTokens=function(t){if(t.length){var n=0,k;for(var i=0;i<t.length;i++){var d=t[i];if(d.data("range")){var r=d.data("range");k=d.getKey();if(!k){k="range_"+n;n++;}var e=this._getFormatedRangeTokenText(r.operation,r.value1,r.value2,r.exclude,r.keyField);this._addToken2Tokenizer(k,e,r.exclude?this._oExcludedTokens:this._oSelectedTokens);this._oSelectedRanges[k]=r;}else{k=d.getKey();var s=d.getText();var L=d.data("longKey");var R=d.data("row");if(!L){L=k;}this._oSelectedItems.add(L,R?R:d.getText());this._oSelectedTokens.addToken(new T({key:L,text:s,tooltip:s}));}}}else{this._oSelectedItems.removeAll();this._oSelectedRanges={};}};V.prototype.open=function(){if(this.getSupportRangesOnly()||this.getFilterMode()){this._fillRanges(false);}this.setContentWidth(this._getDefaultContentWidth());D.prototype.open.apply(this);};V.prototype.getTable=function(){return this.theTable;};V.prototype._getDefaultContentWidth=function(){var n=0;if(this.theTable){n=this.theTable.getColumns().length;}var d=Math.max(1080,n*130);return d+"px";};V.prototype.resetTableState=function(){if(this.theTable){this.theTable.unbindRows();this.theTable.setNoDataText(this._oRb.getText("VALUEHELPDLG_TABLE_PRESSSEARCH"));}};V.prototype.TableStateSearchData=function(){if(this.theTable){this.theTable.setNoDataText(this._oRb.getText("VALUEHELPDLG_TABLE_PRESSSEARCH"));}};V.prototype.TableStateDataFilled=function(){if(this.theTable){this.theTable.setNoDataText(this._oRb.getText("VALUEHELPDLG_TABLE_NODATA"));}};V.prototype.TableStateDataSearching=function(){if(this.theTable){this.theTable.setNoDataText(this._oRb.getText("VALUEHELPDLG_TABLE_SEARCHING"));}};V.prototype.init=function(){D.prototype.init.apply(this);this.addStyleClass("compValueHelpDialog");this.setHorizontalScrolling(false);this.setVerticalScrolling(true);this._oRb=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");this._sTableTitle1=this._oRb.getText("VALUEHELPDLG_TABLETITLE1");this._sTableTitle2=this._oRb.getText("VALUEHELPDLG_TABLETITLE2");this._sTableTitleNoCount=this._oRb.getText("VALUEHELPDLG_TABLETITLENOCOUNT");this._sSelectedItemsTitle=this._oRb.getText("VALUEHELPDLG_SELECTEDITEMS");this._sNoneSelectedItemsTitle=this._oRb.getText("VALUEHELPDLG_NONESELECTEDITEMS");if(!this._aIncludeRangeOperations){this.setIncludeRangeOperations([sap.ui.comp.valuehelpdialog.ValueHelpRangeOperation.Contains,sap.ui.comp.valuehelpdialog.ValueHelpRangeOperation.EQ,sap.ui.comp.valuehelpdialog.ValueHelpRangeOperation.BT,sap.ui.comp.valuehelpdialog.ValueHelpRangeOperation.StartsWith,sap.ui.comp.valuehelpdialog.ValueHelpRangeOperation.EndsWith,sap.ui.comp.valuehelpdialog.ValueHelpRangeOperation.LT,sap.ui.comp.valuehelpdialog.ValueHelpRangeOperation.LE,sap.ui.comp.valuehelpdialog.ValueHelpRangeOperation.GT,sap.ui.comp.valuehelpdialog.ValueHelpRangeOperation.GE]);}if(!this._aExcludeRangeOperations){this.setExcludeRangeOperations([sap.ui.comp.valuehelpdialog.ValueHelpRangeOperation.EQ]);}this._oSelectedItems=new I();this._oSelectedRanges={};this._createHeaderBar();this._createTable();this._createTokenizer();this._updateTokenizer();this._oInnerGrid=new sap.ui.layout.Grid({width:"100%",defaultSpan:"L12 M12 S12",vSpacing:0,hSpacing:0,content:[this._oFilterBar,this.theTable]}).addStyleClass("compVHPadding");this._oMainGrid=new sap.ui.layout.Grid({width:"100%",defaultSpan:"L12 M12 S12",vSpacing:0,hSpacing:0,content:[this._oInnerGrid,this._oTokenizerGrid]});this.addContent(this._oMainGrid);this._fillFooter();};V.prototype._changeTableRowSelectionForKey=function(k,s){var i;var r=this.theTable.getBinding("rows");if(r.aKeys){for(i=0;i<r.aKeys.length;i++){if(r.aKeys[i]===k){if(s){this.theTable.addSelectionInterval(i,i);}else{this.theTable.removeSelectionInterval(i,i);}return;}}}else{this.oRows=this.theTable.getBinding("rows");for(i=0;i<this.oRows.aIndices.length;i++){var o=this.theTable.getContextByIndex(i);if(o){var d=o.getObject();if(d[this.getKey()]===k){if(s){this.theTable.addSelectionInterval(i,i);}else{this.theTable.removeSelectionInterval(i,i);}return;}}}}};V.prototype.update=function(){var i,j,o,d;this.oRows=this.theTable.getBinding("rows");this.ignoreSelectionChange=true;this.theTable.clearSelection();var e=this._oSelectedItems.getItems();var r=this.getKeys()&&this.getKeys().length>1?this.getKey()+"=":"";if(this.oRows.aKeys){for(j=0;j<e.length;j++){var k=e[j];var R=r+"'"+k+"'";for(i=0;i<this.oRows.aKeys.length;i++){var s=this.oRows.aKeys[i];var f=s===k;if(f||s.indexOf(R)>=0){if(!f){this._oSelectedItems.remove(k);var t=this._getTokenByKey(k,this._oSelectedTokens);if(t){t.setKey(s);}}d=this.theTable.getContextByIndex(i);if(d){o=d.getObject();this._oSelectedItems.add(s,o);}this.theTable.addSelectionInterval(i,i);break;}}}}else{for(j=0;j<e.length;j++){var g=e[j];for(i=0;i<this.oRows.aIndices.length;i++){d=this.theTable.getContextByIndex(i);if(d){o=d.getObject();if(o[this.getKey()]===g){this._oSelectedItems.add(o[this.getKey()],o);this.theTable.addSelectionInterval(i,i);break;}}}}}this.ignoreSelectionChange=false;this._updateTitles();};V.prototype._createHeaderBar=function(){this._oBackButton=new sap.m.Button({type:sap.m.ButtonType.Transparent,icon:"sap-icon://nav-back",text:this._oRb.getText("VALUEHELPDLG_BACK"),press:this._onBackPressed(),visible:false});this._oTitle=new sap.m.Text({text:this._oRb.getText("VALUEHELPDLG_TITLE",this.getTitle()),wrapping:false}).addStyleClass("titleText").unbindText();this.oSelectionTitle=new sap.m.Text({visible:false,wrapping:false}).addStyleClass("titleText");this.oSelectionButton=new sap.m.Button({icon:"sap-icon://navigation-down-arrow",visible:false});this._oHeaderBar=new sap.m.Bar({contentLeft:[this._oBackButton],contentMiddle:[this._oTitle,this.oSelectionTitle,this.oSelectionButton]});this.setCustomHeader(this._oHeaderBar);};V.prototype._fillFooter=function(){var t=this;this.setBeginButton(new sap.m.Button({text:t._oRb.getText("VALUEHELPDLG_OK"),press:t._onCloseAndTakeOverValues(),visible:this.getSupportMultiselect()}));this.setEndButton(new sap.m.Button({text:t._oRb.getText("VALUEHELPDLG_CANCEL"),press:t._onCancel()}));};V.prototype._createTokenizer=function(){var t=this;if(this._oTokenizerGrid){return this._oTokenizerGrid;}this._oSelectedTokenTitle=new sap.m.Text().addStyleClass("compVHSelectedItemsText");this._oSelectedTokens=new sap.m.Tokenizer({tokenChange:function(o){if(t._ignoreRemoveToken){return;}if(o.getParameter("type")===a.TokenChangeType.Removed){var k=o.getParameter("token").getKey();if(t._oSelectedRanges&&t._oSelectedRanges[k]){t._removeRangeByKey(k,false);t._updateTitles();}else{t._oSelectedItems.remove(k);t._removeTokenFromTokenizer(k,t._oSelectedTokens);t._updateTitles();t.ignoreSelectionChange=true;t._changeTableRowSelectionForKey(k,false);t.ignoreSelectionChange=false;}setTimeout(function(){var i=t._oSelectedTokens.getTokens().length-1;if(i>=0){t._oSelectedTokens.getTokens()[i].focus();}});}}}).addStyleClass("compVHTokensDiv");this._oRemoveAllSelectedItemsBtn=new sap.m.Button({type:sap.m.ButtonType.Transparent,icon:sap.ui.core.IconPool.getIconURI("sys-cancel"),press:function(){t._oSelectedTokens.removeAllTokens();for(var k in t._oSelectedRanges){t._removeRangeByKey(k,false);}t._oSelectedItems.removeAll();t.ignoreSelectionChange=true;t.theTable.clearSelection();t.ignoreSelectionChange=false;t._updateTitles();}}).addStyleClass("compVHRemoveAllBtn");var h=new sap.ui.layout.HorizontalLayout({content:[this._oSelectedTokens,this._oRemoveAllSelectedItemsBtn]}).addStyleClass("compVHTokenizerHLayout");this._oIncludeTokenGrid=new sap.ui.layout.Grid({width:"100%",defaultSpan:"L12 M12 S12",hSpacing:0,vSpacing:0,content:[this._oSelectedTokenTitle,h]});this._oExcludedTokenTitle=new sap.m.Text().addStyleClass("compVHSelectedItemsText");this._oExcludedTokens=new sap.m.Tokenizer({tokenChange:function(o){if(t._ignoreRemoveToken){return;}if(o.getParameter("type")===a.TokenChangeType.Removed){var k=o.getParameter("token").getKey();t._removeRangeByKey(k,true);t._updateTitles();}}}).addStyleClass("compVHTokensDiv");this._oRemoveAllExcludeItemsBtn=new sap.m.Button({type:sap.m.ButtonType.Transparent,icon:sap.ui.core.IconPool.getIconURI("sys-cancel"),press:function(){t._oExcludedTokens.removeAllTokens();for(var k in t._oSelectedRanges){t._removeRangeByKey(k,true);}t._updateTitles();}}).addStyleClass("compVHRemoveAllBtn");var H=new sap.ui.layout.HorizontalLayout({content:[this._oExcludedTokens,this._oRemoveAllExcludeItemsBtn]}).addStyleClass("compVHTokenizerHLayout");this._oExcludeTokenGrid=new sap.ui.layout.Grid({width:"100%",defaultSpan:"L12 M12 S12",hSpacing:0,vSpacing:0,content:[this._oExcludedTokenTitle,H]});this._oShowAllLink=new sap.m.Button({type:sap.m.ButtonType.Transparent,text:this._oRb.getText("VALUEHELPDLG_SHOWALL"),press:this._onSelectedItemsPressed(),visible:(this.fSingleRowCallback!==undefined)&&(!this.getSupportRangesOnly())}).addStyleClass("compVHShowAllLink");this._oTokenizerGrid=new sap.ui.layout.Grid({width:"100%",defaultSpan:"L12 M12 S12",hSpacing:0,vSpacing:0,content:[this._oIncludeTokenGrid,this._oExcludeTokenGrid,this._oShowAllLink]}).addStyleClass("compVHDarkBackground");if(!this.getSupportMultiselect()){this._oTokenizerGrid.addStyleClass("displayNone");}return this._oTokenizerGrid;};V.prototype._addToken2Tokenizer=function(k,t,o){var d=this._getTokenByKey(k,o);if(d){d.setText(t);d.setTooltip(t);}else{o.addToken(new T({key:k,text:t,tooltip:t}));this._updateTokenizer();}};V.prototype._getTokenByKey=function(k,t){var d=t.getTokens();for(var i=0;i<d.length;i++){var e=d[i];if(e.getKey()===k){return e;}}return null;};V.prototype._removeToken=function(k){if(!this._removeTokenFromTokenizer(k,this._oSelectedTokens)){this._removeTokenFromTokenizer(k,this._oExcludedTokens);}};V.prototype._removeTokenFromTokenizer=function(k,t){var d=this._getTokenByKey(k,t);if(d){this._ignoreRemoveToken=true;t.removeToken(d);this._ignoreRemoveToken=false;this._updateTokenizer();return true;}return false;};V.prototype._updateTokenizer=function(){var n=this._oSelectedTokens.getTokens().length;var t=this._sSelectedItemsTitle.replace("{0}",n.toString());this._oSelectedTokenTitle.setText(n===0?this._sNoneSelectedItemsTitle:t);this._oRemoveAllSelectedItemsBtn.setEnabled(n!==0);var d=this._oExcludedTokens.getTokens().length;this._oExcludedTokenTitle.setText(this._oRb.getText("VALUEHELPDLG_EXCLUDEDITEMS",d.toString()));if(d===0){this._oExcludeTokenGrid.addStyleClass("displayNone");}else{this._oExcludeTokenGrid.removeStyleClass("displayNone");}this._oShowAllLink.setVisible(!this.getSupportRangesOnly()&&this.fSingleRowCallback!==undefined&&(n+d>0));this._onMyResize();};V.prototype._removeRangeByKey=function(k,i){var r=this._oSelectedRanges[k];if(r.exclude===i){if(!r._oGrid){delete this._oSelectedRanges[k];if(this._oFilterPanel){if(r.exclude){this._oFilterPanel._oExcludeFilterPanel.removeCondition(k);}else{this._oFilterPanel._oIncludeFilterPanel.removeCondition(k);}}}}};V.prototype._showNormalTable=function(){this.removeAllContent();this.setVerticalScrolling(true);this.setContentHeight("");this.setContentWidth(this._getDefaultContentWidth());this._oMainGrid.addContent(this._oTokenizerGrid);this.addContent(this._oMainGrid);this._updateTitles();};V.prototype._showRanges=function(){this.removeAllContent();this.setVerticalScrolling(false);if(!this.getSupportRangesOnly()&&!this.getFilterMode()){this.setContentHeight(this._iResizeDomHeight+"px");this._onMyResize();}this.addContent(this._getRanges());if(this.getMaxIncludeRanges()==="-1"&&this.getMaxExcludeRanges()!=="0"&&!this.getFilterMode()){this._oRanges.addContent(this._oTokenizerGrid);}};V.prototype._getRanges=function(){if(!this._oRanges){this._oRanges=this._createRanges();}return this._oRanges;};V.prototype._createRanges=function(){q.sap.require("sap.m.P13nConditionPanel");q.sap.require("sap.m.P13nFilterPanel");this._oFilterPanel=new sap.m.P13nFilterPanel({maxIncludes:this.getMaxIncludeRanges(),maxExcludes:this.getMaxExcludeRanges(),containerQuery:true,addFilterItem:q.proxy(function(E){var p=E.mParameters;var o={exclude:p.filterItemData.exclude,keyField:p.filterItemData.columnKey,operation:p.filterItemData.operation,value1:p.filterItemData.value1,value2:p.filterItemData.value2};this._oSelectedRanges[p.key]=o;var t=this._getFormatedRangeTokenText(o.operation,o.value1,o.value2,o.exclude,o.keyField);this._addToken2Tokenizer(p.key,t,o.exclude?this._oExcludedTokens:this._oSelectedTokens);this._updateTokenizer();},this),removeFilterItem:q.proxy(function(E){var p=E.mParameters;delete this._oSelectedRanges[p.key];this._removeToken(p.key);this._updateTokenizer();},this),updateFilterItem:q.proxy(function(E){var p=E.mParameters;var o=this._oSelectedRanges[p.key];o.exclude=p.filterItemData.exclude;o.keyField=p.filterItemData.columnKey;o.operation=p.filterItemData.operation;o.value1=p.filterItemData.value1;o.value2=p.filterItemData.value2;var t=this._getFormatedRangeTokenText(o.operation,o.value1,o.value2,o.exclude,o.keyField);this._addToken2Tokenizer(p.key,t,o.exclude?this._oExcludedTokens:this._oSelectedTokens);this._updateTokenizer();},this)});this._oFilterPanel.setIncludeOperations(this._aIncludeRangeOperations);this._oFilterPanel.setExcludeOperations(this._aExcludeRangeOperations);if(this._aRangeKeyFields){this._aRangeKeyFields.forEach(function(i){i["text"]=i.label;});this._oFilterPanel.setKeyFields(this._aRangeKeyFields);}var d=[];if(this._oSelectedRanges){for(var r in this._oSelectedRanges){var e=this._oSelectedRanges[r];d.push({key:r,exclude:e.exclude,keyField:e.keyField,operation:e.operation,value1:e.value1,value2:e.value2});}}this._oFilterPanel.setConditions(d);this._oRangeScrollContainer=new sap.m.ScrollContainer({vertical:true,horizontal:false,width:"100%",height:"300px",content:[this._oFilterPanel]});var R=new sap.ui.layout.Grid({width:"100%",defaultSpan:"L12 M12 S12",vSpacing:0,hSpacing:0,content:[this._oRangeScrollContainer]});this._sValidationDialogTitle=this._oRb.getText("VALUEHELPVALDLG_TITLE");this._sValidationDialogMessage=this._oRb.getText("VALUEHELPVALDLG_MESSAGE");this._sValidationDialogFieldMessage=this._oRb.getText("VALUEHELPVALDLG_FIELDMESSAGE");return R;};V.prototype._validateRanges=function(f){if(this._oRanges&&this.getContent()[0]===this._getRanges()){var i=this._oFilterPanel.validateConditions();if(!i){M.show(this._sValidationDialogMessage,{icon:M.Icon.WARNING,title:this._sValidationDialogTitle,actions:[M.Action.OK,M.Action.CANCEL],styleClass:!!this.$().closest(".sapUiSizeCompact").length?"sapUiSizeCompact":"",onClose:function(r){if(r===M.Action.OK&&f){f();}}});return;}}f();};V.prototype._showSelectedItems=function(){this.removeAllContent();this.setVerticalScrolling(true);this.setContentHeight("");this.setContentWidth(this._getDefaultContentWidth());this.addContent(this._getSelectedItemsTable());var t=this._oSelectedItemsTable;var m=t.getModel();var d=this._oSelectedItems.getModelData();this._updateMissingRows(d);m.setData(d);this.ignoreSelectionChange=true;t.clearSelection();t.addSelectionInterval(0,this._oSelectedItems.getItems().length-1);this.ignoreSelectionChange=false;var n=t.getSelectedIndices()?t.getSelectedIndices().length:0;t.setTitle(this._oRb.getText("VALUEHELPDLG_SELECTEDITEMS",n.toString()));};V.prototype._updateMissingRows=function(m){if(this.fSingleRowCallback&&this.getContent()[0]===this._getSelectedItemsTable()){var i=this._getMissingRowIndex(m);if(i>=0){var t=this;this.fSingleRowCallback(m[i].missing,function(d){delete m[i].missing;m[i]=d;t._oSelectedItems.add(d[t.getKey()],d);t._updateMissingRows(m);t.invalidate();});}}};V.prototype.setUpdateSingleRowCallback=function(s){this.fSingleRowCallback=s;if(this._oShowAllLink){this._oShowAllLink.setVisible(this.fSingleRowCallback!==undefined);}};V.prototype._getMissingRowIndex=function(m){for(var i=0;i<m.length;i++){if(m[i].missing){return i;}}return-1;};V.prototype._getSelectedItemsTable=function(){if(!this._oSelectedItemsTable){this._oSelectedItemsTable=this._createSelectedItemsTable();}return this._oSelectedItemsTable;};V.prototype._createSelectedItemsTable=function(){var t=this;var o=new c({title:this._oRb.getText("VALUEHELPDLG_SELECTEDITEMS"),selectionBehavior:sap.ui.table.SelectionBehavior.Row,selectionMode:sap.ui.table.SelectionMode.MultiToggle,noDataText:this._oRb.getText("VALUEHELPDLG_SELECTEDITEMSTABLE_NODATA"),rowHeight:32,rowSelectionChange:function(d){if(t.ignoreSelectionChange){return;}var e=d.getSource();var f=d.getParameter("rowIndices");var i,n=f.length;for(i=0;i<n;i++){var g=f[i];var h=e.getContextByIndex(g);var r=h?h.getObject():null;if(r){var k=r[t.getKey()];t.ignoreSelectionChange=true;if(e.isIndexSelected(g)){t._oSelectedItems.add(k,r);t._addToken2Tokenizer(k,t._getFormatedTokenText(k),t._oSelectedTokens);t._changeTableRowSelectionForKey(k,true);}else{t._oSelectedItems.remove(k);t._removeTokenFromTokenizer(k,t._oSelectedTokens);t._changeTableRowSelectionForKey(k,false);}t.ignoreSelectionChange=false;}}n=e.getSelectedIndices()?e.getSelectedIndices().length:0;e.setTitle(t._oRb.getText("VALUEHELPDLG_SELECTEDITEMS",n.toString()));}}).addStyleClass("compVHSelectedItemsTable");o.bindAggregation("columns","columns>/cols",function(i,d){return new sap.ui.table.Column(i,{label:"{columns>label}",template:new sap.m.Text({wrapping:false}).bindText(d.getProperty("template")),width:"{columns>width}"});});o.bindRows("/");var m=new sap.ui.model.json.JSONModel();o.setModel(m);return o;};V.prototype._createTable=function(){var t=this;var o=new c({title:"Items",selectionBehavior:sap.ui.table.SelectionBehavior.Row,selectionMode:this.getSupportMultiselect()?sap.ui.table.SelectionMode.MultiToggle:sap.ui.table.SelectionMode.Single,noDataText:this._oRb.getText("VALUEHELPDLG_TABLE_PRESSSEARCH"),rowHeight:32,rowSelectionChange:function(d){if(t.ignoreSelectionChange){return;}var e=d.getSource();var f=d.getParameter("rowIndices");var i,n=f.length;var g;var h;var r;for(i=0;i<n;i++){g=f[i];h=e.getContextByIndex(g);r=h?h.getObject():null;if(!r){M.show(t._oRb.getText("VALUEHELPDLG_SELECTIONFAILED"),{icon:M.Icon.ERROR,title:t._oRb.getText("VALUEHELPDLG_SELECTIONFAILEDTITLE"),actions:[M.Action.OK],styleClass:!!this.$().closest(".sapUiSizeCompact").length?"sapUiSizeCompact":""});return;}}var u=false;if(t.theTable.getBinding("rows").aKeys){u=true;}for(i=0;i<n;i++){g=f[i];h=e.getContextByIndex(g);r=h?h.getObject():null;if(r){var k;if(u){k=h.sPath.substring(1);}else{k=r[t.getKey()];}if(e.isIndexSelected(g)){t._oSelectedItems.add(k,r);t._addToken2Tokenizer(k,t._getFormatedTokenText(k),t._oSelectedTokens);}else{t._oSelectedItems.remove(k);t._removeTokenFromTokenizer(k,t._oSelectedTokens);}}}t._updateTitles();if(!t.getSupportMultiselect()){t._onCloseAndTakeOverValues()();}}}).addStyleClass("compVHMainTable");o.bindAggregation("columns","columns>/cols",function(i,d){var e,f;if(d.getProperty("type")==="string"){f={path:d.getProperty("template")};}if(d.getProperty("type")==="boolean"){e=new sap.m.CheckBox({enabled:false,selected:{path:d.getProperty("template")}});}else{e=new sap.m.Text({wrapping:false,text:{path:d.getProperty("template"),type:d.getProperty("oType")},tooltip:f});}return new sap.ui.table.Column(i,{label:"{columns>label}",tooltip:"{columns>label}",template:e,width:"{columns>width}",hAlign:e instanceof sap.m.CheckBox?sap.ui.core.HorizontalAlign.Center:sap.ui.core.HorizontalAlign.Begin,filterProperty:d.getProperty("filter")});});this.theTable=o;};V.prototype._onCloseAndTakeOverValues=function(){var t=this;return function(e){var f=function(){var r;var d=t._oSelectedItems.getSelectedItemsTokenArray(t.getKey(),t.getDescriptionKey(),t.getTokenDisplayBehaviour());if(t._oSelectedRanges){var i=0;for(var g in t._oSelectedRanges){r=t._oSelectedRanges[g];var s=r.tokenValue;if(!s){s=t._getFormatedRangeTokenText(r.operation,r.value1,r.value2,r.exclude,r.keyField);}if(!r._oGrid||r._oGrid.select.getSelected()){d.push(new T({key:"range_"+i,text:s,tooltip:s}).data("range",{"exclude":r.exclude,"operation":r.operation,"keyField":r.keyField,"value1":r.value1,"value2":r.value2}));i++;}}}t.fireOk({"tokens":d});};t._validateRanges(f);};};V.prototype._onCancel=function(){var t=this;return function(e){t.fireCancel();};};V.prototype._updateTitles=function(){this._updateTableTitle();this._updateTokenizer();};V.prototype._updateTableTitle=function(){var d=0;this.oRows=this.theTable.getBinding("rows");var s=false;if(s&&this.getModel()&&this.getModel().isCountSupported){s=this.getModel().isCountSupported();}if(s){if(this.oRows){d=this.oRows.getLength();}this.theTable.setTitle(this._sTableTitle1.replace("{0}",d));}else{this.theTable.setTitle(this._sTableTitleNoCount);}};V.prototype.onBeforeRendering=function(){D.prototype.onBeforeRendering.apply(this);this._deregisterMyResizeHandler();};V.prototype.onAfterRendering=function(){D.prototype.onAfterRendering.apply(this);if(this.theTable){this._registerMyResizeHandler();this._updateTitles();}};V.prototype.fireAfterOpen=function(p){D.prototype.fireAfterOpen.apply(this);if(this.theTable){this.theTable.invalidate();}if(this.getSupportRangesOnly()||this.getFilterMode()){this.setContentHeight(this._iResizeDomHeight+"px");this.setContentWidth(this._iResizeDomWidth+"px");this._onMyResize();}};V.prototype.exit=function(){this._deregisterMyResizeHandler();var d=function(o){if(o&&o.destroy){o.destroy();}return null;};this._oTokenizerGrid=d(this._oTokenizerGrid);this._oRanges=d(this._oRanges);this._oFilterPanel=d(this._oFilterPanel);this._oSelectedItemsTable=d(this._oSelectedItemsTable);this.theTable=d(this.theTable);this._aKeys=d(this._aKeys);this._aRangeKeyFields=d(this._aRangeKeyFields);this._aIncludeRangeOperations=d(this._aIncludeRangeOperations);this._aExcludeRangeOperations=d(this._aExcludeRangeOperations);this._oFilterBar=d(this._oFilterBar);this._oRb=d(this._oRb);this._sTableTitle1=d(this._sTableTitle1);this._sTableTitle2=d(this._sTableTitle2);this._sTableTitleNoCount=d(this._sTableTitleNoCount);this._sSelectedItemsTitle=d(this._sSelectedItemsTitle);this._sNoneSelectedItemsTitle=d(this._sNoneSelectedItemsTitle);this._sValidationDialogTitle=d(this._sValidationDialogTitle);this._sValidationDialogMessage=d(this._sValidationDialogMessage);this._sValidationDialogFieldMessage=d(this._sValidationDialogFieldMessage);this._oSelectedItems=d(this._oSelectedItems);this._oSelectedRanges=d(this._oSelectedRanges);};V.prototype.setKeys=function(k){this._aKeys=k;};V.prototype.getKeys=function(){return this._aKeys;};V.prototype.setRangeKeyFields=function(r){this._aRangeKeyFields=r;};V.prototype.getRangeKeyFields=function(){return this._aRangeKeyFields;};V.prototype.setIncludeRangeOperations=function(o){this._aIncludeRangeOperations=o;if(this._oFilterPanel){this._oFilterPanel.setIncludeOperations(this._aIncludeRangeOperations);}};V.prototype.setExcludeRangeOperations=function(o){this._aExcludeRangeOperations=o;if(this._oFilterPanel){this._oFilterPanel.setExcludeOperations(this._aExcludeRangeOperations);}};V.prototype._createRowKey=function(k){var p=this.oRows.sPath;var P="";var K=this.getKeys();var i,n=K.length;if(p[0]==="/"){p=p.substr(1);}for(i=0;i<n;i++){if(i>0){P+=",";}if(n>1){P+=K[i]+"=";}P+="'"+((K[i]===this.getKey())?k:".*")+"'";}return p+"\\("+P+"\\)";};V.prototype._getFormatedTokenText=function(k){var i=this._oSelectedItems.getItem(k);var t=i[this.getDescriptionKey()];var d=i[this.getKey()];if(t===undefined){if(typeof i==="string"){t=i;}else{t=k;}}else{if(t===""){t=k;}else{q.sap.require("sap.ui.comp.smartfilterbar.FilterProvider");t=sap.ui.comp.smartfilterbar.FilterProvider.getFormattedExpressionFromDisplayBehaviour(this.getTokenDisplayBehaviour()?this.getTokenDisplayBehaviour():sap.ui.comp.smartfilterbar.ControlConfiguration.DISPLAYBEHAVIOUR.descriptionAndId,d,t);}}return t;};V.prototype._getFormatedRangeTokenText=function(o,v,s,e,k){var t="";var d;var f;if(this._aRangeKeyFields&&this._aRangeKeyFields.length>1){for(var i=0;i<this._aRangeKeyFields.length;i++){d=this._aRangeKeyFields[i];if(typeof d!=="string"){if(d.key===k){break;}}}}if(d){switch(d.type){case"numeric":var F;if(d.precision||d.scale){F={};if(d.precision){F["maxIntegerDigits"]=parseInt(d.precision,10);}if(d.scale){F["maxFractionDigits"]=parseInt(d.scale,10);}}f=N.getFloatInstance(F);break;case"date":f=b.getDateInstance();break;}if(f){if(v){v=f.format(v);}if(s){s=f.format(s);}}}if(v!==""){switch(o){case sap.ui.comp.valuehelpdialog.ValueHelpRangeOperation.Initial:t="=''";break;case sap.ui.comp.valuehelpdialog.ValueHelpRangeOperation.EQ:t="="+v;break;case sap.ui.comp.valuehelpdialog.ValueHelpRangeOperation.GT:t=">"+v;break;case sap.ui.comp.valuehelpdialog.ValueHelpRangeOperation.GE:t=">="+v;break;case sap.ui.comp.valuehelpdialog.ValueHelpRangeOperation.LT:t="<"+v;break;case sap.ui.comp.valuehelpdialog.ValueHelpRangeOperation.LE:t="<="+v;break;case sap.ui.comp.valuehelpdialog.ValueHelpRangeOperation.Contains:t="*"+v+"*";break;case sap.ui.comp.valuehelpdialog.ValueHelpRangeOperation.StartsWith:t=v+"*";break;case sap.ui.comp.valuehelpdialog.ValueHelpRangeOperation.EndsWith:t="*"+v;break;case sap.ui.comp.valuehelpdialog.ValueHelpRangeOperation.BT:if(s!==""){t=v+"..."+s;break;}}}if(e&&t!==""){t="!("+t+")";}if(d&&d.label&&t!==""){t=d.label+": "+t;}return t;};V.prototype._onMyResize=function(){if(!this.getDomRef("scroll")){return;}if(this._oRangeScrollContainer){var t=this._oTokenizerGrid.getDomRef()?this._oTokenizerGrid.getDomRef().offsetHeight:0;var s=this.getDomRef("scroll").offsetHeight;this._oRangeScrollContainer.$().css("height",(s-t)+"px");}};V.prototype._reposition=function(){D.prototype._reposition.apply(this);this._onMyResize();};D.prototype._deregisterMyResizeHandler=function(){if(this._sResizeListenerId2){sap.ui.core.ResizeHandler.deregister(this._sResizeListenerId2);this._sResizeListenerId2=null;}};V.prototype._registerMyResizeHandler=function(){if(!this._fnMyContentResize){this._fnMyContentResize=q.proxy(this._onMyResize,this);}if(!this._sResizeListenerId2&&this.getDomRef()){var r=this.getDomRef("scroll");this._sResizeListenerId2=sap.ui.core.ResizeHandler.register(r,this._fnMyContentResize);}};sap.ui.comp.valuehelpdialog.ValueHelpRangeOperation={BT:"BT",EQ:"EQ",Contains:"Contains",StartsWith:"StartsWith",EndsWith:"EndsWith",LT:"LT",LE:"LE",GT:"GT",GE:"GE",Initial:"Initial"};return V;},true);
