/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2015 SAP SE. All rights reserved
 */
sap.ui.define(['jquery.sap.global','sap/m/ActionSheet','sap/m/Button','sap/m/CheckBox','sap/m/Dialog','sap/m/Input','sap/m/Label','sap/m/ResponsivePopover','sap/m/SelectList','sap/ui/comp/library','sap/ui/comp/transport/TransportSelection','./EditableVariantItem','./VariantItem','sap/ui/core/Control','sap/ui/core/Item','sap/ui/core/ValueState','sap/ui/layout/HorizontalLayout'],function(q,A,B,C,D,I,L,R,S,l,T,E,V,a,b,c,H){"use strict";var d=a.extend("sap.ui.comp.variants.VariantManagement",{metadata:{library:"sap.ui.comp",properties:{initialSelectionKey:{type:"string",group:"Misc",defaultValue:null},enabled:{type:"boolean",group:"Misc",defaultValue:true},defaultVariantKey:{type:"string",group:"Misc",defaultValue:null},selectionKey:{type:"string",group:"Misc",defaultValue:null},showCreateTile:{type:"boolean",group:"Misc",defaultValue:false},showExecuteOnSelection:{type:"boolean",group:"Misc",defaultValue:false},showShare:{type:"boolean",group:"Misc",defaultValue:false},lifecycleSupport:{type:"boolean",group:"Misc",defaultValue:false},standardItemText:{type:"string",group:"Misc",defaultValue:null}},defaultAggregation:"items",aggregations:{items:{type:"sap.ui.core.Item",multiple:true,singularName:"item",deprecated:true},variantItems:{type:"sap.ui.comp.variants.VariantItem",multiple:true,singularName:"variantItem"}},events:{save:{},manage:{},select:{}}}});d.prototype.init=function(){var t=this;this.STANDARDVARIANTKEY="*standard*";this.aRemovedVariants=[];this.aRenamedVariants=[];this.aRemovedVariantTransports=[];this.aExeVariants=[];this.oResourceBundle=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");this.lastSelectedVariantKey=this.STANDARDVARIANTKEY;this.bVariantItemMode=false;this.oSelectedItem=null;this.sNewDefaultKey="";this.bDirty=false;this.bManagementTableInitialized=false;this.sTransport=null;this.sPackage=null;this.aEvents=[];this.bEventRunning=false;this.bPopoverOpen=false;this.oVariantSelectionPage=null;this.oActions=null;this.oActionSheet=null;this.oActionSheetManage=null;this.oActionSheetSave=null;this.oActionSheetSaveAs=null;this.bManualVariantKey=false;this.bFireSelect=false;this.bExecuteOnSelectForStandard=false;q.sap.require("sap.ui.model.json.JSONModel");this.oModel=new sap.ui.model.json.JSONModel({enabled:false});this.setModel(this.oModel,"save_enablement");this.oVariantManage=new B(this.getId()+"-manage",{text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_MANAGE"),enabled:false,press:function(){t._openVariantManagementDialog();}});this.oVariantManage.addStyleClass("sapUiHideOnPhone");this.oVariantSave=new B(this.getId()+"-mainsave",{text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_SAVE"),press:function(){var e=t._createEvent("variantSavePressed",t._variantSavePressed);t._addEvent(e);},enabled:false});this.oVariantSave.setModel(this.oModel);this.oVariantSave.addStyleClass("sapUiHideOnPhone");this.oVariantSaveAs=new B(this.getId()+"-saveas",{text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_SAVEAS"),press:function(){t._openSaveAsDialog();}});this.oVariantSaveAs.addStyleClass("sapUiHideOnPhone");this.oVariantText=new L(this.getId()+"-text");this._setStandardText();this.oVariantText.addStyleClass("sapUICompVarMngmtText");this.oVariantText.addStyleClass("sapUICompVarMngmtEnabled");this.oVariantText.addStyleClass("sapMH4Style");this.oVariantModifiedText=new L(this.getId()+"-modified",{visible:false});this.oVariantModifiedText.setText("*");this.oVariantModifiedText.addStyleClass("sapUICompVarMngmtText");this.oVariantModifiedText.addStyleClass("sapUICompVarMngmtModified");this.oVariantModifiedText.addStyleClass("sapUICompVarMngmtEnabled");this.oVariantModifiedText.addStyleClass("sapMH4Style");this.oVariantPopoverTrigger=new B(this.getId()+"-trigger",{type:sap.m.ButtonType.Transparent,icon:"sap-icon://arrow-down",press:function(){t._openVariantSelection();}});this.oVariantText.setLabelFor(this.oVariantPopoverTrigger);this.oVariantLayout=new H({content:[this.oVariantText,this.oVariantModifiedText,this.oVariantPopoverTrigger]});this.oVariantLayout.addStyleClass("sapUICompVarMngmtLayout");this.addDependent(this.oVariantLayout);this.oVariantList=new S(this.getId()+"-list",{selectionChange:function(e){t.lastSelectedVariantKey=this.getSelectedItem().getKey();t._setSelectionByKey(this.getSelectedItem().getKey());t.oVariantPopOver.close();t.bDirty=false;t.oVariantModifiedText.setVisible(false);t.oModel.setProperty("/enabled",false);t.bFireSelect=true;}});this.oVariantList.setNoDataText(this.oResourceBundle.getText("VARIANT_MANAGEMENT_NODATA"));this.oActionSheetManage=new B({text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_MANAGE"),enabled:false,press:function(e){t._openVariantManagementDialog();}});this.oActionSheetSave=new B({text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_SAVE"),enabled:false,press:function(e){var o=t._createEvent("variantSavePressed",t._variantSavePressed);t._addEvent(o);}});this.oActionSheetSaveAs=new B({text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_SAVEAS"),press:function(e){t._openSaveAsDialog();}});this.oActionSheet=new A(this.getId()+"-actionsheet",{showCancelButton:true,buttons:[this.oActionSheetManage,this.oActionSheetSave,this.oActionSheetSaveAs],placement:sap.m.PlacementType.Top});this.oActions=new B(this.getId()+"-actions",{text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_ACTIONS"),press:function(){t.oActionSheet.openBy(this);}});this.oActions.addStyleClass("sapUiVisibleOnlyOnPhone");this.oVariantSelectionPage=new sap.m.Page(this.getId()+"selpage",{content:[this.oVariantList],footer:new sap.m.Toolbar({content:[new sap.m.ToolbarSpacer(this.getId()+"-spacer"),this.oVariantManage,this.oVariantSave,this.oVariantSaveAs,this.oActions]}),showNavButton:false,showHeader:false});this.oVariantPopOver=new R(this.getId()+"-popover",{title:this.oResourceBundle.getText("VARIANT_MANAGEMENT_VARIANTS"),contentWidth:"400px",placement:sap.m.PlacementType.Bottom,content:[this.oVariantSelectionPage],afterOpen:function(){t.bPopoverOpen=true;},afterClose:function(){t.bPopoverOpen=false;if(t.bFireSelect==true){t.bFireSelect=false;setTimeout(function(){t._fireSelectAsync();},0);}},contentHeight:"300px"});this.oVariantPopOver.addStyleClass("sapUICompVarMngmtPopover");this.oInputName=new I(this.getId()+"-name",{liveChange:function(e){var v=this.getValue();v=v.trim();if(v===""){this.setValueState(c.Error);this.setValueStateText(t.oResourceBundle.getText("VARIANT_MANAGEMENT_ERROR_EMPTY"));}else{this.setValueState(c.None);this.setValueStateText(null);}}});this.oLabelName=new L(this.getId()+"-namelabel",{text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_NAME"),required:true});this.oLabelName.setLabelFor(this.oInputName);this.oDefault=new C(this.getId()+"-default",{text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_SETASDEFAULT"),enabled:true,visible:true,width:"100%"});this.oExecuteOnSelect=new C(this.getId()+"-execute",{text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_EXECUTEONSELECT"),enabled:true,visible:false,width:"100%"});this.oCreateTile=new C(this.getId()+"-tile",{text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_CREATETILE"),enabled:true,visible:false,width:"100%"});this.oShare=new C(this.getId()+"-share",{text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_SHARE"),enabled:true,visible:false,select:function(o){var e=t._createEvent("inputfieldChange",t._handleShareSelected);e.args.push(o);t._addEvent(e);},width:"100%"});this.oInputKey=new I(this.getId()+"-key",{liveChange:function(e){var v=this.getValue();v=v.trim();if(v===""){this.setValueState(c.Error);this.setValueStateText(t.oResourceBundle.getText("VARIANT_MANAGEMENT_ERROR_EMPTY"));}else{this.setValueState(c.None);this.setValueStateText(null);}}});this.oLabelKey=new L(this.getId()+"-keylabel",{text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_KEY"),required:true});this.oLabelName.setLabelFor(this.oInputKey);this.oSaveSave=new B(this.getId()+"-variantsave",{text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_OK"),press:function(){var e=t._createEvent("variantSaveAs",t._handleVariantSaveAs);t._addEvent(e);},enabled:true});this.oSaveDialogOptionsGrid=new sap.ui.layout.Grid({defaultSpan:"L6 M6 S12"});this.oSaveDialog=new D(this.getId()+"-savedialog",{title:this.oResourceBundle.getText("VARIANT_MANAGEMENT_SAVEDIALOG"),beginButton:this.oSaveSave,endButton:new B(this.getId()+"-variantcancel",{text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_CANCEL"),press:function(){t.oSaveDialog.close();}}),content:[this.oLabelName,this.oInputName,this.oLabelKey,this.oInputKey,this.oSaveDialogOptionsGrid],stretch:sap.ui.Device.system.phone});this.oSaveDialog.setParent(this);this.oSaveDialog.addStyleClass("sapUiPopupWithPadding");this.oSaveDialog.setInitialFocus(this.oInputName.getId());this.oManagementTable=new sap.m.Table(this.getId()+"-managementTable");this.oManagementSave=new B(this.getId()+"-managementsave",{text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_OK"),enabled:true,press:function(){var e=t._createEvent("managementSave",t._handleManageSavePressed);t._addEvent(e);}});this.oManagementDialog=new D(this.getId()+"-managementdialog",{contentWidth:"600px",customHeader:new sap.m.Bar(this.getId()+"-managementHeader",{contentMiddle:[new sap.m.Text(this.getId()+"-managementHeaderText",{text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_MANAGEDIALOG")})]}),beginButton:this.oManagementSave,endButton:new B(this.getId()+"-managementcancel",{text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_CANCEL"),press:function(){t.aRemovedVariants=[];t.oManagementDialog.close();}}),content:[this.oManagementTable],stretch:sap.ui.Device.system.phone,afterClose:function(){if(t.bFireSelect==true){t.bFireSelect=false;setTimeout(function(){t._fireSelectAsync();},0);}}});this.oManagementDialog.setParent(this);this.oManagementDialog.addStyleClass("sapUiPopupWithPadding");};d.prototype.exit=function(){if(this.oVariantManage){this.oVariantManage.destroy();this.oVariantManage=undefined;}if(this.oVariantSave){this.oVariantSave.destroy();this.oVariantSave=undefined;}if(this.oVariantList){this.oVariantList.destroy();this.oVariantList=undefined;}if(this.oInputName){this.oInputName.destroy();this.oInputName=undefined;}if(this.oLabelName){this.oLabelName.destroy();this.oLabelName=undefined;}if(this.oDefault){this.oDefault.destroy();this.oDefault=undefined;}if(this.oSaveSave){this.oSaveSave.destroy();this.oSaveSave=undefined;}if(this.oSaveDialog){this.oSaveDialog.destroy();this.oSaveDialog=undefined;}if(this.oManagementTable){this.oManagementTable.destroy();this.oManagementTable=undefined;}if(this.oManagementSave){this.oManagementSave.destroy();this.oManagementSave=undefined;}if(this.oManagementDialog){this.oManagementDialog.destroy();this.oManagementDialog=undefined;}if(this.oVariantText){this.oVariantText.destroy();this.oVariantText=undefined;}if(this.oVariantPopoverTrigger){this.oVariantPopoverTrigger.destroy();this.oVariantPopoverTrigger=undefined;}if(this.oVariantLayout){this.oVariantLayout.destroy();this.oVariantLayout=undefined;}if(this.oVariantPopOver){this.oVariantPopOver.destroy();this.oVariantPopOver=undefined;}if(this.oVariantSaveAs){this.oVariantSaveAs.destroy();this.oVariantSaveAs=undefined;}if(this.oShare){this.oShare.destroy();this.oShare=undefined;}if(this.oCreateTile){this.oCreateTile.destroy();this.oCreateTile=undefined;}if(this.oSaveDialogOptionsGrid){this.oSaveDialogOptionsGrid.destroy();this.oSaveDialogOptionsGrid=undefined;}if(this.oVariantSelectionPage){this.oVariantSelectionPage.destroy();this.oVariantSelectionPage=undefined;}if(this.oActions){this.oActions.destroy();this.oActions=undefined;}if(this.oActionSheetManage){this.oActionSheetManage.destroy();this.oActionSheetManage=undefined;}if(this.oActionSheetSave){this.oActionSheetSave.destroy();this.oActionSheetSave=undefined;}if(this.oActionSheetSaveAs){this.oActionSheetSaveAs.destroy();this.oActionSheetSaveAs=undefined;}if(this.oInputKey){this.oInputKey.destroy();this.oInputKey=undefined;}if(this.oLabelKey){this.oLabelKey.destroy();this.oLabelKey=undefined;}};d.prototype.addItem=function(i){i=this.validateAggregation("items",i,true);this.bVariantItemMode=false;this.addAggregation("items",i,false);var _=this.getInitialSelectionKey();this._setSelection(i,_);this._manageButtonState();this._setStandardText();return this;};d.prototype.insertItem=function(i,e){var _=e;i=this.validateAggregation("items",i,true);this.bVariantItemMode=false;this.insertAggregation("items",i,_);var f=this.getInitialSelectionKey();this._setSelection(i,f);this._manageButtonState();this._setStandardText();return this;};d.prototype.removeItem=function(i){this.removeAggregation("items",i);this._manageButtonState();return i;};d.prototype.removeAllItems=function(){var r=this.removeAllAggregation("items");this._manageButtonState();this._setSelectedItem(null);return r;};d.prototype.destroyItems=function(){this.destroyAggregation("items");this._manageButtonState();this._setSelectedItem(null);return this;};d.prototype._getItems=function(){if(this.bVariantItemMode){return this.getVariantItems();}else{return this.getItems();}};d.prototype._removeItem=function(i){if(this.bVariantItemMode){return this.removeVariantItem(i);}else{return this.removeItem(i);}};d.prototype.getItemByKey=function(k){var i=this._getItems();for(var e=0;e<i.length;e++){if(k==i[e].getKey()){return i[e];}}return null;};d.prototype.addVariantItem=function(v){v=this.validateAggregation("variantItems",v,true);this.bVariantItemMode=true;this.addAggregation("variantItems",v,false);var _=this.getInitialSelectionKey();this._setSelection(v,_);this._manageButtonState();this._setStandardText();return this;};d.prototype.insertVariantItem=function(v,i){var _=i;v=this.validateAggregation("variantItems",v,true);this.bVariantItemMode=true;this.insertAggregation("variantItems",v,_);var e=this.getInitialSelectionKey();this._setSelection(v,e);this._manageButtonState();this._setStandardText();return this;};d.prototype._setSelectedItem=function(i){this.oSelectedItem=i;if(i!=null){this.oVariantText.setText(i.getText());}else{this._setStandardText();}};d.prototype._getSelectedItem=function(){return this.oSelectedItem;};d.prototype.setInitialSelectionKey=function(k){this.setProperty("initialSelectionKey",k,true);this._setSelectionByKey(k);};d.prototype.setEnabled=function(e){this.setProperty("enabled",e,false);if(this.oVariantPopoverTrigger){this.oVariantPopoverTrigger.setEnabled(e);}if(!e){this.oVariantText.removeStyleClass("sapUICompVarMngmtEnabled");this.oVariantModifiedText.removeStyleClass("sapUICompVarMngmtEnabled");this.oVariantText.addStyleClass("sapUICompVarMngmtDisabled");this.oVariantModifiedText.addStyleClass("sapUICompVarMngmtDisabled");}else{this.oVariantText.removeStyleClass("sapUICompVarMngmtDisabled");this.oVariantModifiedText.removeStyleClass("sapUICompVarMngmtDisabled");this.oVariantText.addStyleClass("sapUICompVarMngmtEnabled");this.oVariantModifiedText.addStyleClass("sapUICompVarMngmtEnabled");}};d.prototype._setSelection=function(i,k){if(i.getKey()===k){this._setSelectedItem(i);this.fireSelect({key:k});}};d.prototype.addStyleClass=function(s){if(a.prototype.addStyleClass){a.prototype.addStyleClass.apply(this,arguments);}if(this.oVariantPopOver){this.oVariantPopOver.addStyleClass(s);}if(this.oSaveDialog){this.oSaveDialog.addStyleClass(s);}if(this.oManagementDialog){this.oManagementDialog.addStyleClass(s);}};d.prototype.removeStyleClass=function(s){if(a.prototype.addStyleClass){a.prototype.removeStyleClass.apply(this,arguments);}if(this.oVariantPopOver){this.oVariantPopOver.removeStyleClass(s);}if(this.oSaveDialog){this.oSaveDialog.removeStyleClass(s);}if(this.oManagementDialog){this.oManagementDialog.removeStyleClass(s);}};d.prototype.clearVariantSelection=function(){this.setInitialSelectionKey(this.STANDARDVARIANTKEY);this._setSelectedItem(null);};d.prototype._setDialogCompactStyle=function(o,e){if(this._checkDialogCompactStyle(o)){e.addStyleClass("sapUiSizeCompact");}else{e.removeStyleClass("sapUiSizeCompact");}};d.prototype._checkDialogCompactStyle=function(o){if(o.$().closest(".sapUiSizeCompact").length>0){return true;}else{return false;}};d.prototype._manageButtonState=function(){if(this._getItems()&&this._getItems().length>0){this.oVariantManage.setEnabled(true);this.oActionSheetManage.setEnabled(true);}else{this.oVariantManage.setEnabled(false);this.oActionSheetManage.setEnabled(false);}};d.prototype.getSelectionKey=function(){var k=null;var i=this._getSelectedItem();if(i!==null){k=i.getKey();}else if(this.bVariantItemMode){k=this.STANDARDVARIANTKEY;}else{k=null;}return k;};d.prototype._setSelectionByKey=function(k){var i=this._getItems();var f=false;if(i.length>0){for(var e=0;e<i.length;e++){if(i[e].getKey()===k){this._setSelectedItem(i[e]);f=true;break;}}}if(!f){this._setSelectedItem(null);}};d.prototype.replaceKey=function(o,n){var i=this._getItems();if(i.length>0){for(var e=0;e<i.length;e++){if(i[e].getKey()===o){i[e].setKey(n);if(this.getDefaultVariantKey()==o){this.setDefaultVariantKey(n);}if(this._getSelectedItem()===i[e]){this._setSelectedItem(null);}break;}}}};d.prototype.currentVariantSetModified=function(f){if(f){if(!this.bDirty){this.oVariantModifiedText.setVisible(true);this.bDirty=true;this.oModel.setProperty("/enabled",true);}}else if(this.bDirty){this.oVariantModifiedText.setVisible(false);this.bDirty=false;this.oModel.setProperty("/enabled",false);}};d.prototype.currentVariantGetModified=function(){return this.bDirty;};d.prototype._openVariantSelection=function(){var i=null;var e=0;var o=null;var v;if(this.bPopoverOpen==true){return;}this.bPopoverOpen=true;this.oVariantList.destroyItems();if(this.bVariantItemMode==true||(this.bVariantItemMode==false&&(this.getSelectionKey()===this.STANDARDVARIANTKEY||this.getSelectionKey()===null))){var t;if(this.bVariantItemMode==false){t=this.oResourceBundle.getText("VARIANT_MANAGEMENT_DEFAULT");}else{t=this.oResourceBundle.getText("VARIANT_MANAGEMENT_STANDARD");}if(this.getStandardItemText()!==null&&this.getStandardItemText()!=""){t=this.getStandardItemText();}v=new V(this.oVariantPopoverTrigger.getId()+"-item-standard",{key:this.STANDARDVARIANTKEY,text:t,readOnly:true,executeOnSelection:this.bExecuteOnSelectForStandard});this.oVariantList.addItem(v);if(this.getSelectionKey()==v.getKey()||this.getSelectionKey()===null){this.oVariantList.setSelectedItem(v);}}this.oVariantSave.setEnabled(false);this.oActionSheetSave.setEnabled(false);if(this.bVariantItemMode===false&&this.getSelectionKey()!==null){this.oVariantSave.setEnabled(true);this.oActionSheetSave.setEnabled(true);}i=this._getItems();i.sort(this._compareItems);for(e=0;e<i.length;e++){o=i[e];v=new V(this.oVariantPopoverTrigger.getId()+"-item-"+e,{key:o.getKey(),text:o.getText()});if(o.getReadOnly){v.setReadOnly(o.getReadOnly());}if(o.getExecuteOnSelection){v.setExecuteOnSelection(o.getExecuteOnSelection());}if(o.getGlobal){v.setGlobal(o.getGlobal());}if(o.getLifecyclePackage){v.setLifecyclePackage(o.getLifecyclePackage());}if(o.getLifecycleTransportId){v.setLifecycleTransportId(o.getLifecycleTransportId());}if(o.getNamespace){v.setNamespace(o.getNamespace());}if(o.getAccessOptions){v.setAccessOptions(o.getAccessOptions());}if(o.getLabelReadOnly){v.setLabelReadOnly(o.getLabelReadOnly());}this.oVariantList.addItem(v);if(this.getSelectionKey()==v.getKey()){this.oVariantList.setSelectedItem(v);}}if(this.bDirty){var s=this.oVariantList.getItemByKey(this.getSelectionKey());if(s){if(!s.getReadOnly()){this.oVariantSave.setEnabled(true);this.oActionSheetSave.setEnabled(true);}}}this._setDialogCompactStyle(this,this.oVariantPopOver);this._manageButtonState();this.oVariantPopOver.setInitialFocus(this.oVariantList.getSelectedItem().getId());this.oVariantPopOver.openBy(this.oVariantPopoverTrigger.$("img")[0]);};d.prototype.onclick=function(e){if(this.getEnabled()){this._openVariantSelection();}};d.prototype.onkeydown=function(e){if(e.which===q.sap.KeyCodes.F4||e.altKey===true&&e.which===q.sap.KeyCodes.ARROW_UP||e.altKey===true&&e.which===q.sap.KeyCodes.ARROW_DOWN){if(this.getEnabled()){this._openVariantSelection();}}};d.prototype._initalizeManagementTableColumns=function(){if(this.bManagementTableInitialized){return;}this.oManagementTable.addColumn(new sap.m.Column({header:new sap.m.Text({text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_NAME")})}));this.oManagementTable.addColumn(new sap.m.Column({header:new sap.m.Text({text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_VARIANTTYPE")}),width:"4rem",demandPopin:true,popinDisplay:sap.m.PopinDisplay.Inline,minScreenWidth:sap.m.ScreenSize.Tablet}));this.oManagementTable.addColumn(new sap.m.Column({header:new sap.m.Text({text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_DEFAULT")}),width:"4rem",demandPopin:true,popinDisplay:sap.m.PopinDisplay.Inline,minScreenWidth:sap.m.ScreenSize.Tablet}));if(this.getShowExecuteOnSelection()){this.oManagementTable.addColumn(new sap.m.Column({header:new sap.m.Text({text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_EXECUTEONSELECT")}),width:"4rem",hAlign:sap.ui.core.TextAlign.Center,demandPopin:true,popinDisplay:sap.m.PopinDisplay.Inline,minScreenWidth:sap.m.ScreenSize.Tablet}));}this.oManagementTable.addColumn(new sap.m.Column({width:"2.5rem",hAlign:sap.ui.core.TextAlign.Center}));this.bManagementTableInitialized=true;};d.prototype._initalizeSaveAsDialog=function(){this.oSaveDialogOptionsGrid.removeAllContent();this.oShare.setVisible(this.getShowShare());this.oExecuteOnSelect.setVisible(this.getShowExecuteOnSelection());this.oCreateTile.setVisible(this.getShowCreateTile());this.oSaveDialogOptionsGrid.addContent(this.oDefault);if(this.getShowShare()){this.oSaveDialogOptionsGrid.addContent(this.oShare);}if(this.getShowExecuteOnSelection()){this.oSaveDialogOptionsGrid.addContent(this.oExecuteOnSelect);}if(this.getShowCreateTile()){this.oSaveDialogOptionsGrid.addContent(this.oCreateTile);}};d.prototype._variantSavePressed=function(){var i=this._getSelectedItem();var e=false;if(this.getDefaultVariantKey()==i.getKey()){e=true;}if(i.getLifecyclePackage&&i.getGlobal()==true){var t=this;var o=function(p,s){t.oVariantPopOver.close();t.sPackage=p;t.sTransport=s;t.fireSave({name:i.getText(),overwrite:true,key:i.getKey(),def:e,lifecyclePackage:t.sPackage,lifecycleTransportId:t.sTransport});i.setLifecycleTransportId(t.sTransport);t.bDirty=false;t.oVariantModifiedText.setVisible(false);t.oModel.setProperty("/enabled",false);t._eventDone();};var f=function(r){t.sTransport=null;t.sPackage=null;t._cancelAllEvents();};this._assignTransport(i,o,f,this.oVariantText);}else{this.oVariantPopOver.close();this.fireSave({name:i.getText(),overwrite:true,key:i.getKey(),def:e});this.bDirty=false;this.oVariantModifiedText.setVisible(false);this.oModel.setProperty("/enabled",false);this._eventDone();}};d.prototype._assignTransport=function(v,o,e,f){var O={type:"variant",name:"",namespace:""};O["package"]="";if(v!==null){O["package"]=v.getLifecyclePackage();O["name"]=v.getKey();O["namespace"]=v.getNamespace();}var _=function(r){var p;var t;t=r.getParameters().selectedTransport;p=r.getParameters().selectedPackage;o(p,t);};var g=function(r){e(r);};if(this.getLifecycleSupport()){var t=null;if(v){t=v.getLifecycleTransportId();}if(t!=null&&t.trim().length>0){o(O["package"],t);}else{var h=new T();h.selectTransport(O,_,g,this._checkDialogCompactStyle(f),f);}}else{o(O["package"],"");}};d.prototype.getDefaultVariantKey=function(){var v=this.getProperty("defaultVariantKey");if(v===""){if(this.bVariantItemMode){v=this.STANDARDVARIANTKEY;}}return v;};d.prototype._compareItems=function(f,s){var F=f.getText();var e=s.getText();var g=F.toUpperCase();var h=e.toUpperCase();if(g==h){if(F==e){return 0;}if(F<e){return-1;}if(F>e){return 1;}}if(g<h){return-1;}if(g>h){return 1;}};d.prototype._accessOptionsText=function(o){var m=null;switch(o){case"R":m=this.oResourceBundle.getText("VARIANT_MANAGEMENT_WRONG_LAYER");break;case"RD":m=this.oResourceBundle.getText("VARIANT_MANAGEMENT_WRONG_LANGUAGE");break;default:m=null;}return m;};d.prototype._openSaveAsDialog=function(){this._initalizeSaveAsDialog();if(this._getSelectedItem()){this.oInputName.setValue(this._getSelectedItem().getText());}else{this.oInputName.setValue("");}this.oInputName.setEnabled(true);this.oInputName.setValueState(c.None);this.oInputName.setValueStateText(null);this.oDefault.setSelected(false);this.oShare.setSelected(false);this.oCreateTile.setSelected(false);this.oExecuteOnSelect.setSelected(false);this._setDialogCompactStyle(this,this.oSaveDialog);this.oVariantPopOver.close();this.sTransport=null;this.sPackage=null;if(this.bManualVariantKey){this.oInputKey.setVisible(true);this.oInputKey.setEnabled(true);this.oInputKey.setValueState(c.None);this.oInputKey.setValueStateText(null);this.oLabelKey.setVisible(true);}else{this.oInputKey.setVisible(false);this.oLabelKey.setVisible(false);}this.oSaveDialog.open();};d.prototype._checkManageItemNameChange=function(m){var t="";var e=true;var i=null;var f=this;i=m.getCells()[0];t=i.getValue();t=t.trim();var o=m;var k=o.getKey();if(t.length===0){var g=this.oVariantList.getItemByKey(k);i.setValue(g.getText());i.setValueState(c.None);i.setValueStateText(null);}if(this.oVariantList.getItemByKey(k).getText().trim()!=t){e=true;}if(e){if(o.getGlobal()){var O=function(p,s){o.setLifecyclePackage(p);o.setLifecycleTransportId(s);f._eventDone();};var h=function(r){var g=f.oVariantList.getItemByKey(k);i.setValue(g.getText());f._cancelAllEvents();};this._assignTransport(o,O,h,this.oManagementDialog);}else{this._eventDone();}}};d.prototype._handleManageSavePressed=function(){var n=this.oManagementTable.getItems();var i;var f=false;var N="";var o=null;var e=0;for(var g=0;g<n.length;g++){i=this.oVariantList.getItemByKey(n[g].getKey());if(n[g].getCells()[0].getValue){N=n[g].getCells()[0].getValue();}if(n[g].getCells()[0].getText){N=n[g].getCells()[0].getText();}N=N.trim();if(i.getText()!==N){this.aRenamedVariants.push({key:i.getKey(),name:N});o=this.getItemByKey(n[g].getKey());o.setText(N);if(o.setLifecyclePackage){o.setLifecyclePackage(n[g].getLifecyclePackage());o.setLifecycleTransportId(n[g].getLifecycleTransportId());}if(this.lastSelectedVariantKey===i.getKey()){this.oVariantText.setText(N);this.bDirty=false;this.oVariantModifiedText.setVisible(false);this.oModel.setProperty("/enabled",false);}}if(this.getShowExecuteOnSelection()&&i.getExecuteOnSelection&&i.getExecuteOnSelection()!=n[g].getCells()[3].getSelected()){var F=n[g].getCells()[3].getSelected();var h=this.getItemByKey(n[g].getKey());if(h&&h.setExecuteOnSelection){h.setExecuteOnSelection(F);this.aExeVariants.push({key:i.getKey(),exe:F});if(h.setLifecyclePackage){h.setLifecyclePackage(n[g].getLifecyclePackage());h.setLifecycleTransportId(n[g].getLifecycleTransportId());}}}}this.oManagementDialog.close();this._manageButtonState();if(this.bVariantItemMode===false){if(this.getDefaultVariantKey()!=this.sNewDefaultKey){var j=null;if(this.sNewDefaultKey==this.STANDARDVARIANTKEY){j=this.getItemByKey(this.getDefaultVariantKey());this.fireSave({name:j.getText(),overwrite:true,key:j.getKey(),def:false});}else{j=this.getItemByKey(this.sNewDefaultKey);this.fireSave({name:j.getText(),overwrite:true,key:j.getKey(),def:true});}}}this.setDefaultVariantKey(this.sNewDefaultKey);for(e=0;e<this.aRemovedVariants.length;e++){i=this.getItemByKey(this.aRemovedVariants[e]);for(var k=0;k<this.aRemovedVariantTransports.length;k++){if(this.aRemovedVariants[e]===this.aRemovedVariantTransports[k].key){var m=this.aRemovedVariantTransports[k];if(i.setLifecyclePackage){i.setLifecycleTransportId(m.transport);}break;}}}this.fireManage({renamed:this.aRenamedVariants,deleted:this.aRemovedVariants,exe:this.aExeVariants,def:this.getDefaultVariantKey()});for(e=0;e<this.aRemovedVariants.length;e++){i=this.getItemByKey(this.aRemovedVariants[e]);if(i){this._removeItem(i);i.destroy();}if(this.lastSelectedVariantKey===this.aRemovedVariants[e]){f=true;this._setSelectedItem(null);this.bDirty=false;this.oVariantModifiedText.setVisible(false);this.oModel.setProperty("/enabled",false);}}if(f){this.bFireSelect=true;}this._eventDone();};d.prototype._createEvent=function(n,f){var e={name:n,fFunc:f,args:[]};return e;};d.prototype._handleNextEvent=function(){if(this.aEvents.length>0){if(!this.bEventRunning){this.bEventRunning=true;var n=this.aEvents.pop();n.fFunc.apply(this,n.args);}}};d.prototype._addEvent=function(e){this.aEvents.push(e);this._handleNextEvent();};d.prototype._cancelAllEvents=function(){this.aEvents=[];this.bEventRunning=false;};d.prototype._eventDone=function(){this.bEventRunning=false;this._handleNextEvent();};d.prototype._handleManageExecuteOnSelectionChanged=function(o){var t=this;var m=o.getParent();if(m.getGlobal()){var O=function(p,s){m.setLifecyclePackage(p);m.setLifecycleTransportId(s);t._eventDone();};var e=function(r){o.setSelected(!o.getSelected());t._cancelAllEvents();};this._assignTransport(m,O,e,this.oManagementDialog);}else{this._eventDone();}};d.prototype._handleManageDeletePressed=function(o){var i=o.getParent();if(i.getGlobal()){var t=this;var O=function(p,s){var k=i.getKey();t.aRemovedVariants.push(k);t.oManagementTable.removeItem(i);if(i.getKey()===t.sNewDefaultKey){t.oManagementTable.getItems()[0].getCells()[2].setSelected(true);t.sNewDefaultKey=t.STANDARDVARIANTKEY;}i.destroy();var f={key:k,transport:s};t.aRemovedVariantTransports.push(f);t._eventDone();};var e=function(r){t._cancelAllEvents();};this._assignTransport(i,O,e,this.oManagementDialog);}else{this.aRemovedVariants.push(i.getKey());this.oManagementTable.removeItem(i);if(i.getKey()===this.sNewDefaultKey){this.oManagementTable.getItems()[0].getCells()[2].setSelected(true);this.sNewDefaultKey=this.STANDARDVARIANTKEY;}i.destroy();this._eventDone();}};d.prototype._handleShareSelected=function(o){var t=this;if(o.getParameters().selected){var O=function(p,s){t.sTransport=s;t.sPackage=p;t._eventDone();};var e=function(r){t.oShare.setSelected(false);t.sTransport=null;t.sPackage=null;t._cancelAllEvents();};this._assignTransport(null,O,e,this.oSaveDialog);}else{this.sTransport=null;this.sPackage=null;this._eventDone();}};d.prototype._handleVariantSaveAs=function(){var k="SV"+new Date().getTime();var n=this.oInputName.getValue();var m=this.oInputKey.getValue();var t="";var p="";var e=false;var f=false;var i=null;n=n.trim();if(n==""){this.oInputName.setValueState(c.Error);this.oInputName.setValueStateText(this.oResourceBundle.getText("VARIANT_MANAGEMENT_ERROR_EMPTY"));this._cancelAllEvents();return;}m=m.trim();if(this.bManualVariantKey&&m==""){this.oInputKey.setValueState(c.Error);this.oInputKey.setValueStateText(this.oResourceBundle.getText("VARIANT_MANAGEMENT_ERROR_EMPTY"));this._cancelAllEvents();return;}if(this.bManualVariantKey){k=m;}this.oSaveDialog.close();if(this.oExecuteOnSelect!==null){e=this.oExecuteOnSelect.getSelected();}if(this.oCreateTile!==null){f=this.oCreateTile.getSelected();}if(this.bVariantItemMode){i=new V({key:k,text:n,readOnly:false,executeOnSelection:e,global:this.oShare.getSelected(),lifecycleTransportId:this.sTransport,lifecyclePackage:this.sPackage});this.addVariantItem(i);this._setSelectedItem(i);}else{i=new b({key:k,text:n});this.addItem(i);this._setSelectedItem(i);}if(this.oDefault.getSelected()){this.setDefaultVariantKey(k);}if(this.oShare.getSelected()){p=this.sPackage;t=this.sTransport;}this._manageButtonState();this.fireSave({name:n,overwrite:false,def:this.oDefault.getSelected(),key:k,exe:this.oExecuteOnSelect.getSelected(),tile:f,global:this.oShare.getSelected(),lifecyclePackage:p,lifecycleTransportId:t});this.bDirty=false;this.oVariantModifiedText.setVisible(false);this.oModel.setProperty("/enabled",false);this._eventDone();};d.prototype._setBackwardCompatibility=function(f){if(this.getItems().length===0&&this.getVariantItems().length===0){this.bVariantItemMode=!f;}this._setStandardText();};d.prototype._setStandardText=function(){var k=this.getSelectionKey();if(k===null||k===this.STANDARDVARIANTKEY){if(this.bVariantItemMode==false){this.oVariantText.setText(this.oResourceBundle.getText("VARIANT_MANAGEMENT_DEFAULT"));}else{this.oVariantText.setText(this.oResourceBundle.getText("VARIANT_MANAGEMENT_STANDARD"));}if(this.getStandardItemText()!==null&&this.getStandardItemText()!=""){this.oVariantText.setText(this.getStandardItemText());}}};d.prototype._openVariantManagementDialog=function(){var i;var o=null;var e=0;var m;var n;var t;var f;var g;var h;var s;var j;var k;var p;var r;var u;var P;var v=this;this.oManagementTable.destroyItems();k=function(x){var y=this.getValue();y=y.trim();if(y.length===0){this.setValueState(c.Error);this.setValueStateText(v.oResourceBundle.getText("VARIANT_MANAGEMENT_ERROR_EMPTY"));}};p=function(x){var y=v._createEvent("inputfieldChange",v._checkManageItemNameChange);y.args.push(this.getParent());v._addEvent(y);};r=function(x){if(x.getParameters().selected===true){var i=this.getParent();v.sNewDefaultKey=i.getKey();}};u=function(x){var y=v._createEvent("executeOnSelectionChange",v._handleManageExecuteOnSelectionChanged);y.args.push(this);v._addEvent(y);};P=function(x){var y=v._createEvent("manageDeletePressed",v._handleManageDeletePressed);y.args.push(this);v._addEvent(y);};this._initalizeManagementTableColumns();this.sNewDefaultKey=this.getDefaultVariantKey();if(this.oVariantList.getItems()[0].getKey()!==this.STANDARDVARIANTKEY&&this.bVariantItemMode==false){i=new V(this.oVariantManage.getId()+"-item-standard",{key:this.STANDARDVARIANTKEY,text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_DEFAULT"),readOnly:true,executeOnSelection:false});this.oVariantList.insertItem(i,0);}o=this.oVariantList.getItems();for(var w=0;w<o.length;w++){if(o[w].getReadOnly()||o[w].getLabelReadOnly()){var O=o[w].getAccessOptions();j=this._accessOptionsText(O);}else{j=null;}if(o[w].getReadOnly()){j=this.oResourceBundle.getText("VARIANT_MANAGEMENT_WRONG_LAYER");}else if(o[w].getLabelReadOnly()===true){j=this.oResourceBundle.getText("VARIANT_MANAGEMENT_WRONG_LANGUAGE");}if(o[w].getKey()===this.STANDARDVARIANTKEY){j=null;}m=new E(this.oVariantManage.getId()+"-edit-"+e,{key:o[w].getKey(),global:o[w].getGlobal(),lifecyclePackage:o[w].getLifecyclePackage(),lifecycleTransportId:o[w].getLifecycleTransportId(),namespace:o[w].getNamespace(),labelReadOnly:o[w].getLabelReadOnly(),vAlign:sap.ui.core.VerticalAlign.Middle});if(o[w].getKey()===this.STANDARDVARIANTKEY||o[w].getReadOnly()===true||o[w].getLabelReadOnly()===true){n=new sap.m.Text(this.oVariantManage.getId()+"-text-"+e,{text:o[w].getText()});n.addStyleClass("sapUICompVarMngmtLbl");if(j){n.setTooltip(j);}}else{n=new I(this.oVariantManage.getId()+"-input-"+e,{value:o[w].getText(),liveChange:k,change:p});}m.addCell(n);if(o[w].getGlobal()){s=this.oResourceBundle.getText("VARIANT_MANAGEMENT_SHARED");}else{s=this.oResourceBundle.getText("VARIANT_MANAGEMENT_PRIVATE");}t=new sap.m.Text(this.oVariantManage.getId()+"-type-"+e,{text:s});t.addStyleClass("sapUICompVarMngmtType");m.addCell(t);f=new sap.m.RadioButton(this.oVariantManage.getId()+"-def-"+e,{groupName:this.oVariantManage.getId(),select:r});if(this.sNewDefaultKey===o[w].getKey()||o[w].getKey()===this.STANDARDVARIANTKEY&&this.sNewDefaultKey===""){f.setSelected(true);}m.addCell(f);if(this.getShowExecuteOnSelection()){g=new C(this.oVariantManage.getId()+"-exe-"+e,{selected:false,enabled:false,select:u});if(o[w].getExecuteOnSelection){g.setEnabled(!o[w].getReadOnly());g.setSelected(o[w].getExecuteOnSelection());if(j){g.setTooltip(j);}}m.addCell(g);}h=new B(this.oVariantManage.getId()+"-del-"+e,{icon:"sap-icon://sys-cancel",enabled:true,type:sap.m.ButtonType.Transparent,press:P,tooltip:this.oResourceBundle.getText("VARIANT_MANAGEMENT_DELETE")});if(m.getKey()===this.STANDARDVARIANTKEY||(o[w].getReadOnly&&o[w].getReadOnly())){h.setEnabled(false);}h.addStyleClass("sapUiCompVarMngmtDel");m.addCell(h);this.oManagementTable.addItem(m);e++;}this.aRemovedVariants=[];this.aRemovedVariantTransports=[];this.aRenamedVariants=[];this.aExeVariants=[];this._setDialogCompactStyle(this,this.oManagementDialog);i=this.oVariantList.getSelectedItem();if(i){this.lastSelectedVariantKey=i.getKey();}this.oVariantPopOver.close();this.oManagementDialog.open();};d.prototype._enableManualVariantKey=function(e){this.bManualVariantKey=e;};d.prototype._fireSelectAsync=function(k){var s;if(k===undefined||k===null){var i=this._getSelectedItem();if(i===null){s=this.STANDARDVARIANTKEY;}else{s=i.getKey();}}this.fireSelect({key:s});};d.prototype._executeOnSelectForStandardVariant=function(s){this.bExecuteOnSelectForStandard=s;};return d;},true);
