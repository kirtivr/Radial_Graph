/**
 * editor_plugin_src.js
 *
 * Copyright 2009, Moxiecode Systems AB
 * Released under LGPL License.
 *
 * License: http://tinymce.moxiecode.com/license
 * Contributing: http://tinymce.moxiecode.com/contributing
 */
(function(){var T=tinymce.dom.TreeWalker;var a='contenteditable',b='data-mce-'+a;var V=tinymce.VK;function h(c){var d=c.dom,s=c.selection,i,f='mce_noneditablecaret',i='\uFEFF';function g(e){var p;if(e.nodeType===1){p=e.getAttribute(b);if(p&&p!=="inherit"){return p;}p=e.contentEditable;if(p!=="inherit"){return p;}}return null;};function j(e){var p;while(e){p=g(e);if(p){return p==="false"?e:null;}e=e.parentNode;}};function k(e){while(e){if(e.id===f){return e;}e=e.parentNode;}};function l(e){var w;if(e){w=new T(e,e);for(e=w.current();e;e=w.next()){if(e.nodeType===3){return e;}}}};function m(t,e){var p,q;if(g(t)==="false"){if(d.isBlock(t)){s.select(t);return;}}q=d.createRng();if(g(t)==="true"){if(!t.firstChild){t.appendChild(c.getDoc().createTextNode('\u00a0'));}t=t.firstChild;e=true;}p=d.create('span',{id:f,'data-mce-bogus':true},i);if(e){t.parentNode.insertBefore(p,t);}else{d.insertAfter(p,t);}q.setStart(p.firstChild,1);q.collapse(true);s.setRng(q);return p;};function r(e){var p,q,t;if(e){rng=s.getRng(true);rng.setStartBefore(e);rng.setEndBefore(e);p=l(e);if(p&&p.nodeValue.charAt(0)==i){p=p.deleteData(0,1);}d.remove(e,true);s.setRng(rng);}else{q=k(s.getStart());while((e=d.get(f))&&e!==t){if(q!==e){p=l(e);if(p&&p.nodeValue.charAt(0)==i){p=p.deleteData(0,1);}d.remove(e,true);}t=e;}}};function n(){var e,p,q,t,u;function v(u,x){var y,z,A,B,C;y=t.startContainer;z=t.startOffset;if(y.nodeType==3){C=y.nodeValue.length;if((z>0&&z<C)||(x?z==C:z==0)){return;}}else{if(z<y.childNodes.length){var D=!x&&z>0?z-1:z;y=y.childNodes[D];if(y.hasChildNodes()){y=y.firstChild;}}else{return!x?u:null;}}A=new T(y,u);while(B=A[x?'prev':'next']()){if(B.nodeType===3&&B.nodeValue.length>0){return;}else if(g(B)==="true"){return B;}}return u;};r();q=s.isCollapsed();e=j(s.getStart());p=j(s.getEnd());if(e||p){t=s.getRng(true);if(q){e=e||p;var w=s.getStart();if(u=v(e,true)){m(u,true);}else if(u=v(e,false)){m(u,false);}else{s.select(e);}}else{t=s.getRng(true);if(e){t.setStartBefore(e);}if(p){t.setEndAfter(p);}s.setRng(t);}}};function o(c,e){var p=e.keyCode,q,t,u,v;function w(D,E){while(D=D[E?'previousSibling':'nextSibling']){if(D.nodeType!==3||D.nodeValue.length>0){return D;}}};function x(D,E){s.select(D);s.collapse(E);}function y(D){var E,F,G,q;function H(J){var K=F;while(K){if(K===J){return;}K=K.parentNode;}d.remove(J);n();}function I(){var J,B,K=c.schema.getNonEmptyElements();B=new tinymce.dom.TreeWalker(F,c.getBody());while(J=(D?B.prev():B.next())){if(K[J.nodeName.toLowerCase()]){break;}if(J.nodeType===3&&tinymce.trim(J.nodeValue).length>0){break;}if(g(J)==="false"){H(J);return true;}}if(j(J)){return true;}return false;}if(s.isCollapsed()){E=s.getRng(true);F=E.startContainer;G=E.startOffset;F=k(F)||F;if(q=j(F)){H(q);return false;}if(F.nodeType==3&&(D?G>0:G<F.nodeValue.length)){return true;}if(F.nodeType==1){F=F.childNodes[G]||F;}if(I()){return false;}}return true;}u=s.getStart();v=s.getEnd();q=j(u)||j(v);if(q&&(p<112||p>124)&&p!=V.DELETE&&p!=V.BACKSPACE){if((tinymce.isMac?e.metaKey:e.ctrlKey)&&(p==67||p==88||p==86)){return;}e.preventDefault();if(p==V.LEFT||p==V.RIGHT){var z=p==V.LEFT;if(c.dom.isBlock(q)){var A=z?q.previousSibling:q.nextSibling;var B=new T(A,A);var C=z?B.prev():B.next();x(C,!z);}else{x(q,z);}}}else{if(p==V.LEFT||p==V.RIGHT||p==V.BACKSPACE||p==V.DELETE){t=k(u);if(t){if(p==V.LEFT||p==V.BACKSPACE){q=w(t,true);if(q&&g(q)==="false"){e.preventDefault();if(p==V.LEFT){x(q,true);}else{d.remove(q);return;}}else{r(t);}}if(p==V.RIGHT||p==V.DELETE){q=w(t);if(q&&g(q)==="false"){e.preventDefault();if(p==V.RIGHT){x(q,false);}else{d.remove(q);return;}}else{r(t);}}}if((p==V.BACKSPACE||p==V.DELETE)&&!y(p==V.BACKSPACE)){e.preventDefault();return false;}}}};c.onMouseDown.addToTop(function(c,e){var p=c.selection.getNode();if(g(p)==="false"&&p==e.target){n();}});c.onMouseUp.addToTop(n);c.onKeyDown.addToTop(o);c.onKeyUp.addToTop(n);};tinymce.create('tinymce.plugins.NonEditablePlugin',{init:function(e,u){var c,n,d;function f(e,g){var i=d.length,j=g.content,k=tinymce.trim(n);if(g.format=="raw"){return;}while(i--){j=j.replace(d[i],function(m){var g=arguments,l=g[g.length-2];if(l>0&&j.charAt(l-1)=='"'){return m;}return'<span class="'+k+'" data-mce-content="'+e.dom.encode(g[0])+'">'+e.dom.encode(typeof(g[1])==="string"?g[1]:g[0])+'</span>';});}g.content=j;};c=" "+tinymce.trim(e.getParam("noneditable_editable_class","mceEditable"))+" ";n=" "+tinymce.trim(e.getParam("noneditable_noneditable_class","mceNonEditable"))+" ";d=e.getParam("noneditable_regexp");if(d&&!d.length){d=[d];}e.onPreInit.add(function(){h(e);if(d){e.selection.onBeforeSetContent.add(f);e.onBeforeSetContent.add(f);}e.parser.addAttributeFilter('class',function(g){var i=g.length,j,k;while(i--){k=g[i];j=" "+k.attr("class")+" ";if(j.indexOf(c)!==-1){k.attr(b,"true");}else if(j.indexOf(n)!==-1){k.attr(b,"false");}}});e.serializer.addAttributeFilter(b,function(g,j){var i=g.length,k;while(i--){k=g[i];if(d&&k.attr('data-mce-content')){k.name="#text";k.type=3;k.raw=true;k.value=k.attr('data-mce-content');}else{k.attr(a,null);k.attr(b,null);}}});e.parser.addAttributeFilter(a,function(g,j){var i=g.length,k;while(i--){k=g[i];k.attr(b,k.attr(a));k.attr(a,null);}});});},getInfo:function(){return{longname:'Non editable elements',author:'Moxiecode Systems AB',authorurl:'http://tinymce.moxiecode.com',infourl:'http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/noneditable',version:tinymce.majorVersion+"."+tinymce.minorVersion};}});tinymce.PluginManager.add('noneditable',tinymce.plugins.NonEditablePlugin);})();
