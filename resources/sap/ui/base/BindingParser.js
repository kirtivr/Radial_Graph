/*!
 * SAP UI development toolkit for HTML5 (SAPUI5/OpenUI5)
 * (c) Copyright 2009-2015 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['jquery.sap.global','./ExpressionParser','jquery.sap.script'],function(q,E){"use strict";var r=/^\{\s*[a-zA-Z_][a-zA-Z0-9_]*\s*:/;var a=/(\\[\\\{\}])|(\{)/g;var b=/([\\\{\}])/g;function c(f){var F=function(v){var R=[],l=f.length,i;for(i=0;i<l;i++){if(typeof f[i]==="number"){R.push(arguments[f[i]]);}else{R.push(f[i]);}}return R.join('');};F.textFragments=f;return F;}function d(p){var P=p.indexOf(">"),o={path:p};if(P>0){o.model=p.slice(0,P);o.path=p.slice(P+1);}return o;}var B={};B._keepBindingStrings=false;B.simpleParser=function(s,C){if(q.sap.startsWith(s,"{")&&q.sap.endsWith(s,"}")){return d(s.slice(1,-1));}};B.simpleParser.escape=function(v){return v;};B.complexParser=function(s,C,u){var e=q.sap.parseJS,f={parts:[]},F=[],U,p=0,m,g,h;function i(o,P){if(typeof o[P]==="string"){var n=o[P];if(q.sap.startsWith(o[P],".")){o[P]=q.proxy(q.sap.getObject(o[P].slice(1),undefined,C),C);}else{o[P]=q.sap.getObject(o[P]);}if(typeof(o[P])!=="function"){q.sap.log.error(P+" function "+n+" not found!");}}}function j(o,P){var n;if(typeof o[P]==="string"){if(q.sap.startsWith(o[P],".")){n=q.sap.getObject(o[P].slice(1),undefined,C);}else{n=q.sap.getObject(o[P]);}if(typeof n==="function"){o[P]=new n(o.formatOptions,o.constraints);}else{o[P]=n;}delete o.formatOptions;delete o.constraints;}}function k(o,P,n){var t;if(!(typeof o[P]==="object"||q.isArray(o[P]))){return;}if(q.isArray(o[P])){q.each(o[P],function(I,O){k(o[P],I,P);});}else{if(P==="filters"||n==="filters"){t=q.sap.getObject("sap.ui.model.Filter");}else if(P==="sorter"||n==="sorter"){t=q.sap.getObject("sap.ui.model.Sorter");i(o[P],"group");}if(t){o[P]=new t(o[P]);}}}function l(I,S){var P,n;if(r.test(I.slice(S))){P=e(I,S);j(P.result,'type');k(P.result,'filters');k(P.result,'sorter');i(P.result,'formatter');i(P.result,'factory');i(P.result,'groupHeaderFactory');return P;}n=I.indexOf('}',S);if(n<S){throw new SyntaxError("no closing braces found in '"+I+"' after pos:"+S);}return{result:d(I.slice(S+1,n)),at:n+1};}a.lastIndex=0;while((m=a.exec(s))!==null){if(p<m.index){F.push(s.slice(p,m.index));}if(m[1]){F.push(m[1].slice(1));U=true;}else{F.push(f.parts.length);if(s.charAt(m.index+1)==="="){g=E.parse(l,s,m.index+2);if(s.charAt(g.at)!=="}"){throw new SyntaxError("Expected '}' and instead saw '"+s.charAt(g.at)+"' in expression binding "+s+" at position "+g.at);}g.at+=1;if(g.result){h=true;}else{F[F.length-1]=String(g.constant);U=true;}}else{g=l(s,m.index);}if(g.result){f.parts.push(g.result);}a.lastIndex=g.at;}p=a.lastIndex;}if(p<s.length){F.push(s.slice(p));}if(f.parts.length>0){if(F.length===1){f=f.parts[0];}else{if(h){throw new SyntaxError("Expression not allowed in composite binding: "+s);}f.formatter=c(F);}if(B._keepBindingStrings){f.bindingString=s;}return f;}else if(u&&U){return F.join('');}};B.complexParser.escape=function(v){return v.replace(b,"\\$1");};return B;},true);
