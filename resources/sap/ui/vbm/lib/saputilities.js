VBI.Utilities=VBI.Utilities||{};
HTMLCanvasElement.prototype.getPixelWidth=function(){if(this.m_pixelWidth)return this.m_pixelWidth;if(this.style.pixelWidth!==undefined)return this.style.pixelWidth;return parseInt(this.style.width);};
HTMLCanvasElement.prototype.getPixelHeight=function(){if(this.m_pixelHeight)return this.m_pixelHeight;if(this.style.pixelHeight!==undefined)return this.style.pixelHeight;return parseInt(this.style.height);};
HTMLCanvasElement.prototype.getPixelLeft=function(){if(this.m_pixelLeft)return this.m_pixelLeft;if(this.style.pixelLeft!==undefined)return this.style.pixelLeft;return parseInt(this.style.left);};
HTMLCanvasElement.prototype.getPixelTop=function(){if(this.m_pixelTop)return this.m_pixelTop;if(this.style.pixelTop!==undefined)return this.style.pixelTop;return parseInt(this.style.top);};
HTMLCanvasElement.prototype.setPixelWidth=function(v){this.m_pixelWidth=v;(this.style.pixelWidth!==undefined)?(this.style.pixelWidth=v):(this.style.width=v+'px');};
HTMLCanvasElement.prototype.setPixelHeight=function(v){this.m_pixelHeight=v;(this.style.pixelHeight!==undefined)?(this.style.pixelHeight=v):(this.style.height=v+'px');};
HTMLCanvasElement.prototype.setPixelLeft=function(v){this.m_pixelLeft=v;(this.style.pixelLeft!==undefined)?(this.style.pixelLeft=v):(this.style.left=v+'px');};
HTMLCanvasElement.prototype.setPixelTop=function(v){this.m_pixelTop=v;(this.style.pixelTop!==undefined)?(this.style.pixelTop=v):(this.style.top=v+'px');};
VBI.Utilities.CreateWifiObject=function(){var n=document.createElement('object');if(!n)return null;n.classid="CLSID:00100000-2013-0070-2000-651572487E69";return n;};
VBI.Utilities.CreateDOMElement=function(t,i,w,h){var n=document.createElement(t);n.style.height=w?w:"1px";n.style.width=h?h:"1px";n.id=i;return n;};
VBI.Utilities.GetDOMElement=function(e){var a=[];for(var i=0,l=arguments.length;i<l;i++){var e=arguments[i];if(typeof e=='string'){e=document.getElementById(e);}if(arguments.length==1){return e;}a.push(e);}return a;};
VBI.Utilities.CreateDOMVBIDivElement=function(i,w,h){var n=document.createElement('div');n.id=i;n.style.height="300x";n.style.width="300px";n.style.overflow="hidden";n.style.position="absolute";n.style.left="0px";n.style.top="0px";return n;};
VBI.Utilities.CreateGeoSceneDiv=function(i){var n=document.createElement('div');n.id=i;n.style.left="0px";n.style.top="0px";n.style.width="100%";n.style.height="100%";n.style.position="relative";n.style.overflow="hidden";return n;};
VBI.Utilities.CreateGeoSceneCanvas=function(i,w,h,z,t,a){var n=document.createElement('canvas');n.id=i;n.m_pixelLeft=n.m_pixelTop=0;n.width=n.m_pixelWidth=w?w:512;n.height=n.m_pixelHeight=h?h:512;n.style.left=n.style.top="0px";n.style.width=n.m_pixelWidth+"px";n.style.height=n.m_pixelHeight+"px";n.style.position="absolute";n.style.zIndex=z;n.style.touchaction="none";n.className="vbi-geoscenecanvas";n.m_bNotInDOM=(a!=undefined?a:false);n.m_CanvasValid=!n.m_bNotInDOM;if(n.m_bNotInDOM)n.m_nMoveCount=0;if(t!=undefined)n.tabIndex=t;return n;};
VBI.Utilities.Align=['','left','center','','right'];
VBI.Utilities.CreateCaption=function(i,t,l,a,r,b,c,d,e,f){var n=document.createElement('div');n.id=i;n.style.left=l+"px";n.style.top=a+"px";n.style.width=(r-l).toString()+"px";n.style.height=(b-a).toString()+"px";n.style.textAlign=VBI.Utilities.Align[f];n.style.title=c;switch(e){case 3:n.style.fontSize="14px";n.style.fontWeight="bold";break;}n.className="vbi-2d-caption vbi-2d-common";n.innerHTML=t;return n;};
VBI.Utilities.CreateLabel=function(i,t,l,a,r,b,c,d){var n=document.createElement('div');n.id=i;n.style.left=l+"px";n.style.top=a+"px";n.style.width=(r-l).toString()+"px";n.style.height=(b-a).toString()+"px";n.style.textAlign=VBI.Utilities.Align[d];n.style.title=c;n.className="vbi-2d-label vbi-2d-common";n.innerHTML=t;return n;};
VBI.Utilities.CreateLink=function(i,t,l,a,r,b,h,c,d){var n=document.createElement('a');n.id=i;n.style.left=l+"px";n.style.top=a+"px";n.style.width=(r-l).toString()+"px";n.style.height=(b-a).toString()+"px";n.style.textAlign=VBI.Utilities.Align[d];n.className="vbi-2d-link vbi-2d-common";n.href=h?h:"javascript:void(0)";n.title=c;n.innerHTML=t;return n;};
VBI.Utilities.CreateImage=function(i,a,l,t,r,b,c,d){var n=a.cloneNode(true);n.id=i;n.style.left=l+"px";n.style.top=t+"px";n.style.width=(r-l).toString()+"px";n.style.height=(b-t).toString()+"px";n.style.textAlign=VBI.Utilities.Align[d];n.className="vbi-2d-image vbi-2d-common";n.title=c;return n;};
VBI.Utilities.CreateButton=function(i,t,l,a,r,b,c,d){var n=document.createElement('button');n.id=i;n.style.left=l+"px";n.style.top=a+"px";n.style.width=(r-l).toString()+"px";n.style.height=(b-a).toString()+"px";n.style.textAlign=VBI.Utilities.Align[d];n.className="vbi-2d-button vbi-2d-common";n.innerHTML=t;n.title=c;return n;};
VBI.Utilities.CreateContainer=function(i,k,l,t,w,h,a,z){var n=document.createElement('div');n.id=i;n.style.left=l+"px";n.style.top=t+"px";n.style.zIndex=z;n.title=a;n.style.position="absolute";n.className="vbi-container-vo";n.m_Key=k;return n;};
VBI.Utilities.CreateCallout=function(i,l,t,w,h,z){var n=document.createElement('div');n.id=i;n.style.left=l+"px";n.style.top=t+"px";if(w)n.style.width=w?(w+"px"):"512px";if(h)n.style.height=h?(h+"px"):"300px";n.style.position="absolute";n.style.zIndex=z;n.className="vbi-callout";var a=document.createElement('div');a.id=i+"-window-content";a.style.position="relative";a.style.left="0px";a.style.top="0px";a.style.width="100%";a.style.height="100%";a.className="vbi-callout-content";var b=document.createElement('div');b.id=i+"-window-closebutton";b.className="vbi-callout-closebutton";n.appendChild(a);n.appendChild(b);var c;c=document.createElement('b');c.className="vbi-notch vbi-down";n.appendChild(c);c=document.createElement('b');c.className="vbi-border-notch vbi-notch";n.appendChild(c);return{m_Div:n,m_Content:a,m_CloseButton:b,GetAnchorPoint:function(){return[50,(style.paddingTop?parseInt(style.paddingTop):0)+(style.paddingBottom?parseInt(style.paddingBottom):0)+(style.height?parseInt(style.height):0)+(style.borderTop?parseInt(style.borderTop):0)+(style.borderBottom?parseInt(style.borderBottom):0)+ +40];}};};
VBI.Utilities.CreateDetailPhone=function(i,l,t,w,h,a,z,p){var d=document.createElement('div');d.id=i;d.style.left=l+"px";d.style.top=t+"px";d.style.zIndex=z;var b=12;var s=6;var c=14;b=VBI.Utilities.RemToPixel(0.750);s=VBI.Utilities.RemToPixel(0.375);c=VBI.Utilities.RemToPixel(0.875);if(h)d.style.minHeight=h+c+4+s+2*b+"px";d.className=".vbi-detail vbi-detail-phone";var e=document.createElement('div');e.id=i+"-window-header";e.className="vbi-detail-header-phone";d.appendChild(e);var f=document.createElement('div');f.id=i+"-window-title";f.className="vbi-detail-title-phone";f.innerHTML=a;e.appendChild(f);var g=document.createElement('div');g.id=i+"-window-close";g.className="vbi-detail-closebutton vbi-detail-closebutton-tablet";e.appendChild(g);var j=document.createElement('div');j.id=i+"-window-content";j.className="vbi-detail-content";j.style.fontSize=VBI.Utilities.RemToPixel(0.875)+"px";d.appendChild(j);return{m_Div:d,m_Content:j,m_CloseButton:g,m_Arrow:null,GetAnchorPoint:null};};
VBI.Utilities.CreateDetail=function(i,l,t,w,h,a,z,p){if(VBI.m_bIsPhone)return(VBI.Utilities.CreateDetailPhone(i,l,t,w,h,a,z,p));var d=document.createElement('div');d.id=i;d.style.left=l+"px";d.style.top=t+"px";d.style.zIndex=z;var P=VBI.m_bIsPhone;if(!P){var b=16;var s=16;var c=16;b=VBI.Utilities.RemToPixel(1);s=VBI.Utilities.RemToPixel(1);c=VBI.Utilities.RemToPixel(1);if(w)d.style.width=w+2*b+"px";if(h)d.style.minHeight=h+c+4+s+2*b+"px";}else{var e=12;var f=6;var g=14;e=VBI.Utilities.RemToPixel(0.750);f=VBI.Utilities.RemToPixel(0.375);g=VBI.Utilities.RemToPixel(0.875);if(h)d.style.minHeight=h+g+4+f+2*e+"px";}d.className="vbi-detail vbi-detail-border";var j=document.createElement('div');j.id=i+"-window-header";j.className="vbi-detail-header";d.appendChild(j);var k=document.createElement('div');k.id=i+"-window-title";k.className="vbi-detail-title";k.innerHTML=a;j.appendChild(k);var m=document.createElement('div');m.id=i+"-window-close";var r=sap.ui.getCore().getLibraryResourceBundle("sap.ui.vbm");m.title=r.getText("WINDOW_CLOSE");if(VBI.m_bIsMobile)m.className="vbi-detail-closebutton vbi-detail-closebutton-tablet";else m.className="vbi-detail-closebutton vbi-detail-closebutton-desktop";j.appendChild(m);var n=document.createElement('div');n.id=i+"-window-content";n.className="vbi-detail-content";d.appendChild(n);var o;o=document.createElement('b');o.className="vbi-detail-arrow vbi-detail-left";o.style.zIndex=z+1;if(!P)d.appendChild(o);var q=document.createElement('b');q.className="vbi-detail-arrow vbi-detail-left vbi-detail-border-arrow";q.style.zIndex=z;if(!P)d.appendChild(q);return{m_Div:d,m_Content:n,m_CloseButton:m,m_Arrow:o,GetAnchorPoint:function(){return[this.m_Arrow.offsetLeft,this.m_Arrow.offsetTop+this.m_Arrow.offsetHeight/2];}};};
VBI.Utilities.CreateLegendPhone=function(i,l,t,w,h,a,z,p){};
VBI.Utilities.CreateLegend=function(i,r,t,a,z,p){var l=document.createElement('div');l.id=i;l.style.right=r+"px";l.style.top=t+"px";l.style.zIndex=z;l.className="vbi-legend vbi-legend-border";var b=document.createElement('div');b.id=i+"-button-collapse";var R=sap.ui.getCore().getLibraryResourceBundle("sap.ui.vbm");b.title=R.getText("LEGEND_COLLAPSE");b.className="vbi-legend-button vbi-legend-button-col";l.appendChild(b);var c=document.createElement('div');c.id=i+"-button-expand";var R=sap.ui.getCore().getLibraryResourceBundle("sap.ui.vbm");c.title=R.getText("LEGEND_EXPAND");c.className="vbi-legend-button vbi-legend-button-exp";l.appendChild(c);c.style.visibility='hidden';var h=document.createElement('div');h.id=i+"-header";h.className="vbi-legend-header";l.appendChild(h);var d=document.createElement('div');d.id=i+"-title";d.className="vbi-legend-title";d.innerHTML=a;h.appendChild(d);var e=document.createElement('div');e.id=i+"-content";e.className="vbi-legend-content";l.appendChild(e);var f=document.createElement('table');f.id=i+"-table";f.className="vbi-legend-table";e.appendChild(f);return{m_Div:l,m_Header:h,m_Content:e,m_Table:f,m_ButtonCol:b,m_ButtonExp:c};};
VBI.Utilities.CreateGeoSceneDivCSS=function(i,c,t){var n=document.createElement('div');n.id=i;n.className=c;if(t)n.title=t;return n;};
VBI.Utilities.CreateDOMColorShiftedImageFromData=function(d,i,c,e,l){var f=null,h=c?VBI.Types.string2rhls(c):null;if(!h)f=c?VBI.Types.string2rgba(c):null;var j=null,k=e?VBI.Types.string2rhls(e):null;if(!k)j=e?VBI.Types.string2rgba(e):null;var t=document.createElement('img');var m=document.createElement('img');if(l){t.onload=function(){if(typeof l==='function')l(t);this.onload=null;};m.onload=function(){var n=document.createElement("canvas");var o=n.getContext("2d");n.width=m.width;n.height=m.height;o.drawImage(m,0,0,m.naturalWidth,m.naturalHeight,0,0,m.width,m.height);var p=o.getImageData(0,0,m.width,m.height);var d=p.data;function q(d,v,w,x){var r=d[v];var g=d[v+1];var b=d[v+2];var a=d[v+3];if(w){var y=VBI.Utilities.RGB2HLS(r,g,b);var z=VBI.Utilities.HLS2RGB(y[0]+w[0],y[1]*w[1],y[2]*w[2]);d[v]=Math.min(Math.round(z[0]),255);d[v+1]=Math.min(Math.round(z[1]),255);d[v+2]=Math.min(Math.round(z[2]),255);d[v+3]=Math.min(Math.round(w[3]*a),255);}else if(x){d[v]=x[0];d[v+1]=x[1];d[v+2]=x[2];if(d[v+3])d[v+3]=x[4]?Math.floor(Math.min(x[3]*255,255)):255;}};for(var s=0,u=(m.width*m.height);s<u;++s){var v=s*4;if(h||f)q(d,v,h,f);if(k||j)q(d,v,k,j);}o.putImageData(p,0,0);t.src=n.toDataURL("image/png");this.onload=null;};}if(d.indexOf("data:image")==0)m.src=d;else m.src="data:image"+i+";base64,"+d;return t;};
VBI.Utilities.CreateDOMImageFromData=function(d,i,l){var a=document.createElement('img');if(l){a.onload=function(){if(typeof l==='function')l(a);this.onload=null;};}if(d.indexOf("data:image")==0)a.src=d;else a.src="data:image"+i+";base64,"+d;return a;};
VBI.Utilities.PtOnRect=function(p,r){return((p[0]>=r[0])&&(p[0]<=r[2])&&(p[1]>=r[1])&&(p[1]<=r[3]))?true:false;};
VBI.Utilities.PtInRect=function(p,r){return((p[0]>r[0])&&(p[0]<r[2])&&(p[1]>r[1])&&(p[1]<r[3]))?true:false;};
VBI.Utilities.RectIntersect=function(r,a){return!(a[0]>r[2]||a[2]<r[0]||a[3]<r[1]||a[1]>r[3]);};
VBI.Utilities.RectOffset=function(r,n,a){r[0]+=n;r[1]+=a;r[2]+=n;r[3]+=a;};
VBI.Utilities.cImg;
VBI.Utilities.GetImagePixelData=function(i){if(!VBI.Utilities.cImg){VBI.Utilities.cImg=document.createElement('canvas');}VBI.Utilities.cImg.width=i.naturalWidth;VBI.Utilities.cImg.height=i.naturalHeight;VBI.Utilities.cImg.style.width=(i.naturalWidth+"px");VBI.Utilities.cImg.style.height=(i.naturalHeight+"px");VBI.Utilities.cImg.style.top="0px";VBI.Utilities.cImg.style.left="0px";VBI.Utilities.cImg.style.position="absolute";var c=VBI.Utilities.cImg.getContext("2d");c.drawImage(i,0,0);var a=c.getImageData(0,0,VBI.Utilities.cImg.width,VBI.Utilities.cImg.height);return a;};
VBI.Utilities.pointOnLine=function(p,x,y,d,c){function s(v,e){return((v[0]-e[0])*(v[0]-e[0])+(v[1]-e[1])*(v[1]-e[1]));};var r=-1,n=-1,a=d*d,b=a;var t,v,e;var f=VBI.Utilities.sqDistance;for(var g=0,l=p.length-1;g<l;++g){v=p[g];e=p[g+1];if((t=f(v[0],v[1],e[0],e[1],x,y))<a){a=t;r=g;}}if(r>=0){if((t=s([x,y],p[r]))<b){b=t;n=r;}if(s([x,y],p[r+1])<b){b=t;n=r+1;}}if(c&&(l>0)){v=p[0];e=p[l];if((t=f(v[0],v[1],e[0],e[1],x,y))<a){a=t;r=g;}if(r>=0){if((t=s([x,y],p[r]))<b){b=t;n=r;}if(s([x,y],p[0])<b){b=t;n=0;}}}return{m_edge:r,m_node:n};};
VBI.Utilities.pointInPolygon=function(p,x,y){var v,a,b=p.length;if(jQuery.type(p[0])=='array'){for(var c=false,n=-1,l=b,d=l-1;++n<l;d=n){v=p[n];a=p[d];((v[1]<=y&&y<a[1])||(a[1]<=y&&y<v[1]))&&(x<(a[0]-v[0])*(y-v[1])/(a[1]-v[1])+v[0])&&(c=!c);}}else{for(var c=false,n=0,l=b,d=l-2;n<=l-2;n+=2){v=[p[n],p[n+1]];a=[p[d],p[d+1]];((v[1]<=y&&y<a[1])||(a[1]<=y&&y<v[1]))&&(x<(a[0]-v[0])*(y-v[1])/(a[1]-v[1])+v[0])&&(c=!c);d=n;}}return c;};
VBI.Utilities.pointInTriangle=function(t,p){var a=t[2][0]-t[0][0];var b=t[2][1]-t[0][1];var c=t[1][0]-t[0][0];var d=t[1][1]-t[0][1];var e=p[0]-t[0][0];var f=p[1]-t[0][1];var g=a*a+b*b;var h=a*c+b*d;var i=a*e+b*f;var j=c*c+d*d;var k=c*e+d*f;var n=1/(g*j-h*h);var u=(j*i-h*k)*n;var v=(g*k-h*i)*n;return((u>=0)&&(v>=0)&&(u+v<1));};
VBI.Utilities.INSIDE=0;VBI.Utilities.LEFT=1;VBI.Utilities.RIGHT=2;VBI.Utilities.BOTTOM=4;VBI.Utilities.TOP=8;
VBI.Utilities.ComputeOutCode=function(x,y,r){var a=r[0];var b=r[2];var c=r[1];var d=r[3];var e=VBI.Utilities.INSIDE;if(x<a)e|=VBI.Utilities.LEFT;else if(x>b)e|=VBI.Utilities.RIGHT;if(y<c)e|=VBI.Utilities.BOTTOM;else if(y>d)e|=VBI.Utilities.TOP;return e;};
VBI.Utilities.LineIntersectRect=function(a,b,c,d,r){var R={};var e=r[0];var f=r[2];var g=r[1];var h=r[3];var n=VBI.Utilities.ComputeOutCode(a,b,r);var i=VBI.Utilities.ComputeOutCode(c,d,r);var A=false;while(true){if(!(n|i)){A=true;break;}else if(n&i){break;}else{var x,y;var j=n?n:i;if(j&VBI.Utilities.TOP){x=a+(c-a)*(h-b)/(d-b);y=h;}else if(j&VBI.Utilities.BOTTOM){x=a+(c-a)*(g-b)/(d-b);y=g;}else if(j&VBI.Utilities.RIGHT){y=b+(d-b)*(f-a)/(c-a);x=f;}else if(j&VBI.Utilities.LEFT){y=b+(d-b)*(e-a)/(c-a);x=e;}if(j==n){a=x;b=y;n=VBI.Utilities.ComputeOutCode(a,b,r);}else{c=x;d=y;i=VBI.Utilities.ComputeOutCode(c,d,r);}}}R.bReturn=false;if(A){R.x0=a;R.y0=b;R.x1=c;R.y1=d;R.bReturn=true;}return R;};
VBI.Utilities.LineLineIntersection=function(p,a,q,b){var A=a[1]-p[1];var B=p[0]-a[0];var C=A*p[0]+B*p[1];var c=b[1]-q[1];var d=q[0]-b[0];var e=c*q[0]+d*q[1];var f=A*d-c*B;if(!f)return null;return[(d*C-B*e)/f,(A*e-c*C)/f];};
VBI.Utilities.IsClockwise=function(p){var l=p.length;if(p.length%2)l-=1;var x,a,y,b,z;z=0;x=p[l-2];y=p[l-1];for(var n=0;n<l;n+=2){a=p[n];b=p[n+1];z+=(a-x)*(b+y);x=a;y=b;}return(z<0);};
VBI.Utilities.GetClippedPolygon=function(p,X,r){var o=X;var a=p.slice(0);var i=[];for(var n=0;n<=3;++n,o=0){i=a.slice(0);a=[];var t=[i[i.length-2],i[i.length-1]];var S=[t[0]+o,t[1]];for(var b=0;b<=i.length-2;b+=2){t=[i[b],i[b+1]];var E=[t[0]+o,t[1]];var e=false;var s=false;var c=[];switch(n){case 0:e=(E[1]>r[1]);s=(S[1]>r[1]);c=[[r[0],r[1]],[r[2],r[1]]];break;case 1:e=(E[0]<r[2]);s=(S[0]<r[2]);c=[[r[2],r[1]],[r[2],r[3]]];break;case 2:e=(E[1]<r[3]);s=(S[1]<r[3]);c=[[r[0],r[3]],[r[2],r[3]]];break;case 3:e=(E[0]>r[0]);s=(S[0]>r[0]);c=[[r[0],r[1]],[r[0],r[3]]];break;default:break;}if(e){if(!s){var d=VBI.Utilities.LineLineIntersection(S,E,c[0],c[1]);if(d)a.push(d[0],d[1]);}a.push(E[0],E[1]);}else if(s){var d=VBI.Utilities.LineLineIntersection(S,E,c[0],c[1]);if(d)a.push(d[0],d[1]);}S=[E[0],E[1]];}}return a;};
VBI.Utilities.GetBarycenterForPolygon=function(p,o){var a=p.slice(0);var b=[a[0],a[1]];var c=[a[a.length-2],a[a.length-1]];if(b!=c){a.push(a[0],a[1]);}var N=a.length-2;var s=0;var A=0;var d;var e;for(var n=0;n<N;n+=2){s+=((a[n]+o)*a[n+3]-(a[n+2]+o)*a[n+1]);}A=s/2;if(A){s=0;for(var n=0;n<N;n+=2){s+=(a[n]+o+a[n+2]+o)*((a[n]+o)*a[n+3]-(a[n+2]+o)*a[n+1]);}d=s/(A*6);s=0;for(var n=0;n<N;n+=2){s+=(a[n+1]+a[n+3])*((a[n]+o)*a[n+3]-(a[n+2]+o)*a[n+1]);}e=s/(A*6);}if(d&&e)return[d,e];return null;};
VBI.Utilities.GetMidpointForPolygon=function(p,b,X,r){var o=X;var l=[];var a=b[0];var c=b[1];var d=VBI.Utilities.PtInRect([a[0]+o,a[1]],r);var e=VBI.Utilities.PtInRect([c[0]+o,c[1]],r);if(!d||!e){p=VBI.Utilities.GetClippedPolygon(p,o,r);o=0;}var f=VBI.Utilities.GetBarycenterForPolygon(p,o);if(f){var g=VBI.Utilities.getNextPoint(f[0],f[1],p,o);l.push(g);return{max:0,aPos:l};}return null;};
VBI.Utilities.GetClippedPolygons=function(p,o,r){var c=[];var d=p.slice(0);var n=d.length;var e=n-2;var z=VBI.Utilities.IsClockwise(p);if(z>0)d.push(r[0],r[1],r[2],r[1],r[2],r[3],r[0],r[3]);else d.push(r[0],r[1],r[0],r[3],r[2],r[3],r[2],r[1]);var g=d.length;var E=[];var L=[];var i=[];var h=[];for(var j=0;j<n;j+=2)i.push(j);var k,m,q,s;k=[d[e]+o,d[e+1]];for(var t=e,j=0;j<=e;j+=2){m=[d[j]+o,d[j+1]];var R=VBI.Utilities.LineIntersectRect(k[0],k[1],m[0],m[1],r);var u=[R.x0,R.y0];var v=[R.x1,R.y1];var w=null;if(R.bReturn==true){if((R.x0!=k[0]||R.y0!=k[1])&&(R.x1!=m[0]||R.y1!=m[1])){if(!(R.x0==R.x1&&R.y0==R.y1)){var f=d.push(R.x0,R.y0);var l=d.push(R.x1,R.y1);E.push(f-2);L.push(l-2);var I=i.indexOf(j);i.splice(I,0,f-2,l-2);}}else if(R.x0!=k[0]||R.y0!=k[1]){if(R.x0!=m[0]||R.y0!=m[1]){var l=d.push(R.x0,R.y0);E.push(l-2);var I=i.indexOf(j);i.splice(I,0,l-2);}}else if(R.x1!=m[0]||R.y1!=m[1]){var l=d.push(R.x1,R.y1);L.push(l-2);var I=i.indexOf(j);i.splice(I,0,l-2);}}k=m;t=j;}for(var j=n,x=0;x<4;j+=2,++x){var y=[];h.push(j);q=[d[j],d[j+1]];if(x==3)s=[d[n],d[n+1]];else s=[d[j+2],d[j+3]];var A=(q[0]==s[0])?1:0;var B=A?0:1;for(var C=g;C<=d.length-2;C+=2){if(d[C+B]==q[B]){y.push({pt:d[C+A],idx:C});}}if(x<2)y.sort(function(a,b){return a.pt-b.pt});else y.sort(function(a,b){return b.pt-a.pt});for(var D=0;D<y.length;++D){h.push(y[D].idx);}q=s;}for(var j=n;j<=d.length-2;j+=2)d[j]-=o;for(var j=0;j<E.length;++j){var F=[];var G=E[j];var H=i.indexOf(E[j]);var J=i;var K=h;var M=L;var N=E;F.push(d[E[j]],d[E[j]+1]);var O=0;while(true){H++;if(H>J.length-1)H=0;if(J[H]==G){c.push(F);break;}F.push(d[J[H]],d[J[H]+1]);var I=M.indexOf(J[H]);if(I>-1){O++;H=K.indexOf(J[H]);var P=J;J=K;K=P;P=M;M=N;N=P;}}}return c;};
VBI.Utilities.GetMidpointsForPolygon=function(p,b,X,r){var a=[];var o=X;var l=[];var c=b[0];var d=b[1];if(VBI.Utilities.RectIntersect([c[0]+o,c[1],d[0]+o,d[1]],r)){var e=VBI.Utilities.PtOnRect([c[0]+o,c[1]],r);var f=VBI.Utilities.PtOnRect([d[0]+o,d[1]],r);if(!e||!f){a=VBI.Utilities.GetClippedPolygons(p,o,r);if(!a.length){var m=[r[0]+(r[2]-r[0])/2,r[1]+(r[3]-r[1])/2];if(VBI.Utilities.pointInPolygon(p,m[0],m[1]))l.push(m);}}else a.push(p);for(var n=0;n<a.length;++n){var g=VBI.Utilities.GetBarycenterForPolygon(a[n],o);if(g){var h=VBI.Utilities.getNextPoint(g[0],g[1],a[n],o);l.push(h);}}if(l.length>0)return{max:0,aPos:l};}return null;};
VBI.Utilities.GetMidpointsForLine=function(p,o,r){var l=[];var R={};var a=[Number.MAX_VALUE,Number.MAX_VALUE];var O=false;var s;var S=[];if(p.length>5){for(var n=0;n<=p.length-6;n+=3){var x=p[n];var y=p[n+1];var b=p[n+3];var c=p[n+4];R=VBI.Utilities.LineIntersectRect(x+o,y,b+o,c,r);if(R.bReturn==true){if(s&&O&&(R.x0!=a[0]||R.y0!=a[1])){S.push(s);O=false;}if(!O){s=new Array;s.push(R.x0);s.push(R.y0);O=true;}s.push(R.x1);a[0]=R.x1;s.push(R.y1);a[1]=R.y1;}else{if(O){S.push(s);O=false;}}}if(O){S.push(s);O=false;}}var m=0;var d=0;for(var e=0;e<S.length;e++){var f=S[e];if(f.length>3){var t=0.0;var L;var v=[];for(var n=0;n<=f.length-4;n+=2){L=Math.sqrt(Math.pow(f[n+2]-f[n],2)+Math.pow(f[n+3]-f[n+1],2));t+=L;v.push(L);}var g=t;var h=t/2;var i=-1;var M=0.0;for(var n=v.length-1;n>=0;n--){t-=v[n];if(t<=h){M=h-t;i=n;break;}}if(i>-1){var j=[f[i*2+2]-f[i*2],f[i*2+3]-f[i*2+1]];var k=Math.sqrt(Math.pow(j[0],2)+Math.pow(j[1],2));var q=[j[0]/k,j[1]/k];var u=[q[0]*M,q[1]*M];l.push([f[i*2]+parseInt(u[0]),f[i*2+1]+parseInt(u[1])]);if(g>m){m=g;d=e;}}}}return{max:d,aPos:l};};
VBI.Utilities.updateBoundRect=function(a,r){var x,n=a.length;var m=r[0];var b=r[2];var c=r[1];var d=r[3];for(var e=0;e<n;++e){x=a[e];if(m>x[0])m=x[0];if(b<x[0])b=x[0];if(c>x[1])c=x[1];if(d<x[1])d=x[1];}r[0]=m;r[2]=b;r[1]=c;r[3]=d;};
VBI.Utilities.inflateRect=function(r,v){r[0]-=v;r[1]-=v;r[2]+=v;r[3]+=v;};
VBI.Utilities.sqDistance=function(x,y,a,b,c,d){var p=a-x;var e=b-y;var s=p*p+e*e;if(!s)return(c-x)*(c-x)+(d-y)*(d-y);var u=((c-x)*p+(d-y)*e)/s;if(u>1)u=1;else if(u<0)u=0;var f=x+u*p-c;var g=y+u*e-d;return f*f+g*g;};
VBI.Utilities.getNextPoint=function(x,y,p,o){var v,a,b=p.length;var d=[];var e=[];for(var c=false,n=0,l=b,f=l-2;n<=l-2;n+=2){v=[p[n]+o,p[n+1]];a=[p[f]+o,p[f+1]];var s=0;var r=[];var A=x-v[0];var B=y-v[1];var C=a[0]-v[0];var D=a[1]-v[1];var g=A*C+B*D;var h=C*C+D*D;if(!h){s=(x-v[0])*(x-v[0])+(y-v[1])*(y-v[1]);r=[v[0],v[1]];}else{var i=g/h;if(i<0){r=[v[0],v[1]];}else if(i>1){r=[a[0],a[1]];}else{r=[v[0]+i*C,v[1]+i*D];}var j=x-(v[0]+i*C);var k=y-(v[1]+i*D);s=(j*j+k*k);}d.push(r);e.push(s);((v[1]<=y&&y<a[1])||(a[1]<=y&&y<v[1]))&&(x<(a[0]-v[0])*(y-v[1])/(a[1]-v[1])+v[0])&&(c=!c);f=n;}if(c){return[x,y];}else{var m=10000;var q=-1;if(e.length){for(var n=0;n<e.length;++n){if(e[n]<m){q=n;m=e[n];}}if(q>-1){return(d[q]);}}return([p[0]+o,p[1]]);}};
VBI.Utilities.DrawSelectIndicator=function(c,p){var r=4;c.lineWidth=1;c.strokeStyle='rgba( 0, 0, 0, 1.0 )';c.fillStyle='rgba( 10, 10, 255, 1.0 )';c.beginPath();c.arc(p[0],p[1],r,0,2*Math.PI);c.closePath();c.fill();c.stroke();};
VBI.Utilities.DrawDesignRect=function(c,a,p,b,d,e){var x,y,r=3,D=c.setLineDash?true:false;c.save();c.lineWidth=1;c.strokeStyle='rgba( 0, 0, 0, 1.0 )';if(typeof p=='object'){var w=p[2]-p[0];var h=p[3]-p[1];var f=w/2;var g=h/2;if(D)c.setLineDash([1,2]);c.strokeRect(p[0],p[1],w,h);var i='rgba( 255, 255, 255, 1.0 )';var j='rgba( 128, 128, 128, 1.0 )';if(D)c.setLineDash([0,0]);c.fillStyle=i;for(x=0;x<3;++x)for(y=0;y<3;++y){if(!a[y*3+x])c.fillStyle=j;else c.fillStyle=i;if(x==1&&y==1)continue;c.beginPath();c.arc(p[0]+x*f,p[1]+y*g,r,0,2*Math.PI);c.closePath();c.fill();c.stroke();}}else{c.strokeRect(p-1,b-1,d-p,e-b);c.strokeStyle='rgba( 255, 255, 255, 1.0 )';c.strokeRect(p,b,d-p,e-b);}c.restore();};
VBI.Utilities.DrawFrameRect=function(c,a,p,b,d,e){c.lineWidth=1;c.strokeStyle=a;if(typeof p=='object')c.strokeRect(p[0],p[1],p[2]-p[0],p[3]-p[1]);else c.strokeRect(p,b,d-p,e-b);};
VBI.Utilities.AssembleCopyrightString=function(C,a,b){var r=/\{LINK\|IMG\}/;var c=/\{IMG\}/;var d=/\{LINK\|([^\}]+)\}/;if(C){var t=C.replace(r,"<a href='"+a+"'><img src='"+b+"' width='10' height='10' border='none'></a>");t=t.replace(c,"<img src='"+b+"' width='10' height='10' border='none' >");return t.replace(d,"<a  href='"+a+"'>$1</a>");}return C;};
VBI.Utilities.DrawTrackingRect=function(c,p,a,b,d){c.save();c.strokeStyle='black';c.lineWidth=1;if(c.setLineDash)c.setLineDash([1,2]);c.beginPath();c.rect(p,a,b-p,d-a);c.stroke();c.fillStyle='rgba( 0, 192, 192, 0.2 )';c.fill();c.restore();};
VBI.Utilities.RGB2HLS=function(r,g,b){r/=255.0,g/=255.0,b/=255.0;var m=Math.max(r,g,b);var a=Math.min(r,g,b);var h=0,s,l=(m+a)/2;if(m==a){h=s=0;}else{var d=m-a;s=l>0.5?d/(2-m-a):d/(m+a);switch(m){case r:h=(g-b)/d+(g<b?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4;break;}h/=6;}return[h,l,s];};
VBI.Utilities.HLS2RGB=function(h,l,s){var r=0,g=0,b=0;if(s==0){r=g=b=l;}else{function H(p,q,t){if(t<0)t+=1;else if(t>1)t-=1;if(t<1/6)return p+(q-p)*6*t;if(t<1/2)return q;if(t<2/3)return p+(q-p)*(2/3-t)*6;return p;};var q=l<0.5?l*(1+s):l+s-l*s;var p=2*l-q;r=H(p,q,h+1/3);g=H(p,q,h);b=H(p,q,h-1/3);}return[r*255,g*255,b*255];};
VBI.Utilities.RemToPixel=function(v){return v*parseFloat(getComputedStyle(document.documentElement).fontSize);};
VBI.Utilities.ColorHex2rgba=function(h){var c=h.charAt(0)==="#"?h.substring(1,7):h;return'rgba('+parseInt(c.substring(0,2),16)+','+parseInt(c.substring(2,4),16)+','+parseInt(c.substring(4,6),16)+',1.0)';}
