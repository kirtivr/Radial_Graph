VBI.SupportedUnitsOfLength=[{RequestedUnit:"km",DisplayUnitDefault:"m",DisplayUnit2:"km",ConvFactor:1000.0,ConvFactorMeter:1.0},{RequestedUnit:"mi",DisplayUnitDefault:"ft",DisplayUnit2:"mi",ConvFactor:5280.0,ConvFactorMeter:0.3048},{RequestedUnit:"nm",DisplayUnitDefault:"ft",DisplayUnit2:"nm",ConvFactor:6076.12,ConvFactorMeter:0.3048}];
VBI.Scale=function(){var s={};s.scene=null;s.m_ID=null;s.m_Image=null;s.m_CurrentUnit=null;s.m_DisplayUnit=null;s.m_nDivider=0;s.m_nScalerLength=0;s.m_nDistance=0;s.m_bRtl=false;s.clear=function(){var i=document.getElementById(s.m_canvas.id);i.parentNode.removeChild(i);s.m_Image=null;s.scene=null;};s.Awake=function(a,t){s.scene=a;var l=jQuery.sap.byId(t);s.m_ID=$(l).attr('id');s.AppendCanvas();};s.getId=function(a,b){return b+'-'+a;};s.AppendCanvas=function(){s.m_bRtl=(document.dir=='rtl')?true:false;s.m_canvas=document.createElement('canvas');s.m_canvas.style.position="absolute";s.m_canvas.style.zIndex=5;s.m_canvas.id=s.getId('vbi-scale-canvas',s.m_ID);s.scene.m_Div.appendChild(s.m_canvas);if(s.m_bRtl)s.m_canvas.style.right="10px";else s.m_canvas.style.left="10px";s.m_canvas.style.bottom="10px";};s.getConfig=function(){if(s.m_CurrentUnit)return s.m_CurrentUnit;else{var c=s.scene.m_Ctx;var a,u;if(c)a=c.GetConfig();if(a)u=a.GetData("UnitOfLength");if(u){for(var n=0;n<VBI.SupportedUnitsOfLength.length;++n){if(VBI.SupportedUnitsOfLength[n].RequestedUnit==u){s.m_CurrentUnit=VBI.SupportedUnitsOfLength[n];break;}}}}if(!s.m_CurrentUnit)s.m_CurrentUnit=VBI.SupportedUnitsOfLength[0];return s.m_CurrentUnit;};s.getImage=function(l){if(s.m_Image)return s.m_Image;var i=new Image();if(l){i.onload=function(){if(typeof l==='function')l(i);this.onload=null;};}i.src=sap.ui.resource("sap.ui.vbm","themes/base/img/sapvisualbusiness.png");s.m_Image=i;return i;};s.CalcScaleDimensions=function(){var r=s.scene.m_Div.getBoundingClientRect();var c=s.getConfig();var p=[parseInt((r.left+(r.right-r.left))/2-75),parseInt((r.top+(r.bottom-r.top))/2)];var a=[p[0]+180,p[1]];var d=s.scene.GetDistance(p,a);var b;d=d*(1.0/c.ConvFactorMeter);if(d>=c.ConvFactor){b=parseInt(d/c.ConvFactor);s.m_DisplayUnit=c.DisplayUnit2;}else{b=d;s.m_DisplayUnit=c.DisplayUnitDefault;}var l=parseInt(Math.log(b)/Math.LN10);b=parseInt(b/Math.pow(10,l));if(b<2)b=1;else if(b<5)b=2;else if(b<10)b=5;b=parseInt(b*Math.pow(10,l));var e;if(d>=c.ConvFactor){e=b*c.ConvFactor;e=e*c.ConvFactorMeter;}else e=b*c.ConvFactorMeter;var f=[p[0]-s.scene.m_Canvas[0].getPixelLeft(),p[1]-s.scene.m_Canvas[0].getPixelTop()];var g=s.scene.GetTargetPointForDistance(e,p);var h=[g[0]+s.scene.m_Canvas[0].getPixelLeft(),g[1]+s.scene.m_Canvas[0].getPixelTop()];var t=b;var n=0;while(n==0&&t>0){n=t%5;t/=10;}if(n!=2)n=5;var i=Math.round(h[0]-p[0]);var j=parseInt(((a[0]-p[0])*e)/d);if(i>60&&i<(r.right-r.left)){s.m_nScalerLength=i;s.m_nDistance=b;s.m_nDivider=n;return true;}return false;};s.Update=function(){var r=[211,304,4,8];var a=[240,304,4,8];var b=[224,304,4,8];var c=[235,304,1,8];var d=[219,304,1,8];var e=document.getElementById(s.m_canvas.id).getContext('2d');e.clearRect(0,0,s.m_canvas.width,s.m_canvas.height);if(!s.CalcScaleDimensions())return;s.m_canvas.width=s.m_nScalerLength+10;s.m_canvas.height=30;var i=s.getImage(s.scene.RenderAsync.bind(s.scene));if(i){var l=0;var t=20;e.drawImage(i,r[0],r[1],r[2],r[3],l,t,r[2],r[3]);l+=r[2];var n=0;while(n<s.m_nDivider){for(var f=0;f<s.m_nScalerLength/s.m_nDivider;f++){if(n%2){e.drawImage(i,c[0],c[1],c[2],c[3],l,t,c[2],c[3]);l+=c[2];}else{e.drawImage(i,d[0],d[1],d[2],d[3],l,t,d[2],d[3]);l+=d[2];}}n++;}if(s.m_nDivider%2){e.drawImage(i,b[0],b[1],b[2],b[3],l,t,b[2],b[3]);l+=b[2];}else{e.drawImage(i,a[0],a[1],a[2],a[3],l,t,a[2],a[3]);l+=a[2];}var o=e.textAlign;var g=e.fillStyle;var h=e.font;e.font="12px arial";e.fillStyle="#FFFFFF";for(var f=0;f<2;++f){e.textAlign=s.m_bRtl?"end":"start";e.fillText("0",f,15+f);e.textAlign=s.m_bRtl?"start":"end";e.fillText(s.m_nDistance+s.m_DisplayUnit,s.m_canvas.width-1+f,15+f);e.fillStyle="#212C34";}e.textAlign=o;e.fillStyle=g;e.font=h;}};return s;};
