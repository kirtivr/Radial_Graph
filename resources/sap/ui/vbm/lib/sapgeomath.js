VBI.MathLib=(function(){var m={};m.min_longitude=-Math.PI;m.max_longitude=Math.PI;m.min_latitude=(-85.05112878*2*Math.PI)/360.0;m.max_latitude=(85.05112878*2*Math.PI)/360.0;m.mercator_for_max_latitude=3.1415942;m.div_mercator_for_max_latitude=(0.5/m.mercator_for_max_latitude);m.div_max_longitude=(1.0/m.max_longitude);m.earthradius=6378137;m.stdWorldBorder=-180;m.CreateGUID=function(){var s=[];for(var n=0;n<8;++n)s[n]=(((Math.random()+1)*0x10000)|0).toString(16).substring(1);return(s[0]+s[1]+"-"+s[2]+"-"+s[3]+"-"+s[4]+"-"+s[5]+s[6]+s[7]);};m.DegToRad=function(l){var a=Math.PI/180.0;return[l[0]*a,l[1]*a];};m.RadToDeg=function(l){var a=180.0/Math.PI;return[l[0]*a,l[1]*a];};m.LonLatToUCS=function(l,u){var n=u[0];var a=u[1];var L=l[0];var f=l[1];if(f<m.min_latitude)f=m.min_latitude;else if(f>m.max_latitude)f=m.max_latitude;u[0]=L*m.div_max_longitude;u[0]=(u[0]+1.0)*n*0.5;var s=Math.sin(f);u[1]=(Math.log((1.0+s)/(1.0-s))*m.div_mercator_for_max_latitude);u[1]=0.5*a*(1.0-u[1]);return u;};m.UCSToLonLat=function(u,l){l[0]=u[0]*Math.PI;l[1]=Math.atan(m.sinh(-u[1]*m.mercator_for_max_latitude));return l;};m.sinh=function(v){var a=Math.pow(Math.E,v);var b=Math.pow(Math.E,-v);return(a-b)/2.0;};m.Distance=function(l,b){var R=m.earthradius;var e=l[1];var f=l[0];var g=b[1];var h=b[0];var L=g-e;var i=h-f;var a=Math.sin(L/2)*Math.sin(L/2)+Math.cos(e)*Math.cos(g)*Math.sin(i/2)*Math.sin(i/2);var c=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));var d=R*c;return d;};m.EquidistantLonLat=function(l,d,s){var r=[];s=s||64;var b,y,x;var a=d/m.earthradius;var c=l[0];var e=l[1];var f=Math.sin(a);var g=Math.cos(a);var h=Math.sin(e);var i=Math.cos(e);var j=c,k=c;var n=e,o=e;for(var p=0;p<s;++p){b=p*2*Math.PI/s;y=Math.asin(h*g+i*f*Math.cos(b));x=c+Math.atan2(Math.sin(b)*f*i,g-h*Math.sin(y));if(j>x)j=x;if(k<x)k=x;if(n>y)n=y;if(o<y)o=y;r.push([x,y]);}r.m_MinX=j;r.m_MaxX=k;r.m_MinY=n;r.m_MaxY=o;return r;};m.GetSurroundingBox=function(c,d,e,C){var f=100;var w=m.stdWorldBorder;if(d==undefined)d=360;var p=(c[0].length==2);var g=0,h=1,j=2,k=3;if(p){h=0;j=k=1;}var l=Number.MAX_VALUE,n=-Number.MAX_VALUE;var o,q,r,s;for(var i=0;i<c.length;++i){r=c[i];if(((o=r[g])<-180)||(o>180)){s=Math.floor((o+180)/360);o=(r[g]-=360*s);r[h]-=360*s;}if((q=r[h])<o){s=Math.ceil((o-q)/360);q=(r[h]+=360*s);}if(r[j]<l)l=r[j];if(r[k]>n)n=r[k];}c.sort(function(a,b){return a[0]-b[0]});var t=-1,u=-1;var v=-1,x=-1;var y,z;var A=c[0];var B,D=A[h],E=A[g];var F,G;for(var i=1;i<c.length;++i){A=c[i];E=A[g];B=A[h];if(E<D){if(B>D)D=B;}else{if((E-D)>t){y=D;t=E-D;v=i;}if((E-D)>u){F=Math.abs(((E-w+540)%360)-180);G=Math.abs(((D-w+540)%360)-180);if((F<f)||(G<f)){z=D;u=E-D;x=i;}}D=B;}}A=c[0];E=A[g];var H=E-D+360;if(H>u){F=Math.abs(((E-w+540)%360)-180);G=Math.abs(((D-w+540)%360)-180);if((F<f)||(G<f)){z=D;u=H;x=0;}}if(H>t){y=D;}else{if(v<0)return[w,w+360,l,n,false];A=c[v];}y-=360*Math.floor((y+180)/360);var I=Math.floor(e)+1;var J=(e==undefined)?0:360/Math.pow(2,I-e);var K=1000;if(d==0){d=J;if(C!=undefined)K=Math.floor(C(l,n));}var L=y-A[g]+360*(y<A[g]);var S=false;if(J&&(u>=0)){var M=Math.floor(I+Math.log(J/(360-t))/Math.LN2);var N=Math.floor(I+Math.log(J/(360-u))/Math.LN2);S=((M==N)||(K<=N));}if((L>d)||(K<=Math.floor(e))||S){if(!S)return[w,w+360,l,n,false];A=c[x];y=z-360*Math.floor((z+180)/360);}return[A[g],y,l,n];};return m;})();
