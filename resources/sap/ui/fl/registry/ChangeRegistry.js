/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2014-2015 SAP SE. All rights reserved
 */
sap.ui.define(["sap/ui/fl/Utils","jquery.sap.global","sap/ui/fl/registry/ChangeRegistryItem","sap/ui/fl/registry/SimpleChanges","sap/ui/fl/registry/ChangeTypeMetadata","sap/ui/fl/registry/Settings"],function(U,q,C,S,a,b){"use strict";var c=function(){this._registeredItems={};this.simpleChanges=S;this.initSettings();};c._instance=undefined;c.getInstance=function(){if(!c._instance){c._instance=new c();}return c._instance;};c.prototype.registerControlForSimpleChange=function(s,o){var d;if(!s){return;}if(!o||!o.changeType||!o.changeHandler){return;}d=this._createChangeRegistryItemForSimpleChange(s,o);if(d){this.addRegistryItem(d);}};c.prototype._createChangeRegistryItemForSimpleChange=function(s,o){var p,d,e;p={name:o.changeType,changeHandler:o.changeHandler};d=new a(p);p={changeTypeMetadata:d,controlType:s};e=new C(p);return e;};c.prototype.addRegistryItem=function(r){var s,d;if(!r){return;}s=r.getChangeTypeName();d=r.getControlType();this._registeredItems[d]=this._registeredItems[d]||{};this._registeredItems[d][s]=r;};c.prototype.removeRegistryItem=function(p){if(!p.changeTypeName&&!p.controlType){U.log.error("sap.ui.fl.registry.ChangeRegistry: ChangeType and/or ControlType required");return;}if(p.controlType&&p.changeTypeName){if(this._registeredItems[p.controlType]){if(Object.keys(this._registeredItems[p.controlType]).length===1){delete this._registeredItems[p.controlType];}else{delete this._registeredItems[p.controlType][p.changeTypeName];}}}else if(p.controlType){if(this._registeredItems[p.controlType]){delete this._registeredItems[p.controlType];}}else if(p.changeTypeName){for(var d in this._registeredItems){var e=this._registeredItems[d];delete e[p.changeTypeName];}}};c.prototype.getRegistryItems=function(p){if(!p.changeTypeName&&!p.controlType){U.log.error("sap.ui.fl.registry.ChangeRegistry: Change Type Name and/or Control Type required");}var r=null;if(p.controlType&&p.changeTypeName){var d=this._registeredItems[p.controlType];if(d){if(d[p.changeTypeName]){r={};r[p.controlType]={};r[p.controlType][p.changeTypeName]=d[p.changeTypeName];}}}else if(p.controlType){if(this._registeredItems[p.controlType]){r={};r[p.controlType]={};q.each(this._registeredItems[p.controlType],function(s,R){r[p.controlType][s]=R;});}}else if(p.changeTypeName){r={};for(var e in this._registeredItems){if(this._registeredItems[e][p.changeTypeName]){r[e]={};r[e][p.changeTypeName]=this._registeredItems[e][p.changeTypeName];}}}this._filterChangeTypes(r,p.layer);return r;};c.prototype.initSettings=function(s){this._oSettings=b.getInstanceOrUndef(s);if(!this._oSettings){this._oSettings=new b({});}};c.prototype._filterChangeTypes=function(r,l){if(this._oSettings&&l&&r){var t=this;q.each(r,function(s,o){q.each(o,function(d,R){var i=t._oSettings.isChangeTypeEnabled(d,l);if(!i){delete o[d];}});});}};c.prototype.getDragInfo=function(s){var d=this._registeredItems[s];if(d){return d.getDragInfo();}return null;};return c;},true);
